# imagecolorallocate




<div class="phpcode"><span class="html">
Note that you can only assign 255 colors to any image palette.&#xA0; If you try assigning more, imagecolorallocate() will fail.<br><br>If, for example, you are randomly allocating colors, it will be wise to check if you have used up all of the colors possible.&#xA0; You can use imagecolorclosest() to get the closest assigned color:<br><span class="default">&lt;?php<br>&#xA0; &#xA0;&#xA0; </span><span class="comment">//assign random rgb values<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//r(ed)<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//g(reen)<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//b(lue)<br>&#xA0; &#xA0;&#xA0; //test if we have used up palette<br>&#xA0; &#xA0;&#xA0; </span><span class="keyword">if(</span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">)&gt;=</span><span class="default">255</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//palette used up; pick closest assigned color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//palette NOT used up; assign new color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; }<br></span><span class="default">?&gt;<br></span><br>Also, imagecolorallocate() will assign a new color EVERY time the function is called, even if the color already exists in the palette:<br><span class="default">&lt;?php<br>&#xA0; &#xA0;&#xA0; </span><span class="comment">// [...]<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">); </span><span class="comment">//returns 5<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">); </span><span class="comment">//returns 6<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">); </span><span class="comment">//returns 7<br>&#xA0; &#xA0;&#xA0; // [...]<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">); </span><span class="comment">//returns 23<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">,</span><span class="default">125</span><span class="keyword">); </span><span class="comment">//returns 25<br>&#xA0; &#xA0;&#xA0; // [...]<br>&#xA0; &#xA0;&#xA0; // etc...<br></span><span class="default">?&gt;<br></span><br>So here, imagecolorexact() is useful:<br><span class="default">&lt;?php<br>&#xA0; &#xA0;&#xA0; </span><span class="comment">//see if color already exists<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; if(</span><span class="default">$color</span><span class="keyword">==-</span><span class="default">1</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//color does not exist; allocate a new one<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; }<br></span><span class="default">?&gt;<br></span><br>And, for nerdy-ness sake, we can put the two ideas together:<br><span class="default">&lt;?php<br>&#xA0; &#xA0;&#xA0; </span><span class="comment">//assign random rgb values<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//r(ed)<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//g(reen)<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//b(lue)<br>&#xA0; &#xA0;&#xA0; //get color from palette<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; if(</span><span class="default">$color</span><span class="keyword">==-</span><span class="default">1</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//color does not exist...<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; //test if we have used up palette<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">)&gt;=</span><span class="default">255</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="comment">//palette used up; pick closest assigned color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="comment">//palette NOT used up; assign new color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0;&#xA0; }<br></span><span class="default">?&gt;<br></span><br>Or as a function:<br><span class="default">&lt;?php<br>&#xA0; &#xA0;&#xA0; </span><span class="keyword">function </span><span class="default">createcolor</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">$c1</span><span class="keyword">,</span><span class="default">$c2</span><span class="keyword">,</span><span class="default">$c3</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//get color from palette<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$color</span><span class="keyword">==-</span><span class="default">1</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="comment">//color does not exist...<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; //test if we have used up palette<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">if(</span><span class="default">imagecolorstotal</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">)&gt;=</span><span class="default">255</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//palette used up; pick closest assigned color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//palette NOT used up; assign new color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">, </span><span class="default">$c1</span><span class="keyword">, </span><span class="default">$c2</span><span class="keyword">, </span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$color</span><span class="keyword">;<br>&#xA0; &#xA0;&#xA0; }<br><br>&#xA0; &#xA0;&#xA0; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">1000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) { </span><span class="comment">//1000 because it is significantly greater than 255<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; //assign random rgb values<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$c1 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//r(ed)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$c2 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//g(reen)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$c3 </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">50</span><span class="keyword">,</span><span class="default">200</span><span class="keyword">); </span><span class="comment">//b(lue)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; //generate the color<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color </span><span class="keyword">= </span><span class="default">createcolor</span><span class="keyword">(</span><span class="default">$pic</span><span class="keyword">,</span><span class="default">$c1</span><span class="keyword">,</span><span class="default">$c2</span><span class="keyword">,</span><span class="default">$c3</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//do something with color...<br>&#xA0; &#xA0;&#xA0; </span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.imagecolorallocate.php)

**[â¬† to root](/)**