# odbc_fetch_array



I really liked Ryan&apos;s example so I took it another step and added a recordset class to work with the connection class.  I made slight alterations to the original code as well.  Also note the recordset class takes advantage of php5&apos;s __get property function...<br><br>&lt;%<br>class odbcRecordset {<br>   var $recordcount;<br>   var $currentrow;<br>   var $eof;<br><br>   var $recorddata;<br>   var $query;<br><br>   function odbcConnection(){<br>      $this-&gt;recordcount = 0;<br>      $this-&gt;recorddata = 0;<br>   }<br><br>   function SetData( $newdata, $num_records, $query ) {<br>      $this-&gt;recorddata = $newdata;<br>      $this-&gt;recordcount = $num_records;<br>      $this-&gt;query = $query;<br>      $this-&gt;currentrow = 0;<br>      $this-&gt;set_eof();<br>   }<br><br>   function set_eof() {<br>      $this-&gt;eof = $this-&gt;currentrow &gt;= $this-&gt;recordcount;<br>   }<br><br>   function movenext()  { if ($this-&gt;currentrow &lt; $this-&gt;recordcount) { $this-&gt;currentrow++; $this-&gt;set_eof(); } }<br>   function moveprev()  { if ($this-&gt;currentrow &gt; 0)                  { $this-&gt;currentrow--; $this-&gt;set_eof(); } }<br>   function movefirst() { $this-&gt;currentrow = 0; set_eof();                                               }<br>   function movelast()  { $this-&gt;currentrow = $this-&gt;recordcount - 1;  set_eof();                         }<br><br>   function data($field_name) {<br>      if (isset($this-&gt;recorddata[$this-&gt;currentrow][$field_name])) {<br>         $thisVal = $this-&gt;recorddata[$this-&gt;currentrow][$field_name];<br>      } else if ($this-&gt;eof) {<br>         die("&lt;B&gt;Error!&lt;/B&gt; eof of recordset was reached");<br>      } else {<br>         die("&lt;B&gt;Error!&lt;/B&gt; Field &lt;B&gt;" . $field_name . "&lt;/B&gt; was not found in the current recordset from query:&lt;br&gt;&lt;br&gt;$this-&gt;query");<br>      }<br><br>      return $thisVal;<br>   } <br><br>   function __get($field_name) {<br>      return $this-&gt;data($field_name);<br>   } <br>}<br><br>class odbcConnection {<br>   var $user;  //Username for the database<br>   var $pass; //Password<br><br>   var $conn_handle; //Connection handle<br>   var $temp_fieldnames; //Tempory array used to store the fieldnames, makes parsing returned data easier.<br>   <br>   function odbcConnection(){<br>      $this-&gt;user = "";<br>      $this-&gt;pass = "";<br>   }<br>   <br>   function open($dsn,$user,$pass){<br>      $handle = @odbc_connect($dsn,$user,$pass,SQL_CUR_USE_ODBC) or<br>         die("&lt;B&gt;Error!&lt;/B&gt; Couldn&apos;t Connect To Database. Error Code:  ".odbc_error());<br>      $this-&gt;conn_handle = $handle;<br>      return true;<br>   }<br>   <br>   function &amp;execute($query){<br>      //Create a temp recordset<br>      $newRS = new odbcRecordset;<br>      $thisData = "";<br><br>      $res = @odbc_exec($this-&gt;conn_handle,$query) or<br>         die("&lt;B&gt;Error!&lt;/B&gt; Couldn&apos;t Run Query:&lt;br&gt;&lt;br&gt;" . $query . "&lt;br&gt;&lt;br&gt;Error Code:  ".odbc_error());<br>      unset($this-&gt;temp_fieldnames);<br><br>      $i = 0;<br>      $j = 0;<br>      $num_rows = 0;<br><br>      // only populate select queries<br>      if (stripos($query, &apos;select &apos;) !== false) {<br>         while(odbc_fetch_row($res)) {<br>            $num_rows++;<br>   <br>            //Build tempory<br>            for ($j = 1; $j &lt;= odbc_num_fields($res); $j++) {<br>               $field_name = odbc_field_name($res, $j);<br>               $this-&gt;temp_fieldnames[$j] = $field_name;<br>               $ar[$field_name] = odbc_result($res, $field_name) . "";<br>            }<br>   <br>            $thisData[$i] = $ar;<br>            $i++;<br>         }<br>      }<br>      <br>      //populate the recordset and return it<br>      $newRS-&gt;SetData( $thisData, $num_rows, $query );<br>      return $newRS;<br>   }<br>}<br>%&gt;<br><br>usage is pretty simple:<br><br>&lt;%<br>  $con = new odbcConnection<br>  $con-&gt;open("dsn","user","pass")<br><br>  $sql = "select bar from foo";<br>  $rs = $con-&gt;execute($sql);<br><br>  if (!$rs-&gt;eof) {<br>    print $rs-&gt;data("bar");<br>      // or //<br>    print $rs-&gt;bar;<br>  }<br><br>  while (!$rs-&gt;eof) {<br>    // blah blah code<br>    $rs-&gt;movenext();<br>  }<br>%&gt;<br><br>Works pretty well, but I haven&apos;t thoughly tested it yet.<br>Code can be dl&apos;d here:<br><br>http://www.russprince.com/odbc_functions.zip<br><br>Cheers,<br>Russ  

---

[Official documentation page](https://www.php.net/manual/en/function.odbc-fetch-array.php)

**[To root](/README.md)**