# openssl_random_pseudo_bytes




<div class="phpcode"><span class="html">
Here&apos;s an example to show the distribution of random numbers as an image. Credit to Hayley Watson at the mt_rand page for the original comparison between rand and mt_rand.<br><br>rand is red, mt_rand is green and openssl_random_pseudo_bytes is blue.<br><br>NOTE: This is only a basic representation of the distribution of the data. Has nothing to do with the strength of the algorithms or their reliability.<br><br><span class="default">&lt;?php<br>header</span><span class="keyword">(</span><span class="string">&quot;Content-type: image/png&quot;</span><span class="keyword">);<br></span><span class="default">$sizex</span><span class="keyword">=</span><span class="default">800</span><span class="keyword">;<br></span><span class="default">$sizey</span><span class="keyword">=</span><span class="default">800</span><span class="keyword">;<br><br></span><span class="default">$img </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">3 </span><span class="keyword">* </span><span class="default">$sizex</span><span class="keyword">,</span><span class="default">$sizey</span><span class="keyword">);<br></span><span class="default">$r </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">$g </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br></span><span class="default">$b </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">);<br></span><span class="default">imagefilledrectangle</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3 </span><span class="keyword">* </span><span class="default">$sizex</span><span class="keyword">, </span><span class="default">$sizey</span><span class="keyword">, </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">));<br><br></span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&#xA0; &#xA0; </span><span class="default">$np </span><span class="keyword">= </span><span class="default">rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$sizex</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">, </span><span class="default">$np</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">$np</span><span class="keyword">;<br>}<br><br></span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&#xA0; &#xA0; </span><span class="default">$np </span><span class="keyword">= </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">,</span><span class="default">$sizex</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$p </span><span class="keyword">+ </span><span class="default">$sizex</span><span class="keyword">, </span><span class="default">$np</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">$np</span><span class="keyword">;<br>}<br><br></span><span class="default">$p </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">100000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br>&#xA0; &#xA0; </span><span class="default">$np </span><span class="keyword">= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$sizex</span><span class="keyword">*(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">openssl_random_pseudo_bytes</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">)))/</span><span class="default">0xffffffff</span><span class="keyword">));<br>&#xA0; &#xA0; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$p </span><span class="keyword">+ (</span><span class="default">2</span><span class="keyword">*</span><span class="default">$sizex</span><span class="keyword">), </span><span class="default">$np</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$p </span><span class="keyword">= </span><span class="default">$np</span><span class="keyword">;<br>}<br><br></span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br></span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
[Editor&apos;s note: the bug has been fixed as of PHP 5.4.44, 5.5.28 and PHP 5.6.12]
<br>
<br>Until PHP 5.6 openssl_random_pseudo_bytes() did NOT use a &quot;cryptographically strong algorithm&quot;! 
<br>See bug report <a href="https://bugs.php.net/bug.php?id=70014" rel="nofollow" target="_blank">https://bugs.php.net/bug.php?id=70014</a> and the corresponding source code at <a href="https://github.com/php/php-src/blob/php-5.6.10/ext/openssl/openssl.c#L5408" rel="nofollow" target="_blank">https://github.com/php/php-src/blob/php-5.6.10/ext/openssl/openssl.c#L5408</a></span>
</div>
  

#


<div class="phpcode"><span class="html">
Another replacement for rand() using OpenSSL.<br><br>Note that a solution where the result is truncated using the modulo operator ( % ) is not cryptographically secure, as the generated numbers are not equally distributed, i.e. some numbers may occur more often than others.<br><br>A better solution than using the modulo operator is to drop the result if it is too large and generate a new one.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">crypto_rand_secure</span><span class="keyword">(</span><span class="default">$min</span><span class="keyword">, </span><span class="default">$max</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$range </span><span class="keyword">= </span><span class="default">$max </span><span class="keyword">- </span><span class="default">$min</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$range </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) return </span><span class="default">$min</span><span class="keyword">; </span><span class="comment">// not so random...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$log </span><span class="keyword">= </span><span class="default">log</span><span class="keyword">(</span><span class="default">$range</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bytes </span><span class="keyword">= (int) (</span><span class="default">$log </span><span class="keyword">/ </span><span class="default">8</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">; </span><span class="comment">// length in bytes<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bits </span><span class="keyword">= (int) </span><span class="default">$log </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">; </span><span class="comment">// length in bits<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$filter </span><span class="keyword">= (int) (</span><span class="default">1 </span><span class="keyword">&lt;&lt; </span><span class="default">$bits</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">; </span><span class="comment">// set all lower bits to 1<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">do {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$rnd </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">openssl_random_pseudo_bytes</span><span class="keyword">(</span><span class="default">$bytes</span><span class="keyword">, </span><span class="default">$s</span><span class="keyword">)));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$rnd </span><span class="keyword">= </span><span class="default">$rnd </span><span class="keyword">&amp; </span><span class="default">$filter</span><span class="keyword">; </span><span class="comment">// discard irrelevant bits<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">} while (</span><span class="default">$rnd </span><span class="keyword">&gt;= </span><span class="default">$range</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$min </span><span class="keyword">+ </span><span class="default">$rnd</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.openssl-random-pseudo-bytes.php)

**[To root](/README.md)**