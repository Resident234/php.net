# realpath




<div class="phpcode"><span class="html">
Because realpath() does not work on files that do not<br>exist, I wrote a function that does.<br>It replaces (consecutive) occurences of / and \\ with<br>whatever is in DIRECTORY_SEPARATOR, and processes /. and /.. fine.<br>Paths returned by get_absolute_path() contain no<br>(back)slash at position 0 (beginning of the string) or<br>position -1 (ending)<br><span class="default">&lt;?php<br>&#xA0; &#xA0; </span><span class="keyword">function </span><span class="default">get_absolute_path</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="string">&apos;\\&apos;</span><span class="keyword">), </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">array_filter</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">), </span><span class="string">&apos;strlen&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$absolutes </span><span class="keyword">= array();<br>&#xA0; &#xA0; &#xA0; &#xA0; foreach (</span><span class="default">$parts </span><span class="keyword">as </span><span class="default">$part</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="string">&apos;.&apos; </span><span class="keyword">== </span><span class="default">$part</span><span class="keyword">) continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="string">&apos;..&apos; </span><span class="keyword">== </span><span class="default">$part</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$absolutes</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$absolutes</span><span class="keyword">[] = </span><span class="default">$part</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">implode</span><span class="keyword">(</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$absolutes</span><span class="keyword">);<br>&#xA0; &#xA0; }<br></span><span class="default">?&gt;<br></span><br>A test:<br><span class="default">&lt;?php<br>&#xA0; &#xA0; var_dump</span><span class="keyword">(</span><span class="default">get_absolute_path</span><span class="keyword">(</span><span class="string">&apos;this/is/../a/./test/.///is&apos;</span><span class="keyword">));<br></span><span class="default">?&gt;<br></span>Returns: string(14) &quot;this/a/test/is&quot; <br><br>As you can so, it also produces Yoda-speak. :)</span>
</div>
  

#


<div class="phpcode"><span class="html">
<span class="default">&lt;?php<br><br></span><span class="keyword">namespace </span><span class="default">MockingMagician</span><span class="keyword">\</span><span class="default">Organic</span><span class="keyword">\</span><span class="default">Helper</span><span class="keyword">;<br><br>class </span><span class="default">Path<br></span><span class="keyword">{<br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0;&#xA0; * There is a method that deal with Sven Arduwie proposal <a href="https://www.php.net/manual/en/function.realpath.php#84012" rel="nofollow" target="_blank">https://www.php.net/manual/en/function.realpath.php#84012</a><br>&#xA0; &#xA0;&#xA0; * And runeimp at gmail dot com proposal <a href="https://www.php.net/manual/en/function.realpath.php#112367" rel="nofollow" target="_blank">https://www.php.net/manual/en/function.realpath.php#112367</a><br>&#xA0; &#xA0;&#xA0; * @param string $path<br>&#xA0; &#xA0;&#xA0; * @return string<br>&#xA0; &#xA0;&#xA0; */<br>&#xA0; &#xA0; </span><span class="keyword">public static function </span><span class="default">getAbsolute</span><span class="keyword">(</span><span class="default">string $path</span><span class="keyword">): </span><span class="default">string<br>&#xA0; &#xA0; </span><span class="keyword">{<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Cleaning path regarding OS<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">mb_ereg_replace</span><span class="keyword">(</span><span class="string">&apos;\\\\|/&apos;</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="string">&apos;msr&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Check if path start with a separator (UNIX)<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$startWithSeparator </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] === </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Check if start with drive letter<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;/^[a-z]:/&apos;</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$startWithLetterDir </span><span class="keyword">= isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) ? </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] : </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Get and filter empty sub paths<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$subPaths </span><span class="keyword">= </span><span class="default">array_filter</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">), </span><span class="string">&apos;mb_strlen&apos;</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$absolutes </span><span class="keyword">= [];<br>&#xA0; &#xA0; &#xA0; &#xA0; foreach (</span><span class="default">$subPaths </span><span class="keyword">as </span><span class="default">$subPath</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="string">&apos;.&apos; </span><span class="keyword">=== </span><span class="default">$subPath</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// if $startWithSeparator is false<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // and $startWithLetterDir<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // and (absolutes is empty or all previous values are ..)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // save absolute cause that&apos;s a relative and we can&apos;t deal with that and just forget that we want go up<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if (</span><span class="string">&apos;..&apos; </span><span class="keyword">=== </span><span class="default">$subPath<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">&amp;&amp; !</span><span class="default">$startWithSeparator<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">&amp;&amp; !</span><span class="default">$startWithLetterDir<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">&amp;&amp; empty(</span><span class="default">array_filter</span><span class="keyword">(</span><span class="default">$absolutes</span><span class="keyword">, function (</span><span class="default">$value</span><span class="keyword">) { return !(</span><span class="string">&apos;..&apos; </span><span class="keyword">=== </span><span class="default">$value</span><span class="keyword">); }))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$absolutes</span><span class="keyword">[] = </span><span class="default">$subPath</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="string">&apos;..&apos; </span><span class="keyword">=== </span><span class="default">$subPath</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$absolutes</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$absolutes</span><span class="keyword">[] = </span><span class="default">$subPath</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ((</span><span class="default">$startWithSeparator </span><span class="keyword">? </span><span class="default">DIRECTORY_SEPARATOR </span><span class="keyword">: </span><span class="default">$startWithLetterDir</span><span class="keyword">) ?<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$startWithLetterDir</span><span class="keyword">.</span><span class="default">DIRECTORY_SEPARATOR </span><span class="keyword">: </span><span class="string">&apos;&apos;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">).</span><span class="default">implode</span><span class="keyword">(</span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$absolutes</span><span class="keyword">);<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0;&#xA0; * Examples<br>&#xA0; &#xA0;&#xA0; *<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;/one/two/../two/./three/../../two&apos;);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; =&gt;&#xA0; &#xA0; /one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;../one/two/../two/./three/../../two&apos;);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; =&gt;&#xA0; &#xA0; ../one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;../.././../one/two/../two/./three/../../two&apos;);&#xA0; =&gt;&#xA0; &#xA0; ../../../one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;../././../one/two/../two/./three/../../two&apos;);&#xA0;&#xA0; =&gt;&#xA0; &#xA0; ../../one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;/../one/two/../two/./three/../../two&apos;);&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; =&gt;&#xA0; &#xA0; /one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;/../../one/two/../two/./three/../../two&apos;);&#xA0; &#xA0; &#xA0; =&gt;&#xA0; &#xA0; /one/two<br>&#xA0; &#xA0;&#xA0; * echo Path::getAbsolute(&apos;c:\.\..\one\two\..\two\.\three\..\..\two&apos;);&#xA0; &#xA0;&#xA0; =&gt;&#xA0; &#xA0; c:/one/two<br>&#xA0; &#xA0;&#xA0; *<br>&#xA0; &#xA0;&#xA0; */<br></span><span class="keyword">}</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Needed a method to normalize a virtual path that could handle .. references that go beyond the initial folder reference. So I created the following.<br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">normalizePath</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$parts </span><span class="keyword">= array();</span><span class="comment">// Array to build a new path from the good parts<br>&#xA0; &#xA0; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&apos;\\&apos;</span><span class="keyword">, </span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);</span><span class="comment">// Replace backslashes with forwardslashes<br>&#xA0; &#xA0; </span><span class="default">$path </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;/\/+/&apos;</span><span class="keyword">, </span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);</span><span class="comment">// Combine multiple slashes into a single slash<br>&#xA0; &#xA0; </span><span class="default">$segments </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">);</span><span class="comment">// Collect path segments<br>&#xA0; &#xA0; </span><span class="default">$test </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;</span><span class="comment">// Initialize testing variable<br>&#xA0; &#xA0; </span><span class="keyword">foreach(</span><span class="default">$segments </span><span class="keyword">as </span><span class="default">$segment</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$segment </span><span class="keyword">!= </span><span class="string">&apos;.&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$test </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$test</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$segment</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; else if(</span><span class="default">$segment </span><span class="keyword">== </span><span class="string">&apos;..&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$test </span><span class="keyword">== </span><span class="string">&apos;..&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$test</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$test </span><span class="keyword">== </span><span class="string">&apos;..&apos; </span><span class="keyword">|| </span><span class="default">$test </span><span class="keyword">== </span><span class="string">&apos;&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$segment</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$test</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$segment</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>Will convert /path/to/test/.././..//..///..///../one/two/../three/filename<br>to ../../one/three/filename</span>
</div>
  

#


<div class="phpcode"><span class="html">
Note: If you use this to check if a file exists, it&apos;s path will be cached, and returns true even if the file is removed (use file_exists instead).</span>
</div>
  

#


<div class="phpcode"><span class="html">
Here&apos;s a function to canonicalize a URL containing relative paths. Ran into the problem when pulling links from a remote page.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">canonicalize</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$address </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$keys </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">, </span><span class="string">&apos;..&apos;</span><span class="keyword">);<br><br>&#xA0; &#xA0; foreach(</span><span class="default">$keys </span><span class="keyword">AS </span><span class="default">$keypos </span><span class="keyword">=&gt; </span><span class="default">$key</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">, </span><span class="default">$key </span><span class="keyword">- (</span><span class="default">$keypos </span><span class="keyword">* </span><span class="default">2 </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">);<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="default">$address </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="string">&apos;/&apos;</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$address </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&apos;./&apos;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$address</span><span class="keyword">);<br>}<br><br></span><span class="default">$url </span><span class="keyword">= </span><span class="string">&apos;<a href="http://www.example.com/something/../else" rel="nofollow" target="_blank">http://www.example.com/something/../else</a>&apos;</span><span class="keyword">;<br>echo </span><span class="default">canonicalize</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">); </span><span class="comment">//<a href="http://www.example.com/else" rel="nofollow" target="_blank">http://www.example.com/else</a><br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.realpath.php)

**[â¬† to root](/)**