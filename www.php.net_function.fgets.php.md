# fgets




<div class="phpcode"><span class="html">
A better example, to illustrate the differences in speed for large files, between fgets and stream_get_line.<br><br>This example simulates situations where you are reading potentially very long lines, of an uncertain length (but with a maximum buffer size), from an input source.<br><br>As Dade pointed out, the previous example I provided was much to easy to pick apart, and did not adequately highlight the issue I was trying to address.<br><br>Note that specifying a definitive end-character for fgets (ie: newline), generally decreases the speed difference reasonably significantly. <br><br>#!/usr/bin/php<br><span class="default">&lt;?php<br>&#xA0; &#xA0; &#xA0; &#xA0; $plaintext</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">&apos;<a href="http://loripsum.net/api/60/verylong/plaintext" rel="nofollow" target="_blank">http://loripsum.net/api/60/verylong/plaintext</a>&apos;</span><span class="keyword">);&#xA0; </span><span class="comment"># Should be around 90k characters<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$plaintext</span><span class="keyword">=</span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&quot;\n&quot;</span><span class="keyword">,</span><span class="string">&quot; &quot;</span><span class="keyword">,</span><span class="default">$plaintext</span><span class="keyword">); </span><span class="comment"># Get rid of newlines<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">&quot;/tmp/SourceFile.txt&quot;</span><span class="keyword">,</span><span class="string">&quot;w&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">100000</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fputs</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$plaintext</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">rand</span><span class="keyword">(</span><span class="default">4096</span><span class="keyword">,</span><span class="default">65534</span><span class="keyword">)) . </span><span class="string">&quot;\n&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">&quot;/tmp/SourceFile.txt&quot;</span><span class="keyword">,</span><span class="string">&quot;r&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$start</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; while(</span><span class="default">$line</span><span class="keyword">=</span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">65535</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$end</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta1</span><span class="keyword">=(</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$fp</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">&quot;/tmp/SourceFile.txt&quot;</span><span class="keyword">,</span><span class="string">&quot;r&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$start</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; while(</span><span class="default">$line</span><span class="keyword">=</span><span class="default">stream_get_line</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">65535</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$end</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta2</span><span class="keyword">=(</span><span class="default">$end </span><span class="keyword">- </span><span class="default">$start</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$pdiff</span><span class="keyword">=</span><span class="default">$delta1</span><span class="keyword">/</span><span class="default">$delta2</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; print </span><span class="string">&quot;stream_get_line is &quot; </span><span class="keyword">. (</span><span class="default">$pdiff</span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">?</span><span class="string">&quot;faster&quot;</span><span class="keyword">:</span><span class="string">&quot;slower&quot;</span><span class="keyword">) . </span><span class="string">&quot; than fgets - pdiff is </span><span class="default">$pdiff</span><span class="string">\n&quot;</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>$ ./testcase.php <br>stream_get_line is faster than fgets - pdiff is 1.760398041785<br><br>Note that, in a vast majority of situations in which php is employed, tiny differences in speed between system calls are of negligible importance.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.fgets.php)

**[To root](/README.md)**