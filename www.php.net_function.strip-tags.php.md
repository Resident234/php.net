# strip_tags




<div class="phpcode"><span class="html">
Hi. I made a function that removes the HTML tags along with their contents:
<br>
<br>Function:
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">strip_tags_content</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">$tags </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$invert </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">) {
<br>
<br>&#xA0; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">&apos;/&lt;(.+?)[\s]*\/?[\s]*&gt;/si&apos;</span><span class="keyword">, </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">), </span><span class="default">$tags</span><span class="keyword">);
<br>&#xA0; </span><span class="default">$tags </span><span class="keyword">= </span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);
<br>&#xA0; &#xA0; 
<br>&#xA0; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) AND </span><span class="default">count</span><span class="keyword">(</span><span class="default">$tags</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {
<br>&#xA0; &#xA0; if(</span><span class="default">$invert </span><span class="keyword">== </span><span class="default">FALSE</span><span class="keyword">) {
<br>&#xA0; &#xA0; &#xA0; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;@&lt;(?!(?:&apos;</span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">&apos;|&apos;</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">) .</span><span class="string">&apos;)\b)(\w+)\b.*?&gt;.*?&lt;/\1&gt;@si&apos;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br>&#xA0; &#xA0; }
<br>&#xA0; &#xA0; else {
<br>&#xA0; &#xA0; &#xA0; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;@&lt;(&apos;</span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">&apos;|&apos;</span><span class="keyword">, </span><span class="default">$tags</span><span class="keyword">) .</span><span class="string">&apos;)\b.*?&gt;.*?&lt;/\1&gt;@si&apos;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br>&#xA0; &#xA0; }
<br>&#xA0; }
<br>&#xA0; elseif(</span><span class="default">$invert </span><span class="keyword">== </span><span class="default">FALSE</span><span class="keyword">) {
<br>&#xA0; &#xA0; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;@&lt;(\w+)\b.*?&gt;.*?&lt;/\1&gt;@si&apos;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$text</span><span class="keyword">);
<br>&#xA0; }
<br>&#xA0; return </span><span class="default">$text</span><span class="keyword">;
<br>}
<br></span><span class="default">?&gt;
<br></span>
<br>Sample text:
<br>$text = &apos;&lt;b&gt;sample&lt;/b&gt; text with &lt;div&gt;tags&lt;/div&gt;&apos;;
<br>
<br>Result for strip_tags($text):
<br>sample text with tags
<br>
<br>Result for strip_tags_content($text):
<br> text with 
<br>
<br>Result for strip_tags_content($text, &apos;&lt;b&gt;&apos;):
<br>&lt;b&gt;sample&lt;/b&gt; text with 
<br>
<br>Result for strip_tags_content($text, &apos;&lt;b&gt;&apos;, TRUE);
<br> text with &lt;div&gt;tags&lt;/div&gt;
<br>
<br>I hope that someone is useful :)</span>
</div>
  

#


<div class="phpcode"><span class="html">
Since strip_tags does not remove attributes and thus creates a potential XSS security hole, here is a small function I wrote to allow only specific tags with specific attributes and strip all other tags and attributes.<br><br>If you only allow formatting tags such as b, i, and p, and styling attributes such as class, id and style, this will strip all javascript including event triggers in formatting tags.<br><br>Note that allowing anchor tags or href attributes opens another potential security hole that this solution won&apos;t protect against. You&apos;ll need more comprehensive protection if you plan to allow links in your text.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">stripUnwantedTagsAndAttrs</span><span class="keyword">(</span><span class="default">$html_str</span><span class="keyword">){<br>&#xA0; </span><span class="default">$xml </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">();<br></span><span class="comment">//Suppress warnings: proper error handling is beyond scope of example<br>&#xA0; </span><span class="default">libxml_use_internal_errors</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br></span><span class="comment">//List the tags you want to allow here, NOTE you MUST allow html and body otherwise entire string will be cleared<br>&#xA0; </span><span class="default">$allowed_tags </span><span class="keyword">= array(</span><span class="string">&quot;html&quot;</span><span class="keyword">, </span><span class="string">&quot;body&quot;</span><span class="keyword">, </span><span class="string">&quot;b&quot;</span><span class="keyword">, </span><span class="string">&quot;br&quot;</span><span class="keyword">, </span><span class="string">&quot;em&quot;</span><span class="keyword">, </span><span class="string">&quot;hr&quot;</span><span class="keyword">, </span><span class="string">&quot;i&quot;</span><span class="keyword">, </span><span class="string">&quot;li&quot;</span><span class="keyword">, </span><span class="string">&quot;ol&quot;</span><span class="keyword">, </span><span class="string">&quot;p&quot;</span><span class="keyword">, </span><span class="string">&quot;s&quot;</span><span class="keyword">, </span><span class="string">&quot;span&quot;</span><span class="keyword">, </span><span class="string">&quot;table&quot;</span><span class="keyword">, </span><span class="string">&quot;tr&quot;</span><span class="keyword">, </span><span class="string">&quot;td&quot;</span><span class="keyword">, </span><span class="string">&quot;u&quot;</span><span class="keyword">, </span><span class="string">&quot;ul&quot;</span><span class="keyword">);<br></span><span class="comment">//List the attributes you want to allow here<br>&#xA0; </span><span class="default">$allowed_attrs </span><span class="keyword">= array (</span><span class="string">&quot;class&quot;</span><span class="keyword">, </span><span class="string">&quot;id&quot;</span><span class="keyword">, </span><span class="string">&quot;style&quot;</span><span class="keyword">);<br>&#xA0; if (!</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$html_str</span><span class="keyword">)){return </span><span class="default">false</span><span class="keyword">;}<br>&#xA0; if (</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">loadHTML</span><span class="keyword">(</span><span class="default">$html_str</span><span class="keyword">, </span><span class="default">LIBXML_HTML_NOIMPLIED </span><span class="keyword">| </span><span class="default">LIBXML_HTML_NODEFDTD</span><span class="keyword">)){<br>&#xA0; &#xA0; foreach (</span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="string">&quot;*&quot;</span><span class="keyword">) as </span><span class="default">$tag</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">-&gt;</span><span class="default">tagName</span><span class="keyword">, </span><span class="default">$allowed_tags</span><span class="keyword">)){<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tag</span><span class="keyword">-&gt;</span><span class="default">parentNode</span><span class="keyword">-&gt;</span><span class="default">removeChild</span><span class="keyword">(</span><span class="default">$tag</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; }else{<br>&#xA0; &#xA0; &#xA0; &#xA0; foreach (</span><span class="default">$tag</span><span class="keyword">-&gt;</span><span class="default">attributes </span><span class="keyword">as </span><span class="default">$attr</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$attr</span><span class="keyword">-&gt;</span><span class="default">nodeName</span><span class="keyword">, </span><span class="default">$allowed_attrs</span><span class="keyword">)){<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tag</span><span class="keyword">-&gt;</span><span class="default">removeAttribute</span><span class="keyword">(</span><span class="default">$attr</span><span class="keyword">-&gt;</span><span class="default">nodeName</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; }<br>&#xA0; return </span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">saveHTML</span><span class="keyword">();<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
A word of caution. strip_tags() can actually be used for input validation as long as you remove ANY tag. As soon as you accept a single tag (2nd parameter), you are opening up a security hole such as this:<br><br>&lt;acceptedTag onLoad=&quot;javascript:malicious()&quot; /&gt;<br><br>Plus: regexing away attributes or code block is really not the right solution. For effective input validation when using strip_tags() with even a single tag accepted, <a href="http://htmlpurifier.org/" rel="nofollow" target="_blank">http://htmlpurifier.org/</a> is the way to go.</span>
</div>
  

#


<div class="phpcode"><span class="html">
a HTML code like this: <br><br><span class="default">&lt;?php<br>$html </span><span class="keyword">= </span><span class="string">&apos;<br>&lt;div&gt;<br>&lt;p style=&quot;color:blue;&quot;&gt;color is blue&lt;/p&gt;&lt;p&gt;size is &lt;span style=&quot;font-size:200%;&quot;&gt;huge&lt;/span&gt;&lt;/p&gt;<br>&lt;p&gt;material is wood&lt;/p&gt;<br>&lt;/div&gt;<br>&apos;</span><span class="keyword">; <br></span><span class="default">?&gt;<br></span><br>with <span class="default">&lt;?php $str </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">); </span><span class="default">?&gt;<br></span>... the result is:<br><br>$str = &apos;color is bluesize is huge<br>material is wood&apos;; <br><br>notice: the words &apos;blue&apos; and &apos;size&apos; grow together :( <br>and line-breaks are still in new string $str<br><br>if you need a space between the words (and without line-break) <br>use my function: <span class="default">&lt;?php $str </span><span class="keyword">= </span><span class="default">rip_tags</span><span class="keyword">(</span><span class="default">$html</span><span class="keyword">); </span><span class="default">?&gt;<br></span>... the result is:<br><br>$str = &apos;color is blue size is huge material is wood&apos;; <br><br>the function: <br><br><span class="default">&lt;?php<br></span><span class="comment">// -------------------------------------------------------------- <br><br></span><span class="keyword">function </span><span class="default">rip_tags</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">) { <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">// ----- remove HTML TAGs ----- <br>&#xA0; &#xA0; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">preg_replace </span><span class="keyword">(</span><span class="string">&apos;/&lt;[^&gt;]*&gt;/&apos;</span><span class="keyword">, </span><span class="string">&apos; &apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">); <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">// ----- remove control characters ----- <br>&#xA0; &#xA0; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&quot;\r&quot;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">// --- replace with empty space<br>&#xA0; &#xA0; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&quot;\n&quot;</span><span class="keyword">, </span><span class="string">&apos; &apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);&#xA0;&#xA0; </span><span class="comment">// --- replace with space<br>&#xA0; &#xA0; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">&quot;\t&quot;</span><span class="keyword">, </span><span class="string">&apos; &apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);&#xA0;&#xA0; </span><span class="comment">// --- replace with space<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; // ----- remove multiple spaces ----- <br>&#xA0; &#xA0; </span><span class="default">$string </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;/ {2,}/&apos;</span><span class="keyword">, </span><span class="string">&apos; &apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">));<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; return </span><span class="default">$string</span><span class="keyword">; <br><br>}<br><br></span><span class="comment">// -------------------------------------------------------------- <br></span><span class="default">?&gt;<br></span><br>the KEY is the regex pattern: &apos;/&lt;[^&gt;]*&gt;/&apos;<br>instead of strip_tags() <br>... then remove control characters and multiple spaces<br>:)</span>
</div>
  

#


<div class="phpcode"><span class="html">
&quot;5.3.4&#xA0; &#xA0; strip_tags() no longer strips self-closing XHTML tags unless the self-closing XHTML tag is also given in allowable_tags.&quot;<br><br>This is poorly worded.<br><br>The above seems to be saying that, since 5.3.4, if you don&apos;t specify &quot;&lt;br/&gt;&quot; in allowable_tags then &quot;&lt;br/&gt;&quot; will not be stripped... but that&apos;s not actually what they&apos;re trying to say.<br><br>What it means is, in versions prior to 5.3.4, it &quot;strips self-closing XHTML tags unless the self-closing XHTML tag is also given in allowable_tags&quot;, and that since 5.3.4 this is no longer the case.<br><br>So what reads as &quot;no longer strips self-closing tags (unless the self-closing XHTML tag is also given in allowable_tags)&quot; is actually saying &quot;no longer (strips self-closing tags unless the self-closing XHTML tag is also given in allowable_tags)&quot;.<br><br>i.e.<br><br>pre-5.3.4: strip_tags(&apos;Hello World&lt;br&gt;&lt;br/&gt;&apos;,&apos;&lt;br&gt;&apos;) =&gt; &apos;Hello World&lt;br&gt;&apos; // strips &lt;br/&gt; because it wasn&apos;t explicitly specified in allowable_tags<br><br>5.3.4 and later: strip_tags(&apos;Hello World&lt;br&gt;&lt;br/&gt;&apos;,&apos;&lt;br&gt;&apos;) =&gt; &apos;Hello World&lt;br&gt;&lt;br/&gt;&apos; // does not strip &lt;br/&gt; because PHP matches it with &lt;br&gt; in allowable_tags</span>
</div>
  

#


<div class="phpcode"><span class="html">
Note the different outputs from different versions of the same tag:
<br>
<br><span class="default">&lt;?php </span><span class="comment">// striptags.php
<br></span><span class="default">$data </span><span class="keyword">= </span><span class="string">&apos;&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line&apos;</span><span class="keyword">;
<br></span><span class="default">$new&#xA0; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">&apos;&lt;br&gt;&apos;</span><span class="keyword">);
<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">);&#xA0; </span><span class="comment">// OUTPUTS string(21) &quot;&lt;br&gt;EachNew&lt;br /&gt;Line&quot;
<br>
<br></span><span class="keyword">&lt;?</span><span class="default">php </span><span class="comment">// striptags.php
<br></span><span class="default">$data </span><span class="keyword">= </span><span class="string">&apos;&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line&apos;</span><span class="keyword">;
<br></span><span class="default">$new&#xA0; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">&apos;&lt;br/&gt;&apos;</span><span class="keyword">);
<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); </span><span class="comment">// OUTPUTS string(16) &quot;Each&lt;br/&gt;NewLine&quot;
<br>
<br></span><span class="keyword">&lt;?</span><span class="default">php </span><span class="comment">// striptags.php
<br></span><span class="default">$data </span><span class="keyword">= </span><span class="string">&apos;&lt;br&gt;Each&lt;br/&gt;New&lt;br /&gt;Line&apos;</span><span class="keyword">;
<br></span><span class="default">$new&#xA0; </span><span class="keyword">= </span><span class="default">strip_tags</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, </span><span class="string">&apos;&lt;br /&gt;&apos;</span><span class="keyword">);
<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new</span><span class="keyword">); </span><span class="comment">// OUTPUTS string(11) &quot;EachNewLine&quot;
<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Features:<br>* allowable tags (as in strip_tags),<br>* optional stripping attributes of the allowable tags,<br>* optional comment preserving,<br>* deleting broken and unclosed tags and comments,<br>* optional callback function call for every piece processed allowing for flexible replacements.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">better_strip_tags</span><span class="keyword">( </span><span class="default">$str</span><span class="keyword">, </span><span class="default">$allowable_tags </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$strip_attrs </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$preserve_comments </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, callable </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">null </span><span class="keyword">) {<br>&#xA0; </span><span class="default">$allowable_tags </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">( </span><span class="string">&apos;strtolower&apos;</span><span class="keyword">, </span><span class="default">array_filter</span><span class="keyword">( </span><span class="comment">// lowercase<br>&#xA0; &#xA0; &#xA0; </span><span class="default">preg_split</span><span class="keyword">( </span><span class="string">&apos;/(?:&gt;|^)\\s*(?:&lt;|$)/&apos;</span><span class="keyword">, </span><span class="default">$allowable_tags</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY </span><span class="keyword">), </span><span class="comment">// get tag names<br>&#xA0; &#xA0; &#xA0; </span><span class="keyword">function( </span><span class="default">$tag </span><span class="keyword">) { return </span><span class="default">preg_match</span><span class="keyword">( </span><span class="string">&apos;/^[a-z][a-z0-9_]*$/i&apos;</span><span class="keyword">, </span><span class="default">$tag </span><span class="keyword">); } </span><span class="comment">// filter broken<br>&#xA0; </span><span class="keyword">) );<br>&#xA0; </span><span class="default">$comments_and_stuff </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">( </span><span class="string">&apos;/(&lt;!--.*?(?:--&gt;|$))/&apos;</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_DELIM_CAPTURE </span><span class="keyword">);<br>&#xA0; foreach ( </span><span class="default">$comments_and_stuff </span><span class="keyword">as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$comment_or_stuff </span><span class="keyword">) {<br>&#xA0; &#xA0; if ( </span><span class="default">$i </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">) { </span><span class="comment">// html comment<br>&#xA0; &#xA0; &#xA0; </span><span class="keyword">if ( !( </span><span class="default">$preserve_comments </span><span class="keyword">&amp;&amp; </span><span class="default">preg_match</span><span class="keyword">( </span><span class="string">&apos;/&lt;!--.*?--&gt;/&apos;</span><span class="keyword">, </span><span class="default">$comment_or_stuff </span><span class="keyword">) ) ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$comments_and_stuff</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; } else { </span><span class="comment">// stuff between comments<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$tags_and_text </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">( </span><span class="string">&quot;/(&lt;(?:[^&gt;\&quot;&apos;]++|\&quot;[^\&quot;]*+(?:\&quot;|$)|&apos;[^&apos;]*+(?:&apos;|$))*(?:&gt;|$))/&quot;</span><span class="keyword">, </span><span class="default">$comment_or_stuff</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_DELIM_CAPTURE </span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; foreach ( </span><span class="default">$tags_and_text </span><span class="keyword">as </span><span class="default">$j </span><span class="keyword">=&gt; </span><span class="default">$tag_or_text </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$is_broken </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$is_allowable </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$tag_or_text</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( </span><span class="default">$j </span><span class="keyword">% </span><span class="default">2 </span><span class="keyword">) { </span><span class="comment">// tag<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if ( </span><span class="default">preg_match</span><span class="keyword">( </span><span class="string">&quot;%^(&lt;/?)([a-z][a-z0-9_]*)\\b(?:[^&gt;\&quot;&apos;/]++|/+?|\&quot;[^\&quot;]*\&quot;|&apos;[^&apos;]*&apos;)*?(/?&gt;)%i&quot;</span><span class="keyword">, </span><span class="default">$tag_or_text</span><span class="keyword">, </span><span class="default">$matches </span><span class="keyword">) ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">( </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] );<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ( </span><span class="default">in_array</span><span class="keyword">( </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$allowable_tags </span><span class="keyword">) ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ( </span><span class="default">$strip_attrs </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$opening </span><span class="keyword">= </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$closing </span><span class="keyword">= ( </span><span class="default">$opening </span><span class="keyword">=== </span><span class="string">&apos;&lt;/&apos; </span><span class="keyword">) ? </span><span class="string">&apos;&gt;&apos; </span><span class="keyword">: </span><span class="default">$closing</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$result </span><span class="keyword">= </span><span class="default">$opening </span><span class="keyword">. </span><span class="default">$tag </span><span class="keyword">. </span><span class="default">$closing</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$is_allowable </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$is_broken </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$result </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; } else { </span><span class="comment">// text<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tag </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( !</span><span class="default">$is_broken </span><span class="keyword">&amp;&amp; isset( </span><span class="default">$callback </span><span class="keyword">) ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// allow result modification<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">call_user_func_array</span><span class="keyword">( </span><span class="default">$callback</span><span class="keyword">, array( &amp;</span><span class="default">$result</span><span class="keyword">, </span><span class="default">$tag_or_text</span><span class="keyword">, </span><span class="default">$tag</span><span class="keyword">, </span><span class="default">$is_allowable </span><span class="keyword">) );<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tags_and_text</span><span class="keyword">[</span><span class="default">$j</span><span class="keyword">] = </span><span class="default">$result</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$comments_and_stuff</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">implode</span><span class="keyword">( </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$tags_and_text </span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; }<br>&#xA0; </span><span class="default">$str </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">( </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$comments_and_stuff </span><span class="keyword">);<br>&#xA0; return </span><span class="default">$str</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Callback arguments:<br>* &amp;$result: contains text to be placed insted of original piece (e.g. empty string for forbidden tags), it can be changed;<br>* $tag_or_text: original piece of text or a tag (see below);<br>* $tag: false for text between tags, lowercase tag name for tags;<br>* $is_allowable: boolean telling if a tag isn&apos;t allowed (to avoid double checking), always true for text between tags<br>Callback function isn&apos;t called for comments and broken tags.<br><br>Caution: the function doesn&apos;t fully validate tags (the more so HTML itself), it just force strips those obviously broken (in addition to stripping forbidden tags). If you want to get valid tags then use strip_attrs option, though it doesn&apos;t guarantee tags are balanced or used in the appropriate context. For complex logic consider using DOM parser.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.strip-tags.php)

**[⬆ to root](/)**