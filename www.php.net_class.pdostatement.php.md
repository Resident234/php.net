# The PDOStatement class




<div class="phpcode"><span class="html">
I don&apos;t know why PDOStatement don&apos;t return &quot;execution time&quot; and &quot;found rows&quot; so here I created an extended class of PDOStatement with these attributes.<br><br>Just have to &quot;setAttribute&quot; of PDO&apos;s object to $PDO-&gt;setAttribute(\PDO::ATTR_STATEMENT_CLASS , [&apos;\customs\PDOStatement&apos;, [&amp;$this]]);<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/**<br>*<br>*<br>*<br>*/<br><br></span><span class="keyword">namespace </span><span class="default">customs</span><span class="keyword">;<br><br></span><span class="comment">/**<br>*<br>*<br>*<br>*/<br><br></span><span class="keyword">final class </span><span class="default">PDOStatement </span><span class="keyword">extends \</span><span class="default">PDOStatement </span><span class="keyword">{<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">protected </span><span class="default">$PDO </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&#xA0; &#xA0; protected </span><span class="default">$inputParams </span><span class="keyword">= [];<br>&#xA0; &#xA0; protected </span><span class="default">$executionTime </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&#xA0; &#xA0; protected </span><span class="default">$resultCount </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">protected function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">PDO </span><span class="keyword">&amp;</span><span class="default">$PDO</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO </span><span class="keyword">= </span><span class="default">$PDO</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executionTime </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">getExecutionError</span><span class="keyword">(</span><span class="default">int $i </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$executionError </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">errorInfo</span><span class="keyword">();<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if (isset(</span><span class="default">$executionError</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$executionError</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">];<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$executionError</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">getExecutionTime</span><span class="keyword">(</span><span class="default">$numberFormat </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$decPoint </span><span class="keyword">= </span><span class="string">&apos;.&apos;</span><span class="keyword">, </span><span class="default">$thousandsSep </span><span class="keyword">= </span><span class="string">&apos;,&apos;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$numberFormat</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executionTime</span><span class="keyword">, </span><span class="default">$numberFormat</span><span class="keyword">, </span><span class="default">$decPoint</span><span class="keyword">, </span><span class="default">$thousandsSep</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executionTime</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">getResultCount</span><span class="keyword">(</span><span class="default">$numberFormat </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$decPoint </span><span class="keyword">= </span><span class="string">&apos;.&apos;</span><span class="keyword">, </span><span class="default">$thousandsSep </span><span class="keyword">= </span><span class="string">&apos;,&apos;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$numberFormat</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resultCount</span><span class="keyword">, </span><span class="default">$numberFormat</span><span class="keyword">, </span><span class="default">$decPoint</span><span class="keyword">, </span><span class="default">$thousandsSep</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resultCount</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">getLastInsertId</span><span class="keyword">() {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">-&gt;</span><span class="default">lastInsertId</span><span class="keyword">();<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">bindValues</span><span class="keyword">(array </span><span class="default">$inputParams</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">inputParams </span><span class="keyword">= </span><span class="default">array_values</span><span class="keyword">(</span><span class="default">$inputParams</span><span class="keyword">) as </span><span class="default">$i </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$varType </span><span class="keyword">= </span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ? \</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_NULL </span><span class="keyword">: </span><span class="default">is_bool</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ? \</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_BOOL </span><span class="keyword">: </span><span class="default">is_int</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) ? \</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_INT </span><span class="keyword">: \</span><span class="default">PDO</span><span class="keyword">::</span><span class="default">PARAM_STR</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bindValue</span><span class="keyword">(++ </span><span class="default">$i</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">, </span><span class="default">$varType</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">execute</span><span class="keyword">(</span><span class="default">$inputParams </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$inputParams</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">inputParams </span><span class="keyword">= </span><span class="default">$inputParams</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$executed </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">execute</span><span class="keyword">(</span><span class="default">$inputParams</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executionTime </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">executionTime</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$executed</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; *<br>&#xA0; &#xA0; */<br><br>&#xA0; &#xA0; </span><span class="keyword">final public function </span><span class="default">fetchAll</span><span class="keyword">(</span><span class="default">$how </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$className </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, </span><span class="default">$ctorArgs </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$resultSet </span><span class="keyword">= </span><span class="default">parent</span><span class="keyword">::</span><span class="default">fetchAll</span><span class="keyword">(... </span><span class="default">func_get_args</span><span class="keyword">());<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if (!empty(</span><span class="default">$resultSet</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$queryString </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">queryString</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$inputParams </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">inputParams</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;/(.*)?LIMIT/is&apos;</span><span class="keyword">, </span><span class="default">$queryString</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$queryString </span><span class="keyword">= </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$queryString </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">&apos;SELECT COUNT(*) AS T FROM (%s) DT&apos;</span><span class="keyword">, </span><span class="default">$queryString</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ((</span><span class="default">$placeholders </span><span class="keyword">= </span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">, </span><span class="string">&apos;?&apos;</span><span class="keyword">)) &lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$inputParams</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$inputParams </span><span class="keyword">= </span><span class="default">array_slice</span><span class="keyword">(</span><span class="default">$inputParams</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$placeholders</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ((</span><span class="default">$sth </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">PDO</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="default">$queryString</span><span class="keyword">)) &amp;&amp; </span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">bindValues</span><span class="keyword">(</span><span class="default">$inputParams</span><span class="keyword">) &amp;&amp; </span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">())<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">resultCount </span><span class="keyword">= </span><span class="default">$sth</span><span class="keyword">-&gt;</span><span class="default">fetchColumn</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$sth </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$resultSet</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/class.pdostatement.php)

**[To root](/README.md)**