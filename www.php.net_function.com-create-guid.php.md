# com_create_guid




<div class="phpcode"><span class="html">
Here&apos;s my final version of a GUIDv4 function (based on others work here) that should work on all platforms and gracefully fallback to less cryptographically secure version if others are not supported...<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Returns a GUIDv4 string<br> *<br> * Uses the best cryptographically secure method <br> * for all supported pltforms with fallback to an older, <br> * less secure version.<br> *<br> * @param bool $trim<br> * @return string<br> */<br></span><span class="keyword">function </span><span class="default">GUIDv4 </span><span class="keyword">(</span><span class="default">$trim </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="comment">// Windows<br>&#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;com_create_guid&apos;</span><span class="keyword">) === </span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$trim </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">com_create_guid</span><span class="keyword">(), </span><span class="string">&apos;{}&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">com_create_guid</span><span class="keyword">();<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">// OSX/Linux<br>&#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;openssl_random_pseudo_bytes&apos;</span><span class="keyword">) === </span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">openssl_random_pseudo_bytes</span><span class="keyword">(</span><span class="default">16</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">]) &amp; </span><span class="default">0x0f </span><span class="keyword">| </span><span class="default">0x40</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">// set version to 0100<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$data</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">] = </span><span class="default">chr</span><span class="keyword">(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">]) &amp; </span><span class="default">0x3f </span><span class="keyword">| </span><span class="default">0x80</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">// set bits 6-7 to 10<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">vsprintf</span><span class="keyword">(</span><span class="string">&apos;%s%s-%s-%s-%s-%s%s%s&apos;</span><span class="keyword">, </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">), </span><span class="default">4</span><span class="keyword">));<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="comment">// Fallback (PHP 4.2+)<br>&#xA0; &#xA0; </span><span class="default">mt_srand</span><span class="keyword">((double)</span><span class="default">microtime</span><span class="keyword">() * </span><span class="default">10000</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$charid </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">md5</span><span class="keyword">(</span><span class="default">uniqid</span><span class="keyword">(</span><span class="default">rand</span><span class="keyword">(), </span><span class="default">true</span><span class="keyword">)));<br>&#xA0; &#xA0; </span><span class="default">$hyphen </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">45</span><span class="keyword">);&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// &quot;-&quot;<br>&#xA0; &#xA0; </span><span class="default">$lbrace </span><span class="keyword">= </span><span class="default">$trim </span><span class="keyword">? </span><span class="string">&quot;&quot; </span><span class="keyword">: </span><span class="default">chr</span><span class="keyword">(</span><span class="default">123</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">// &quot;{&quot;<br>&#xA0; &#xA0; </span><span class="default">$rbrace </span><span class="keyword">= </span><span class="default">$trim </span><span class="keyword">? </span><span class="string">&quot;&quot; </span><span class="keyword">: </span><span class="default">chr</span><span class="keyword">(</span><span class="default">125</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">// &quot;}&quot;<br>&#xA0; &#xA0; </span><span class="default">$guidv4 </span><span class="keyword">= </span><span class="default">$lbrace</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$charid</span><span class="keyword">,&#xA0; </span><span class="default">0</span><span class="keyword">,&#xA0; </span><span class="default">8</span><span class="keyword">).</span><span class="default">$hyphen</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$charid</span><span class="keyword">,&#xA0; </span><span class="default">8</span><span class="keyword">,&#xA0; </span><span class="default">4</span><span class="keyword">).</span><span class="default">$hyphen</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$charid</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">,&#xA0; </span><span class="default">4</span><span class="keyword">).</span><span class="default">$hyphen</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$charid</span><span class="keyword">, </span><span class="default">16</span><span class="keyword">,&#xA0; </span><span class="default">4</span><span class="keyword">).</span><span class="default">$hyphen</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$charid</span><span class="keyword">, </span><span class="default">20</span><span class="keyword">, </span><span class="default">12</span><span class="keyword">).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$rbrace</span><span class="keyword">;<br>&#xA0; &#xA0; return </span><span class="default">$guidv4</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
The phunction PHP framework (<a href="http://sourceforge.net/projects/phunction/" rel="nofollow" target="_blank">http://sourceforge.net/projects/phunction/</a>) uses the following function to generate valid version 4 UUIDs:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">GUID</span><span class="keyword">()<br>{<br>&#xA0; &#xA0; if (</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;com_create_guid&apos;</span><span class="keyword">) === </span><span class="default">true</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">com_create_guid</span><span class="keyword">(), </span><span class="string">&apos;{}&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">&apos;%04X%04X-%04X-%04X-%04X-%04X%04X%04X&apos;</span><span class="keyword">, </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">16384</span><span class="keyword">, </span><span class="default">20479</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">32768</span><span class="keyword">, </span><span class="default">49151</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">), </span><span class="default">mt_rand</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">, </span><span class="default">65535</span><span class="keyword">));<br>}<br><br></span><span class="default">?&gt;<br></span><br>The output generated by the sprintf() and mt_rand() calls is identical to com_create_guid() results.</span>
</div>
  

#


<div class="phpcode"><span class="html">
Use more cryptographically strong algorithm to generate pseudo-random bytes and format it as GUID v4 string<br><br>function guidv4()<br>{<br>&#xA0; &#xA0; if (function_exists(&apos;com_create_guid&apos;) === true)<br>&#xA0; &#xA0; &#xA0; &#xA0; return trim(com_create_guid(), &apos;{}&apos;);<br><br>&#xA0; &#xA0; $data = openssl_random_pseudo_bytes(16);<br>&#xA0; &#xA0; $data[6] = chr(ord($data[6]) &amp; 0x0f | 0x40); // set version to 0100<br>&#xA0; &#xA0; $data[8] = chr(ord($data[8]) &amp; 0x3f | 0x80); // set bits 6-7 to 10<br>&#xA0; &#xA0; return vsprintf(&apos;%s%s-%s-%s-%s-%s%s%s&apos;, str_split(bin2hex($data), 4));<br>}</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.com-create-guid.php)

**[⬆ to root](/)**