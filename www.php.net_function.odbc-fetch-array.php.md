# odbc_fetch_array




<div class="phpcode"><span class="html">
I really liked Ryan&apos;s example so I took it another step and added a recordset class to work with the connection class.&#xA0; I made slight alterations to the original code as well.&#xA0; Also note the recordset class takes advantage of php5&apos;s __get property function...<br><br>&lt;%<br>class odbcRecordset {<br>&#xA0;&#xA0; var $recordcount;<br>&#xA0;&#xA0; var $currentrow;<br>&#xA0;&#xA0; var $eof;<br><br>&#xA0;&#xA0; var $recorddata;<br>&#xA0;&#xA0; var $query;<br><br>&#xA0;&#xA0; function odbcConnection(){<br>&#xA0; &#xA0; &#xA0; $this-&gt;recordcount = 0;<br>&#xA0; &#xA0; &#xA0; $this-&gt;recorddata = 0;<br>&#xA0;&#xA0; }<br><br>&#xA0;&#xA0; function SetData( $newdata, $num_records, $query ) {<br>&#xA0; &#xA0; &#xA0; $this-&gt;recorddata = $newdata;<br>&#xA0; &#xA0; &#xA0; $this-&gt;recordcount = $num_records;<br>&#xA0; &#xA0; &#xA0; $this-&gt;query = $query;<br>&#xA0; &#xA0; &#xA0; $this-&gt;currentrow = 0;<br>&#xA0; &#xA0; &#xA0; $this-&gt;set_eof();<br>&#xA0;&#xA0; }<br><br>&#xA0;&#xA0; function set_eof() {<br>&#xA0; &#xA0; &#xA0; $this-&gt;eof = $this-&gt;currentrow &gt;= $this-&gt;recordcount;<br>&#xA0;&#xA0; }<br><br>&#xA0;&#xA0; function movenext()&#xA0; { if ($this-&gt;currentrow &lt; $this-&gt;recordcount) { $this-&gt;currentrow++; $this-&gt;set_eof(); } }<br>&#xA0;&#xA0; function moveprev()&#xA0; { if ($this-&gt;currentrow &gt; 0)&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; { $this-&gt;currentrow--; $this-&gt;set_eof(); } }<br>&#xA0;&#xA0; function movefirst() { $this-&gt;currentrow = 0; set_eof();&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br>&#xA0;&#xA0; function movelast()&#xA0; { $this-&gt;currentrow = $this-&gt;recordcount - 1;&#xA0; set_eof();&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br><br>&#xA0;&#xA0; function data($field_name) {<br>&#xA0; &#xA0; &#xA0; if (isset($this-&gt;recorddata[$this-&gt;currentrow][$field_name])) {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; $thisVal = $this-&gt;recorddata[$this-&gt;currentrow][$field_name];<br>&#xA0; &#xA0; &#xA0; } else if ($this-&gt;eof) {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; die(&quot;&lt;B&gt;Error!&lt;/B&gt; eof of recordset was reached&quot;);<br>&#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; die(&quot;&lt;B&gt;Error!&lt;/B&gt; Field &lt;B&gt;&quot; . $field_name . &quot;&lt;/B&gt; was not found in the current recordset from query:&lt;br&gt;&lt;br&gt;$this-&gt;query&quot;);<br>&#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; return $thisVal;<br>&#xA0;&#xA0; } <br><br>&#xA0;&#xA0; function __get($field_name) {<br>&#xA0; &#xA0; &#xA0; return $this-&gt;data($field_name);<br>&#xA0;&#xA0; } <br>}<br><br>class odbcConnection {<br>&#xA0;&#xA0; var $user;&#xA0; //Username for the database<br>&#xA0;&#xA0; var $pass; //Password<br><br>&#xA0;&#xA0; var $conn_handle; //Connection handle<br>&#xA0;&#xA0; var $temp_fieldnames; //Tempory array used to store the fieldnames, makes parsing returned data easier.<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; function odbcConnection(){<br>&#xA0; &#xA0; &#xA0; $this-&gt;user = &quot;&quot;;<br>&#xA0; &#xA0; &#xA0; $this-&gt;pass = &quot;&quot;;<br>&#xA0;&#xA0; }<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; function open($dsn,$user,$pass){<br>&#xA0; &#xA0; &#xA0; $handle = @odbc_connect($dsn,$user,$pass,SQL_CUR_USE_ODBC) or<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; die(&quot;&lt;B&gt;Error!&lt;/B&gt; Couldn&apos;t Connect To Database. Error Code:&#xA0; &quot;.odbc_error());<br>&#xA0; &#xA0; &#xA0; $this-&gt;conn_handle = $handle;<br>&#xA0; &#xA0; &#xA0; return true;<br>&#xA0;&#xA0; }<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; function &amp;execute($query){<br>&#xA0; &#xA0; &#xA0; //Create a temp recordset<br>&#xA0; &#xA0; &#xA0; $newRS = new odbcRecordset;<br>&#xA0; &#xA0; &#xA0; $thisData = &quot;&quot;;<br><br>&#xA0; &#xA0; &#xA0; $res = @odbc_exec($this-&gt;conn_handle,$query) or<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; die(&quot;&lt;B&gt;Error!&lt;/B&gt; Couldn&apos;t Run Query:&lt;br&gt;&lt;br&gt;&quot; . $query . &quot;&lt;br&gt;&lt;br&gt;Error Code:&#xA0; &quot;.odbc_error());<br>&#xA0; &#xA0; &#xA0; unset($this-&gt;temp_fieldnames);<br><br>&#xA0; &#xA0; &#xA0; $i = 0;<br>&#xA0; &#xA0; &#xA0; $j = 0;<br>&#xA0; &#xA0; &#xA0; $num_rows = 0;<br><br>&#xA0; &#xA0; &#xA0; // only populate select queries<br>&#xA0; &#xA0; &#xA0; if (stripos($query, &apos;select &apos;) !== false) {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; while(odbc_fetch_row($res)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $num_rows++;<br>&#xA0;&#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; //Build tempory<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; for ($j = 1; $j &lt;= odbc_num_fields($res); $j++) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; $field_name = odbc_field_name($res, $j);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; $this-&gt;temp_fieldnames[$j] = $field_name;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; $ar[$field_name] = odbc_result($res, $field_name) . &quot;&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0;&#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $thisData[$i] = $ar;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $i++;<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; //populate the recordset and return it<br>&#xA0; &#xA0; &#xA0; $newRS-&gt;SetData( $thisData, $num_rows, $query );<br>&#xA0; &#xA0; &#xA0; return $newRS;<br>&#xA0;&#xA0; }<br>}<br>%&gt;<br><br>usage is pretty simple:<br><br>&lt;%<br>&#xA0; $con = new odbcConnection<br>&#xA0; $con-&gt;open(&quot;dsn&quot;,&quot;user&quot;,&quot;pass&quot;)<br><br>&#xA0; $sql = &quot;select bar from foo&quot;;<br>&#xA0; $rs = $con-&gt;execute($sql);<br><br>&#xA0; if (!$rs-&gt;eof) {<br>&#xA0; &#xA0; print $rs-&gt;data(&quot;bar&quot;);<br>&#xA0; &#xA0; &#xA0; // or //<br>&#xA0; &#xA0; print $rs-&gt;bar;<br>&#xA0; }<br><br>&#xA0; while (!$rs-&gt;eof) {<br>&#xA0; &#xA0; // blah blah code<br>&#xA0; &#xA0; $rs-&gt;movenext();<br>&#xA0; }<br>%&gt;<br><br>Works pretty well, but I haven&apos;t thoughly tested it yet.<br>Code can be dl&apos;d here:<br><br><a href="http://www.russprince.com/odbc_functions.zip" rel="nofollow" target="_blank">http://www.russprince.com/odbc_functions.zip</a><br><br>Cheers,<br>Russ</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.odbc-fetch-array.php)

**[To root](/README.md)**