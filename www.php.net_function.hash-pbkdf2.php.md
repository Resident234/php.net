# hash_pbkdf2




<div class="phpcode"><span class="html">
Please pay great attention to the **$length** parameter! It is exactly the **return string length**, NOT the length of raw binary hash result.<br><br>I had a big problem about this -- <br>I thought that `hash_pbkdf2(...false)` should equals to `bin2hex(hash_pbkdf2(...true))` just like `md5($x)` equals `bin2hex(md5($x, true))`. However I was wrong:<br><br>hash_pbkdf2(&apos;sha256&apos;, &apos;123456&apos;, &apos;abc&apos;, 10000, 50, false); // returns string(50) &quot;584bc5b41005169f1fa15177edb78d75f9846afc466a4bae05&quot;<br>hash_pbkdf2(&apos;sha256&apos;, &apos;123456&apos;, &apos;abc&apos;, 10000, 50, true); // returns string(50) &quot;XK&#x174;&#xFFFD;&#xFFFD;Qw&#xFFFD;u&#xFFFD;&#xFFFD;j&#xFFFD;FjK&#xFFFD;&#xFFFD;&#xFFFD;BFW&#xFFFD;YpG&#xA0; &#xA0; &#xFFFD;mp.g2&#xFFFD;`;N&#xFFFD;&quot;<br>bin2hex(hash_pbkdf2(&apos;sha256&apos;, &apos;123456&apos;, &apos;abc&apos;, 10000, 50, true)); // returns string(100) &quot;584bc5b41005169f1fa15177edb78d75f9846afc466a4bae05119c82424657c81b5970471f098a6d702e6732b7603b194efe&quot;<br><br>So I add such a note. Hope it will help someone else like me.</span>
</div>
  

#


<div class="phpcode"><span class="html">
This is a light-weight drop-in replacement for PHP&apos;s hash_pbkdf2(); written for compatibility with older versions of PHP.<br>Written, formatted and tested by myself, but using code and ideas based on the following:<br><a href="https://defuse.ca/php-pbkdf2.htm" rel="nofollow" target="_blank">https://defuse.ca/php-pbkdf2.htm</a><br><a href="https://github.com/rchouinard/hash_pbkdf2-compat/blob/master/src/hash_pbkdf2.php" rel="nofollow" target="_blank">https://github.com/rchouinard/hash_pbkdf2-compat/blob/master/src/hash_pbkdf2.php</a><br><a href="https://gist.github.com/rsky/5104756" rel="nofollow" target="_blank">https://gist.github.com/rsky/5104756</a><br><br>My main goals:<br>1) Maximum compatibility with PHP hash_pbkdf2(), ie. a drop-in replacement function<br>2) Minimum code size/bloat<br>3) Easy to copy/paste<br>4) No classes, and not encapsulated in a class! Why write a class when a simple function will do?<br>5) Eliminate calls to sprintf(). (used by other examples for the error reporting)<br>6) No other dependencies, ie. extra required functions<br><br><span class="default">&lt;?php<br></span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;hash_pbkdf2&apos;</span><span class="keyword">))<br>{<br>&#xA0; &#xA0; function </span><span class="default">hash_pbkdf2</span><span class="keyword">(</span><span class="default">$algo</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">, </span><span class="default">$length </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$raw_output </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$algo</span><span class="keyword">), </span><span class="default">hash_algos</span><span class="keyword">())) </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">&apos;(): Unknown hashing algorithm: &apos; </span><span class="keyword">. </span><span class="default">$algo</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">)) </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">&apos;(): expects parameter 4 to be long, &apos; </span><span class="keyword">. </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">) . </span><span class="string">&apos; given&apos;</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">)) </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">&apos;(): expects parameter 5 to be long, &apos; </span><span class="keyword">. </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$length</span><span class="keyword">) . </span><span class="string">&apos; given&apos;</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$count </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">) </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">&apos;(): Iterations must be a positive integer: &apos; </span><span class="keyword">. </span><span class="default">$count</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$length </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="default">__FUNCTION__ </span><span class="keyword">. </span><span class="string">&apos;(): Length must be greater than or equal to 0: &apos; </span><span class="keyword">. </span><span class="default">$length</span><span class="keyword">, </span><span class="default">E_USER_WARNING</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$output </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$block_count </span><span class="keyword">= </span><span class="default">$length </span><span class="keyword">? </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$length </span><span class="keyword">/ </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">hash</span><span class="keyword">(</span><span class="default">$algo</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$raw_output</span><span class="keyword">))) : </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$block_count</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$last </span><span class="keyword">= </span><span class="default">$xorsum </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$algo</span><span class="keyword">, </span><span class="default">$salt </span><span class="keyword">. </span><span class="default">pack</span><span class="keyword">(</span><span class="string">&apos;N&apos;</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">), </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; for (</span><span class="default">$j </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">$count</span><span class="keyword">; </span><span class="default">$j</span><span class="keyword">++)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$xorsum </span><span class="keyword">^= (</span><span class="default">$last </span><span class="keyword">= </span><span class="default">hash_hmac</span><span class="keyword">(</span><span class="default">$algo</span><span class="keyword">, </span><span class="default">$last</span><span class="keyword">, </span><span class="default">$password</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$output </span><span class="keyword">.= </span><span class="default">$xorsum</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">$raw_output</span><span class="keyword">) </span><span class="default">$output </span><span class="keyword">= </span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$length </span><span class="keyword">? </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$length</span><span class="keyword">) : </span><span class="default">$output</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.hash-pbkdf2.php)

**[To root](/README.md)**