# Type Hinting




<div class="phpcode"><span class="html">
People often ask about scalar/basic typehints.&#xA0; Here is a drop in class that I use in my MVC framework that will enable typehints through the use of a custom error handler.<br><br>Note: You should include this code above all other code in your include headers and if you are the using set_error_handler() function you should be aware that this uses it as well.&#xA0; You may need to chain your set_error_handlers()<br><br>Why?<br>1) Because people are sick of using the is_* functions to validate parameters.<br>2) Reduction of redundant coding for defensive coders.<br>3) Functions/Methods are self defining/documenting as to required input.<br><br>Also..<br>Follow the discussion for typehints in PHP 6.0 on the PHP Internals boards.<br><br><span class="default">&lt;?php<br><br>define</span><span class="keyword">(</span><span class="string">&apos;TYPEHINT_PCRE&apos;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">,</span><span class="string">&apos;/^Argument (\d)+ passed to (?:(\w+)::)?(\w+)\(\) must be an instance of (\w+), (\w+) given/&apos;</span><span class="keyword">);<br><br>class </span><span class="default">Typehint<br></span><span class="keyword">{<br><br>&#xA0; &#xA0; private static </span><span class="default">$Typehints </span><span class="keyword">= array(<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;boolean&apos;&#xA0;&#xA0; </span><span class="keyword">=&gt; </span><span class="string">&apos;is_bool&apos;</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;integer&apos;&#xA0;&#xA0; </span><span class="keyword">=&gt; </span><span class="string">&apos;is_int&apos;</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;float&apos;&#xA0; &#xA0;&#xA0; </span><span class="keyword">=&gt; </span><span class="string">&apos;is_float&apos;</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;string&apos;&#xA0; &#xA0; </span><span class="keyword">=&gt; </span><span class="string">&apos;is_string&apos;</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;resrouce&apos;&#xA0; </span><span class="keyword">=&gt; </span><span class="string">&apos;is_resource&apos;<br>&#xA0; &#xA0; </span><span class="keyword">);<br><br>&#xA0; &#xA0; private function </span><span class="default">__Constrct</span><span class="keyword">() {}<br><br>&#xA0; &#xA0; public static function </span><span class="default">initializeHandler</span><span class="keyword">()<br>&#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">set_error_handler</span><span class="keyword">(</span><span class="string">&apos;Typehint::handleTypehint&apos;</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">TRUE</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; private static function </span><span class="default">getTypehintedArgument</span><span class="keyword">(</span><span class="default">$ThBackTrace</span><span class="keyword">, </span><span class="default">$ThFunction</span><span class="keyword">, </span><span class="default">$ThArgIndex</span><span class="keyword">, &amp;</span><span class="default">$ThArgValue</span><span class="keyword">)<br>&#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; foreach (</span><span class="default">$ThBackTrace </span><span class="keyword">as </span><span class="default">$ThTrace</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Match the function; Note we could do more defensive error checking.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if (isset(</span><span class="default">$ThTrace</span><span class="keyword">[</span><span class="string">&apos;function&apos;</span><span class="keyword">]) &amp;&amp; </span><span class="default">$ThTrace</span><span class="keyword">[</span><span class="string">&apos;function&apos;</span><span class="keyword">] == </span><span class="default">$ThFunction</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ThArgValue </span><span class="keyword">= </span><span class="default">$ThTrace</span><span class="keyword">[</span><span class="string">&apos;args&apos;</span><span class="keyword">][</span><span class="default">$ThArgIndex </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">];<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">TRUE</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; public static function </span><span class="default">handleTypehint</span><span class="keyword">(</span><span class="default">$ErrLevel</span><span class="keyword">, </span><span class="default">$ErrMessage</span><span class="keyword">)<br>&#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$ErrLevel </span><span class="keyword">== </span><span class="default">E_RECOVERABLE_ERROR</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">TYPEHINT_PCRE</span><span class="keyword">, </span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="default">$ErrMatches</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; list(</span><span class="default">$ErrMatch</span><span class="keyword">, </span><span class="default">$ThArgIndex</span><span class="keyword">, </span><span class="default">$ThClass</span><span class="keyword">, </span><span class="default">$ThFunction</span><span class="keyword">, </span><span class="default">$ThHint</span><span class="keyword">, </span><span class="default">$ThType</span><span class="keyword">) = </span><span class="default">$ErrMatches</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$Typehints</span><span class="keyword">[</span><span class="default">$ThHint</span><span class="keyword">]))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ThBacktrace </span><span class="keyword">= </span><span class="default">debug_backtrace</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ThArgValue&#xA0; </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">self</span><span class="keyword">::</span><span class="default">getTypehintedArgument</span><span class="keyword">(</span><span class="default">$ThBacktrace</span><span class="keyword">, </span><span class="default">$ThFunction</span><span class="keyword">, </span><span class="default">$ThArgIndex</span><span class="keyword">, </span><span class="default">$ThArgValue</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$Typehints</span><span class="keyword">[</span><span class="default">$ThHint</span><span class="keyword">], </span><span class="default">$ThArgValue</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">TRUE</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}<br><br></span><span class="default">Typehint</span><span class="keyword">::</span><span class="default">initializeHandler</span><span class="keyword">();<br><br></span><span class="default">?&gt;<br></span><br>An are some examples of the class in use:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">teststring</span><span class="keyword">(</span><span class="default">string $string</span><span class="keyword">) { echo </span><span class="default">$string</span><span class="keyword">; }<br>function </span><span class="default">testinteger</span><span class="keyword">(</span><span class="default">integer $integer</span><span class="keyword">) { echo </span><span class="default">$integer</span><span class="keyword">; }<br>function </span><span class="default">testfloat</span><span class="keyword">(</span><span class="default">float $float</span><span class="keyword">) { echo </span><span class="default">$float</span><span class="keyword">; }<br><br></span><span class="comment">// This will work for class methods as well.<br><br></span><span class="default">?&gt;<br></span><br>You get the picture..</span>
</div>
  

#


<div class="phpcode"><span class="html">
The scalar type hinting solutions are all overthinking it. I provided the optimized regex version, as well as the fastest implementation I&apos;ve come up with, which just uses strpos. Then I benchmark both against the TypeHint class.<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">optimized_strpos</span><span class="keyword">(</span><span class="default">$ErrLevel</span><span class="keyword">, </span><span class="default">$ErrMessage</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$ErrLevel </span><span class="keyword">== </span><span class="default">E_RECOVERABLE_ERROR<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// order this according to what your app uses most<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="string">&apos;must be an instance of string, string&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="string">&apos;must be an instance of integer, integer&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="string">&apos;must be an instance of float, double&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="string">&apos;must be an instance of boolean, boolean&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; || </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="string">&apos;must be an instance of resource, resource&apos;</span><span class="keyword">);<br>}<br><br>function </span><span class="default">optimized_regex</span><span class="keyword">(</span><span class="default">$ErrLevel</span><span class="keyword">, </span><span class="default">$ErrMessage</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$ErrLevel </span><span class="keyword">== </span><span class="default">E_RECOVERABLE_ERROR</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;/^Argument \d+ passed to (?:\w+::)?\w+\(\) must be an instance of (\w+), (\w+) given/&apos;</span><span class="keyword">, </span><span class="default">$ErrMessage</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] == (</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">] == </span><span class="string">&apos;double&apos; </span><span class="keyword">? </span><span class="string">&apos;float&apos; </span><span class="keyword">: </span><span class="default">$matches</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>}<br></span><span class="default">?&gt;<br></span><br>BENCHMARKING Typehint::handleTypehint()<br>string type hint.....[function it(string $var) {}]............2.1588530540466 seconds<br>float type hint......[function it(float $var) {}].............2.1563150882721 seconds<br>integer type hint....[function it(integer $var) {}]...........2.1579530239105 seconds<br>boolean type hint....[function it(boolean $var) {}]...........2.1590459346771 seconds<br><br>BENCHMARKING optimized_regex()<br>string type hint.....[function it(string $var) {}]............0.88872504234314 seconds<br>float type hint......[function it(float $var) {}].............0.88528990745544 seconds<br>integer type hint....[function it(integer $var) {}]...........0.89038777351379 seconds<br>boolean type hint....[function it(boolean $var) {}]...........0.89061188697815 seconds<br><br>BENCHMARKING optimized_strpos()<br>string type hint.....[function it(string $var) {}]............0.52635812759399 seconds<br>float type hint......[function it(float $var) {}].............0.74228310585022 seconds<br>integer type hint....[function it(integer $var) {}]...........0.63721108436584 seconds<br>boolean type hint....[function it(boolean $var) {}]...........0.8429491519928 seconds</span>
</div>
  

#


<div class="phpcode"><span class="html">
Daniel&apos;s typehint implementation was just what I was looking for but performance in production wasn&apos;t going to cut it. Calling a backtrace every time hurts performance. For my implementation I didn&apos;t use it, after all, PHP tells us what the data type is in the error message, I don&apos;t feel I need to evaluate the argument where I am using typehinting. Here is the cut down version I use in my error handling class:
<br>
<br><span class="default">&lt;?php
<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">public static function </span><span class="default">typehint</span><span class="keyword">(</span><span class="default">$level</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">)
<br>&#xA0; &#xA0; &#xA0; &#xA0; {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$level </span><span class="keyword">== </span><span class="default">E_RECOVERABLE_ERROR</span><span class="keyword">)
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;/^Argument (\d)+ passed to (?:(\w+)::)?(\w+)\(\) must be an instance of (\w+), (\w+) given/&apos;</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$match</span><span class="keyword">))
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$match</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">] == </span><span class="default">$match</span><span class="keyword">[</span><span class="default">5</span><span class="keyword">])
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">true</span><span class="keyword">;
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; 
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;
<br>&#xA0; &#xA0; &#xA0; &#xA0; }
<br></span><span class="default">?&gt;
<br></span>
<br>Hope this can be of use to somebody.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/language.oop5.typehinting.php)

**[To root](/README.md)**