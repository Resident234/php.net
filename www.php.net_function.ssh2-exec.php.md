# ssh2_exec




<div class="phpcode"><span class="html">
There doesn&apos;t appear to be a way to get data from BOTH stderr and stdout streams simultaneously, or at least I&apos;ve yet to find one.<br><br>The following code *should* get the error message written to stderr, but if the call to stream_get_contents() for stdout is run first, the subsequent call for stderr won&apos;t return anything.&#xA0; <br><br>If the order of the statements is reversed, the call for stderr will return any errors and call for stdout will return nothing<br><br><span class="default">&lt;?php<br></span><span class="comment">// Run a command that will probably write to stderr (unless you have a folder named /hom)<br></span><span class="default">$stream </span><span class="keyword">= </span><span class="default">ssh2_exec</span><span class="keyword">(</span><span class="default">$connection</span><span class="keyword">, </span><span class="string">&quot;cd /hom&quot;</span><span class="keyword">);<br></span><span class="default">$errorStream </span><span class="keyword">= </span><span class="default">ssh2_fetch_stream</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">SSH2_STREAM_STDERR</span><span class="keyword">);<br><br></span><span class="comment">// Enable blocking for both streams<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$errorStream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br></span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="comment">// Whichever of the two below commands is listed first will receive its appropriate output.&#xA0; The second command receives nothing<br></span><span class="keyword">echo </span><span class="string">&quot;Output: &quot; </span><span class="keyword">. </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br>echo </span><span class="string">&quot;Error: &quot; </span><span class="keyword">. </span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$errorStream</span><span class="keyword">);<br><br></span><span class="comment">// Close the streams&#xA0; &#xA0; &#xA0; &#xA0; <br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$errorStream</span><span class="keyword">);<br></span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>My initial suspicion is that either a) I&apos;ve done something wrong&#xA0; or b) the blocking nature of both streams means that by the time first stream has received data and returned, the buffer for the second stream has already emptied.<br><br>I&apos;ve done preliminary tests with blocking disabled, but haven&apos;t had any luck there either.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.ssh2-exec.php)

**[â¬† to root](/)**