# imagefilter




<div class="phpcode"><span class="html">
The documentation misses the exact meaning and valid ranges of the arguments for ImageFilter(). According to the 5.2.0 sources the arguments are:<br>IMG_FILTER_BRIGHTNESS<br>-255 = min brightness, 0 = no change, +255 = max brightness<br><br>IMG_FILTER_CONTRAST<br>-100 = max contrast, 0 = no change, +100 = min contrast (note the direction!)<br><br>IMG_FILTER_COLORIZE<br>Adds (subtracts) specified RGB values to each pixel. The valid range for each color is -255...+255, not 0...255. The correct order is red, green, blue.<br>-255 = min, 0 = no change, +255 = max<br>This has not much to do with IMG_FILTER_GRAYSCALE.<br><br>IMG_FILTER_SMOOTH<br>Applies a 9-cell convolution matrix where center pixel has the weight arg1 and others weight of 1.0. The result is normalized by dividing the sum with arg1 + 8.0 (sum of the matrix).<br>any float is accepted, large value (in practice: 2048 or more) = no change<br><br>ImageFilter seem to return false if the argument(s) are out of range for the chosen filter.</span>
</div>
  

#


<div class="phpcode"><span class="html">
I needed an especially strong blur effect today and had a hard time achieving adequate results with the built-in IMG_FILTER_GAUSSIAN_BLUR filter. In order to achieve the strength of the blur I required I had to repeat the filter up to&#xA0; 100 times, which took way too long to be acceptable.<br><br>After a bit of searching, I found this answer to be quite a good solution to this problem: <a href="http://stackoverflow.com/a/20264482" rel="nofollow" target="_blank">http://stackoverflow.com/a/20264482</a><br><br>Based on that technique, I wrote the following generic function to achieve a very strong blur in a reasonable amount of processing:<br><br><span class="default">&lt;?php <br><br></span><span class="comment">/**<br> * Strong Blur<br> *<br> * @param resource $gdImageResource <br> * @param int $blurFactor optional <br> *&#xA0; This is the strength of the blur<br> *&#xA0; 0 = no blur, 3 = default, anything over 5 is extremely blurred<br> * @return GD image resource<br> * @author Martijn Frazer, idea based on <a href="http://stackoverflow.com/a/20264482" rel="nofollow" target="_blank">http://stackoverflow.com/a/20264482</a><br> */<br></span><span class="keyword">function </span><span class="default">blur</span><span class="keyword">(</span><span class="default">$gdImageResource</span><span class="keyword">, </span><span class="default">$blurFactor </span><span class="keyword">= </span><span class="default">3</span><span class="keyword">)<br>{<br>&#xA0; </span><span class="comment">// blurFactor has to be an integer<br>&#xA0; </span><span class="default">$blurFactor </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$blurFactor</span><span class="keyword">);<br>&#xA0; <br>&#xA0; </span><span class="default">$originalWidth </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$gdImageResource</span><span class="keyword">);<br>&#xA0; </span><span class="default">$originalHeight </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$gdImageResource</span><span class="keyword">);<br><br>&#xA0; </span><span class="default">$smallestWidth </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$originalWidth </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">0.5</span><span class="keyword">, </span><span class="default">$blurFactor</span><span class="keyword">));<br>&#xA0; </span><span class="default">$smallestHeight </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$originalHeight </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">0.5</span><span class="keyword">, </span><span class="default">$blurFactor</span><span class="keyword">));<br><br>&#xA0; </span><span class="comment">// for the first run, the previous image is the original input<br>&#xA0; </span><span class="default">$prevImage </span><span class="keyword">= </span><span class="default">$gdImageResource</span><span class="keyword">;<br>&#xA0; </span><span class="default">$prevWidth </span><span class="keyword">= </span><span class="default">$originalWidth</span><span class="keyword">;<br>&#xA0; </span><span class="default">$prevHeight </span><span class="keyword">= </span><span class="default">$originalHeight</span><span class="keyword">;<br><br>&#xA0; </span><span class="comment">// scale way down and gradually scale back up, blurring all the way<br>&#xA0; </span><span class="keyword">for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$blurFactor</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">1</span><span class="keyword">)<br>&#xA0; {&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">// determine dimensions of next image<br>&#xA0; &#xA0; </span><span class="default">$nextWidth </span><span class="keyword">= </span><span class="default">$smallestWidth </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$nextHeight </span><span class="keyword">= </span><span class="default">$smallestHeight </span><span class="keyword">* </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="comment">// resize previous image to next size<br>&#xA0; &#xA0; </span><span class="default">$nextImage </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$nextWidth</span><span class="keyword">, </span><span class="default">$nextHeight</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$nextImage</span><span class="keyword">, </span><span class="default">$prevImage</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, <br>&#xA0; &#xA0; &#xA0; </span><span class="default">$nextWidth</span><span class="keyword">, </span><span class="default">$nextHeight</span><span class="keyword">, </span><span class="default">$prevWidth</span><span class="keyword">, </span><span class="default">$prevHeight</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="comment">// apply blur filter<br>&#xA0; &#xA0; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$nextImage</span><span class="keyword">, </span><span class="default">IMG_FILTER_GAUSSIAN_BLUR</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="comment">// now the new image becomes the previous image for the next step<br>&#xA0; &#xA0; </span><span class="default">$prevImage </span><span class="keyword">= </span><span class="default">$nextImage</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$prevWidth </span><span class="keyword">= </span><span class="default">$nextWidth</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$prevHeight </span><span class="keyword">= </span><span class="default">$nextHeight</span><span class="keyword">;<br>&#xA0; }<br><br>&#xA0; </span><span class="comment">// scale back to original size and blur one more time<br>&#xA0; </span><span class="default">imagecopyresized</span><span class="keyword">(</span><span class="default">$gdImageResource</span><span class="keyword">, </span><span class="default">$nextImage</span><span class="keyword">, <br>&#xA0; &#xA0; </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$originalWidth</span><span class="keyword">, </span><span class="default">$originalHeight</span><span class="keyword">, </span><span class="default">$nextWidth</span><span class="keyword">, </span><span class="default">$nextHeight</span><span class="keyword">);<br>&#xA0; </span><span class="default">imagefilter</span><span class="keyword">(</span><span class="default">$gdImageResource</span><span class="keyword">, </span><span class="default">IMG_FILTER_GAUSSIAN_BLUR</span><span class="keyword">);<br><br>&#xA0; </span><span class="comment">// clean up<br>&#xA0; </span><span class="default">imagedestroy</span><span class="keyword">(</span><span class="default">$prevImage</span><span class="keyword">);<br><br>&#xA0; </span><span class="comment">// return result<br>&#xA0; </span><span class="keyword">return </span><span class="default">$gdImageResource</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Here is an alternative to IMG_FILTER_COLORIZE filter, but taking the alpha parameter of each pixel in account.
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">function </span><span class="default">rgba_colorize</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">)
<br>{
<br>&#xA0; &#xA0; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br>&#xA0; &#xA0; </span><span class="default">imagealphablending</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br>
<br>&#xA0; &#xA0; </span><span class="default">$img_x </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br>&#xA0; &#xA0; </span><span class="default">$img_y </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);
<br>&#xA0; &#xA0; for (</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$img_x</span><span class="keyword">; ++</span><span class="default">$x</span><span class="keyword">)
<br>&#xA0; &#xA0; {
<br>&#xA0; &#xA0; &#xA0; &#xA0; for (</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$img_y</span><span class="keyword">; ++</span><span class="default">$y</span><span class="keyword">)
<br>&#xA0; &#xA0; &#xA0; &#xA0; {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$rgba </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">));
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$color_alpha </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$color</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$color</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$rgba</span><span class="keyword">[</span><span class="string">&apos;alpha&apos;</span><span class="keyword">]);
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$color_alpha</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">imagecolordeallocate</span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">, </span><span class="default">$color_alpha</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; }
<br>&#xA0; &#xA0; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.imagefilter.php)

**[To root](/README.md)**