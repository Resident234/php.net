# Gettext




<div class="phpcode"><span class="html">
How to use gettext on Windows.<br><br>If you use Linux start from the step 2 and consider cmd as linux shell.<br><br>1] First you have to download and install this <br>&#xA0; &#xA0; &#xA0; <a href="https://mlocati.github.io/articles/gettext-iconv-windows.html" rel="nofollow" target="_blank">https://mlocati.github.io/articles/gettext-iconv-windows.html</a><br>&#xA0;&#xA0; <br>&#xA0; &#xA0; Check all options during the installation and go on.&#xA0;&#xA0; <br> <br><br>2] Create a index.php file into your website directory with this code inside:<br>&#xA0; <br>&#xA0;&#xA0; <span class="default">&lt;?php <br>&#xA0; &#xA0; </span><span class="keyword">echo&#xA0; </span><span class="default">_</span><span class="keyword">(</span><span class="string">&quot;Good Morning&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">?&gt;<br></span><br>3] Open cmd and move into your website folder using cd<br><br>4] Now create the .mo files directly from the php files using this command<br>&#xA0; &#xA0; xgettext -n index.php<br>&#xA0;&#xA0; <br>&#xA0; &#xA0; Use xgettext -help to see how to include more php files.<br><br>5] Once finished will be generate a file called messages.mo. Now you have to set the language and the charset. Open messages.mo with notepad and edit the lines:<br><br> - &quot;Language: \n&quot; BECOMES &quot;Language fr\n&quot;<br> - &quot;Content-Type: text/plain; charset=CHARSET\n&quot; BECOMES &quot;Content-Type: text/plain; charset=UTF-8\n&quot;<br><br>6] Remember to translate every line where is present msgstr &quot;&quot;, translating the instance msgid into language you have chosen. For instance:<br><br>&#xA0;&#xA0; #: index.php:2<br>&#xA0; msgid &quot;Good Morning&quot;<br>&#xA0; msgstr &quot;Bonjour&quot;<br><br>7] Once finished open cmd and move into your website folder using cd and then type<br>&#xA0; &#xA0;&#xA0; msgfmt messages.po<br><br> This will make a file called messages.mo . Is a binary version of the messages.po file<br><br>8] Now you have to create a folder structure like this into your website folder. Do this for each language you want to add.<br>&#xA0; &#xA0; <br>&#xA0; website/locale/fr_FR/LC_MESSAGES<br><br>9] Move messages.mo and messages.po in locale/fr_FR/LC_MESSAGES <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>10] Now edit the index.php as follows<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br> <span class="default">&lt;?php<br><br> $locale </span><span class="keyword">= </span><span class="string">&quot;fr_FR&quot;</span><span class="keyword">;<br><br>&#xA0; &#xA0; if (</span><span class="default">defined</span><span class="keyword">(</span><span class="string">&apos;LC_MESSAGES&apos;</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">setlocale</span><span class="keyword">(</span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="default">$locale</span><span class="keyword">); </span><span class="comment">// Linux<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">&quot;messages&quot;</span><span class="keyword">, </span><span class="string">&quot;./locale&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">putenv</span><span class="keyword">(</span><span class="string">&quot;LC_ALL=</span><span class="keyword">{</span><span class="default">$locale</span><span class="keyword">}</span><span class="string">&quot;</span><span class="keyword">); </span><span class="comment">// windows<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">&quot;messages&quot;</span><span class="keyword">, </span><span class="string">&quot;.\locale&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">textdomain</span><span class="keyword">(</span><span class="string">&quot;messages&quot;</span><span class="keyword">);<br><br>&#xA0; &#xA0; echo </span><span class="default">_</span><span class="keyword">(</span><span class="string">&quot;Good Morning&quot;</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>11] Open index.php in your browser and if you will see &quot;Bonjour&quot; it means everything is okay. If not,&#xA0; start from the step 2 again.<br><br>If it was usefull for you vote up!<br><br>Visit my github profile <a href="https://github.com/TheoRelativity/" rel="nofollow" target="_blank">https://github.com/TheoRelativity/</a></span>
</div>
  

#


<div class="phpcode"><span class="html">
Warning for Linux (Ubuntu) users!&#xA0; Your system will *only* support the locales installed on your OS, in the *exact* format given by your OS.&#xA0; (See also the PHP setlocale man page.)&#xA0; To get a list of them, enter locale -a, which will give you something like this:<br><br>C<br>en_US.utf8<br>ja_JP.utf8<br>POSIX<br><br>So this machine only has English and Japanese!&#xA0; To add eg. Finnish, install the package:<br><br>sudo apt-get install language-pack-fi-base<br><br>Rerun locale -a, and &quot;fi_FI.utf8&quot; should appear.&#xA0; Make sure you&apos;re using the same name in your PHP code:<br><br>setlocale(LC_ALL, &quot;fi_FI.utf8&quot;);<br><br>Adjust your po paths so that they match, e.g. &quot;./locale/fi_FI.utf8/LC_MESSAGES/messages.po&quot;.<br><br>Now restart Apache, and it should finally work.&#xA0; Figuring this out took quite a while...</span>
</div>
  

#


<div class="phpcode"><span class="html">
And what about pgettext and npgettext? They are there in the gettext documentation, but there aren&apos;t in PHP. They&apos;re very useful if you have the same messages for translation, but in different contexts, so they should be translated separately and probably differently.<br><br>Fortunately, there is a simple work-around, which may help:<br>From the gettext.h header one can find out that pgettext() is only a macro calling dcgettext() internally with properly mangled parameters - msgctxt and msgid are glued together with use of ASCII char 4 [EOT, End Of Text]. The same way they&apos;re written in .mo files, so it&apos;s possible to refer them this way.<br><br>Here&apos;s my &quot;emulated&quot; pgettext() function:<br><br><span class="default">&lt;?php<br>&#xA0;&#xA0; </span><span class="keyword">if (!</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;pgettext&apos;</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; function </span><span class="default">pgettext</span><span class="keyword">(</span><span class="default">$context</span><span class="keyword">, </span><span class="default">$msgid</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$contextString </span><span class="keyword">= </span><span class="string">&quot;</span><span class="keyword">{</span><span class="default">$context</span><span class="keyword">}</span><span class="string">\004</span><span class="keyword">{</span><span class="default">$msgid</span><span class="keyword">}</span><span class="string">&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$translation </span><span class="keyword">= </span><span class="default">dcgettext</span><span class="keyword">(</span><span class="string">&apos;messages&apos;</span><span class="keyword">, </span><span class="default">contextString</span><span class="keyword">,</span><span class="default">LC_MESSAGES</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; if (</span><span class="default">$translation </span><span class="keyword">== </span><span class="default">$contextString</span><span class="keyword">)&#xA0; return </span><span class="default">$msgid</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; else&#xA0; return </span><span class="default">$translation</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; <br>&#xA0;&#xA0; }<br></span><span class="default">?&gt;<br></span><br>By default, xgettext doesn&apos;t support pgettext function for PHP source files. But there is a parameter which can work-around it. Here&apos;s how I call xgettext:<br><br>&#xA0;&#xA0; xgettext --force-po --keyword=&quot;pgettext:1c,2&quot; -c -o messages.po sourceFile.php<br><br>In sourceFile.php I use the following test code:<br><br>&#xA0;&#xA0; pgettext(&apos;menu&apos;, &apos;Open&apos;);&#xA0; //Substitute &quot;Otw&#xF3;rz&quot;<br>&#xA0;&#xA0; pgettext(&apos;forum&apos;, &apos;Open&apos;);&#xA0; //Substitute &quot;Otwarty&quot;, different context<br><br>Generated .po file fragment:<br><br>&#xA0;&#xA0; msgctxt &quot;menu&quot;<br>&#xA0;&#xA0; msgid &quot;Open&quot;<br>&#xA0;&#xA0; msgstr &quot;Otw&#xF3;rz&quot;<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; msgctxt &quot;forum&quot;<br>&#xA0;&#xA0; msgctxt &quot;Open&quot;<br>&#xA0;&#xA0; msgstr &quot;Otwarty&quot;<br><br>I&apos;ve tested it out and everything works fine :-) If anyone have some further suggestions or fixes, please write ;-)</span>
</div>
  

#


<div class="phpcode"><span class="html">
*An important thing to keep in mind*:<br>Do not forget to set the charset in .po file! <br>For example:<br><br>&quot;Content-Type: text/plain; charset=UTF-8\n&quot;<br><br>Then PHP will be able to find the .mo file you generated, using msgfmt, from the .po file WITH CHARSET SET.<br><br>Because of this I&apos;ve wasted a lot of time debugging my code, testing every single little changes people suggested over this manual and Internet: <br><br><span class="default">&lt;?php<br><br></span><span class="comment">//this:<br></span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">&apos;pt_BR&apos;</span><span class="keyword">)<br></span><span class="comment">//or this:<br></span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">&apos;pt_BR.utf8&apos;</span><span class="keyword">)<br></span><span class="comment">//or this:<br></span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">)<br><br></span><span class="comment">//this:<br></span><span class="default">putenv</span><span class="keyword">(</span><span class="string">&quot;LANG=pt_BR.utf8&quot;</span><span class="keyword">);<br></span><span class="comment">//or this:<br></span><span class="default">putenv</span><span class="keyword">(</span><span class="string">&quot;LANGUAGE=pt_BR.utf8&quot;</span><span class="keyword">);<br><br></span><span class="comment">//this:<br></span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">&apos;mydomain&apos;</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">&apos;/locale&apos;</span><span class="keyword">);<br></span><span class="comment">//or this:<br></span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">&quot;*&quot;</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">&apos;/locale&apos;</span><span class="keyword">);<br></span><span class="comment">//or this:<br></span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="string">&apos;*&apos;</span><span class="keyword">, </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">&apos;/locale&apos;</span><span class="keyword">);<br><br></span><span class="comment">//setting or not &quot;bind_textdomain_codeset()&quot;:<br></span><span class="default">bind_textdomain_codeset</span><span class="keyword">(</span><span class="string">&quot;mydomain&quot;</span><span class="keyword">, </span><span class="string">&apos;UTF-8&apos;</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>As well as what locale directory name to set:<br>./locale/pt_BR.UTF8/LC_MESSAGES/mydomain.mo<br>or<br>./locale/pt_BR/LC_MESSAGES/mydomain.mo<br>or<br>./locale/pt/LC_MESSAGES/mydomain.mo<br><br>Finally, the code which brought the right translated strings (also with the correct charset) was:<br><br><span class="default">&lt;?php<br><br>$directory </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">).</span><span class="string">&apos;/locale&apos;</span><span class="keyword">;<br></span><span class="default">$domain </span><span class="keyword">= </span><span class="string">&apos;mydomain&apos;</span><span class="keyword">;<br></span><span class="default">$locale </span><span class="keyword">=</span><span class="string">&quot;pt_BR.utf8&quot;</span><span class="keyword">;<br><br></span><span class="comment">//putenv(&quot;LANG=&quot;.$locale); //not needed for my tests, but people say it&apos;s useful for windows<br><br></span><span class="default">setlocale</span><span class="keyword">( </span><span class="default">LC_MESSAGES</span><span class="keyword">, </span><span class="default">$locale</span><span class="keyword">);<br></span><span class="default">bindtextdomain</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="default">$directory</span><span class="keyword">);<br></span><span class="default">textdomain</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">);<br></span><span class="default">bind_textdomain_codeset</span><span class="keyword">(</span><span class="default">$domain</span><span class="keyword">, </span><span class="string">&apos;UTF-8&apos;</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>And the three directory&apos;s names worked out, using the pt_BR.utf8 locale. (My tests were made restarting Apache then trying each directory).<br><br>I hope to help someone else not to waste as much time as I&apos;ve wasted... =P<br><br>Using:<br>Ubuntu 8.04 (hardy)<br>Apache 2.2.8<br>PHP 5.2.4-2ubuntu5.6</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/book.gettext.php)

**[â¬† to root](/)**