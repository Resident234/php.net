# getimagesize




<div class="phpcode"><span class="html">
As noted below, getimagesize will download the entire image before it checks for the requested information. This is extremely slow on large images that are accessed remotely. Since the width/height is in the first few bytes of the file, there is no need to download the entire file. I wrote a function to get the size of a JPEG by streaming bytes until the proper data is found to report the width and height:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Retrieve JPEG width and height without downloading/reading entire image.<br></span><span class="keyword">function </span><span class="default">getjpegsize</span><span class="keyword">(</span><span class="default">$img_loc</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$img_loc</span><span class="keyword">, </span><span class="string">&quot;rb&quot;</span><span class="keyword">) or die(</span><span class="string">&quot;Invalid file stream.&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$new_block </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>&#xA0; &#xA0; if(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$new_block </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]==</span><span class="string">&quot;\xFF&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]==</span><span class="string">&quot;\xD8&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">]==</span><span class="string">&quot;\xFF&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">]==</span><span class="string">&quot;\xE0&quot;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">4</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">]==</span><span class="string">&quot;\x4A&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">]==</span><span class="string">&quot;\x46&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">]==</span><span class="string">&quot;\x49&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">5</span><span class="keyword">]==</span><span class="string">&quot;\x46&quot; </span><span class="keyword">&amp;&amp; </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">6</span><span class="keyword">]==</span><span class="string">&quot;\x00&quot;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Read block size and skip ahead to begin cycling through blocks in search of SOF marker<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;H*&quot;</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$block_size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">$block_size</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$new_block </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$block_size</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]==</span><span class="string">&quot;\xFF&quot;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// New block detected, check for SOF marker<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$sof_marker </span><span class="keyword">= array(</span><span class="string">&quot;\xC0&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC1&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC2&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC3&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC5&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC6&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC7&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC8&quot;</span><span class="keyword">, </span><span class="string">&quot;\xC9&quot;</span><span class="keyword">, </span><span class="string">&quot;\xCA&quot;</span><span class="keyword">, </span><span class="string">&quot;\xCB&quot;</span><span class="keyword">, </span><span class="string">&quot;\xCD&quot;</span><span class="keyword">, </span><span class="string">&quot;\xCE&quot;</span><span class="keyword">, </span><span class="string">&quot;\xCF&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">], </span><span class="default">$sof_marker</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// SOF marker detected. Width and height information is contained in bytes 4-7 after this byte.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$size_data </span><span class="keyword">= </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">2</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">3</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">4</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">5</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">6</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">7</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">8</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$unpacked </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;H*&quot;</span><span class="keyword">, </span><span class="default">$size_data</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$unpacked </span><span class="keyword">= </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">6</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">7</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">8</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">9</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">10</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">11</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">12</span><span class="keyword">] . </span><span class="default">$unpacked</span><span class="keyword">[</span><span class="default">13</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return array(</span><span class="default">$width</span><span class="keyword">, </span><span class="default">$height</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Skip block marker and read block size<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">2</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;H*&quot;</span><span class="keyword">, </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] . </span><span class="default">$new_block</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$block_size </span><span class="keyword">= </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$block_size</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you want to &quot;convert&quot; value returned by &quot;getimagesize()&quot; as index &quot;2&quot; into something more human-readable, you may consider using a function like this one:<br><br>&#xA0; &#xA0; $imageTypeArray = array<br>&#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; 0=&gt;&apos;UNKNOWN&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 1=&gt;&apos;GIF&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 2=&gt;&apos;JPEG&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 3=&gt;&apos;PNG&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 4=&gt;&apos;SWF&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 5=&gt;&apos;PSD&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 6=&gt;&apos;BMP&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 7=&gt;&apos;TIFF_II&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 8=&gt;&apos;TIFF_MM&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 9=&gt;&apos;JPC&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 10=&gt;&apos;JP2&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 11=&gt;&apos;JPX&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 12=&gt;&apos;JB2&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 13=&gt;&apos;SWC&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 14=&gt;&apos;IFF&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 15=&gt;&apos;WBMP&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 16=&gt;&apos;XBM&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 17=&gt;&apos;ICO&apos;,<br>&#xA0; &#xA0; &#xA0; &#xA0; 18=&gt;&apos;COUNT&apos;&#xA0; <br>&#xA0; &#xA0; );<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; $size = getimagesize($filename);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; $size[2] = $imageTypeArray[$size[2]];<br><br>Or something similar.</span>
</div>
  

#


<div class="phpcode"><span class="html">
Note that, if you&apos;re going to be a good programmer and use named constatnts (IMAGETYPE_JPEG) rather than their values (2), you want to use the IMAGETYPE variants - IMAGETYPE_JPEG, IMAGETYPE GIF, IMAGETYPE_PNG, etc.&#xA0; For some reason, somebody made a horrible decision, and IMG_PNG is actually 4 in my version of PHP, while IMAGETYPE_PNG is 3.&#xA0; It took me a while to figure out why comparing the type against IMG_PNG was failing...</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.getimagesize.php)

**[To root](/README.md)**