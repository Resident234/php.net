# parse_ini_string




<div class="phpcode"><span class="html">
parse_ini_string_m is analog for a parse_ini_string function.<br><br>had to code this function due to the lack of a php 5.3 on some hosting.<br><br>parse_ini_string_m:<br>- ignores commented lines that start with &quot;;&quot; or &quot;#&quot;<br>- ignores broken lines that do not have &quot;=&quot;<br>- supports array values and array value keys<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">parse_ini_string_m</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">) {<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; if(empty(</span><span class="default">$str</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="default">$lines </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&quot;\n&quot;</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$ret </span><span class="keyword">= Array();<br>&#xA0; &#xA0; </span><span class="default">$inside_section </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br><br>&#xA0; &#xA0; foreach(</span><span class="default">$lines </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if(!</span><span class="default">$line </span><span class="keyword">|| </span><span class="default">$line</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">&quot;#&quot; </span><span class="keyword">|| </span><span class="default">$line</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">&quot;;&quot;</span><span class="keyword">) continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$line</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] == </span><span class="string">&quot;[&quot; </span><span class="keyword">&amp;</span><span class="default">amp</span><span class="keyword">;&amp;</span><span class="default">amp</span><span class="keyword">; </span><span class="default">$endIdx </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">&quot;]&quot;</span><span class="keyword">)){<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$inside_section </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">$endIdx</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; continue;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if(!</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$line</span><span class="keyword">, </span><span class="string">&apos;=&apos;</span><span class="keyword">)) continue;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&quot;=&quot;</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$inside_section</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&quot;/^\&quot;.*\&quot;$/&quot;</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) || </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&quot;/^&apos;.*&apos;$/&quot;</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$value </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) - </span><span class="default">2</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$t </span><span class="keyword">= </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&quot;^\[(.*?)\]^&quot;</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">, </span><span class="default">$matches</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(!empty(</span><span class="default">$matches</span><span class="keyword">) &amp;</span><span class="default">amp</span><span class="keyword">;&amp;</span><span class="default">amp</span><span class="keyword">; isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$arr_name </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">&apos;#\[(.*?)\]#is&apos;</span><span class="keyword">, </span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(!isset(</span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">$arr_name</span><span class="keyword">]) || !</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">$arr_name</span><span class="keyword">])) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">$arr_name</span><span class="keyword">] = array();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(isset(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) &amp;</span><span class="default">amp</span><span class="keyword">;&amp;</span><span class="default">amp</span><span class="keyword">; !empty(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">])) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">$arr_name</span><span class="keyword">][</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]] = </span><span class="default">$value</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">$arr_name</span><span class="keyword">][] = </span><span class="default">$value</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$inside_section</span><span class="keyword">][</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])] = </span><span class="default">$value</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br><br>&#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])] = </span><span class="default">ltrim</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; return </span><span class="default">$ret</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>example usage:<br><br><span class="default">&lt;?php<br>$ini </span><span class="keyword">= </span><span class="string">&apos;<br><br>&#xA0; &#xA0; [simple]<br>&#xA0; &#xA0; val_one = &quot;some value&quot;<br>&#xA0; &#xA0; val_two = 567<br><br>&#xA0; &#xA0; [array]<br>&#xA0; &#xA0; val_arr[] = &quot;arr_elem_one&quot;<br>&#xA0; &#xA0; val_arr[] = &quot;arr_elem_two&quot;<br>&#xA0; &#xA0; val_arr[] = &quot;arr_elem_three&quot;<br><br>&#xA0; &#xA0; [array_keys]<br>&#xA0; &#xA0; val_arr_two[6] = &quot;key_6&quot;<br>&#xA0; &#xA0; val_arr_two[some_key] = &quot;some_key_value&quot;<br><br>&apos;</span><span class="keyword">;<br><br></span><span class="default">$arr </span><span class="keyword">= </span><span class="default">parse_ini_string_m</span><span class="keyword">(</span><span class="default">$ini</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>variable $arr output:<br><br>Array<br>(<br>&#xA0; &#xA0; [simple] =&gt; Array<br>&#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; [val_one] =&gt; some value<br>&#xA0; &#xA0; &#xA0; &#xA0; [val_two] =&gt; 567<br>&#xA0; &#xA0; )<br><br>&#xA0; &#xA0; [array] =&gt; Array<br>&#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; [val_arr] =&gt; Array<br>&#xA0; &#xA0; &#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [0] =&gt; arr_elem_one<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [1] =&gt; arr_elem_two<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [2] =&gt; arr_elem_three<br>&#xA0; &#xA0; &#xA0; &#xA0; )<br>&#xA0; &#xA0; )<br><br>&#xA0; &#xA0; [array_keys] =&gt; Array<br>&#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; [val_arr_two] =&gt; Array<br>&#xA0; &#xA0; &#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [6] =&gt; key_6<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [some_key] =&gt; some_key_value<br>&#xA0; &#xA0; &#xA0; &#xA0; )<br><br>&#xA0; &#xA0; )<br><br>)</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.parse-ini-string.php)

**[⬆ to root](/)**