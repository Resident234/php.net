# Spotting References




<div class="phpcode"><span class="html">
Hi,<br><br>If you want to check if two variables are referencing each other (i.e. point to the same memory) you can use a function like this:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">same_type</span><span class="keyword">(&amp;</span><span class="default">$var1</span><span class="keyword">, &amp;</span><span class="default">$var2</span><span class="keyword">){<br>&#xA0; &#xA0; return </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">) === </span><span class="default">gettype</span><span class="keyword">(</span><span class="default">$var2</span><span class="keyword">);<br>}<br><br>function </span><span class="default">is_ref</span><span class="keyword">(&amp;</span><span class="default">$var1</span><span class="keyword">, &amp;</span><span class="default">$var2</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="comment">//If a reference exists, the type IS the same<br>&#xA0; &#xA0; </span><span class="keyword">if(!</span><span class="default">same_type</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">, </span><span class="default">$var2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="comment">//We now only need to ask for var1 to be an array ;-)<br>&#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Look for an unused index in $var1<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">do {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">&quot;is_ref_&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; } while(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var1</span><span class="keyword">));<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//The two variables differ in content ... They can&apos;t be the same<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//The arrays point to the same data if changes are reflected in $var2<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">&quot;is_ref_data_&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$var1</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] =&amp; </span><span class="default">$data</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//There seems to be a modification ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$var2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$var2</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] === </span><span class="default">$data</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Undo our changes ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">unset(</span><span class="default">$var1</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">]);<br>&#xA0; &#xA0; } elseif(</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//The same objects are required to have equal class names ;-)<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">) !== </span><span class="default">get_class</span><span class="keyword">(</span><span class="default">$var2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$obj1 </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$obj2 </span><span class="keyword">= </span><span class="default">array_keys</span><span class="keyword">(</span><span class="default">get_object_vars</span><span class="keyword">(</span><span class="default">$var2</span><span class="keyword">));<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Look for an unused index in $var1<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">do {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">&quot;is_ref_&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; } while(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$obj1</span><span class="keyword">));<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//The two variables differ in content ... They can&apos;t be the same<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">in_array</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$obj2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//The arrays point to the same data if changes are reflected in $var2<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$data </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">&quot;is_ref_data_&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$var1</span><span class="keyword">-&gt;</span><span class="default">$key </span><span class="keyword">=&amp; </span><span class="default">$data</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//There seems to be a modification ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(isset(</span><span class="default">$var2</span><span class="keyword">-&gt;</span><span class="default">$key</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">$var2</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] === </span><span class="default">$data</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Undo our changes ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">unset(</span><span class="default">$var1</span><span class="keyword">-&gt;</span><span class="default">$key</span><span class="keyword">);<br>&#xA0; &#xA0; } elseif (</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if(</span><span class="default">get_resource_type</span><span class="keyword">(</span><span class="default">$var1</span><span class="keyword">) !== </span><span class="default">get_resource_type</span><span class="keyword">(</span><span class="default">$var2</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return ((string) </span><span class="default">$var1</span><span class="keyword">) === ((string) </span><span class="default">$var2</span><span class="keyword">);<br>&#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Simple variables ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if(</span><span class="default">$var1</span><span class="keyword">!==</span><span class="default">$var2</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//Data mismatch ... They can&apos;t be the same ...<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//To check for a reference of a variable with simple type<br>&#xA0; &#xA0; &#xA0; &#xA0; //simply store its old value and check against modifications of the second variable ;-)<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">do {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key </span><span class="keyword">= </span><span class="default">uniqid</span><span class="keyword">(</span><span class="string">&quot;is_ref_&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; } while(</span><span class="default">$key </span><span class="keyword">=== </span><span class="default">$var1</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">$var1</span><span class="keyword">; </span><span class="comment">//WE NEED A COPY HERE!!!<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$var1 </span><span class="keyword">= </span><span class="default">$key</span><span class="keyword">; </span><span class="comment">//Set var1 to the value of $key (copy)<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$same </span><span class="keyword">= </span><span class="default">$var1 </span><span class="keyword">=== </span><span class="default">$var2</span><span class="keyword">; </span><span class="comment">//Check if $var2 was modified too ...<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$var1 </span><span class="keyword">= </span><span class="default">$tmp</span><span class="keyword">; </span><span class="comment">//Undo our changes ...<br>&#xA0; &#xA0; </span><span class="keyword">}<br><br>&#xA0; &#xA0; return </span><span class="default">$same</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;<br></span><br>Although this implementation is quite complete, it can&apos;t handle function references and some other minor stuff ATM.<br>This function is especially useful if you want to serialize a recursive array by hand.<br><br>The usage is something like:<br><span class="default">&lt;?php<br>$a </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br></span><span class="default">$b </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)); </span><span class="comment">//false<br><br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br></span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)); </span><span class="comment">//false<br><br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;<br></span><span class="default">$b </span><span class="keyword">=&amp; </span><span class="default">$a</span><span class="keyword">;<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)); </span><span class="comment">//true<br></span><span class="keyword">echo </span><span class="string">&quot;---\n&quot;</span><span class="keyword">;<br><br></span><span class="default">$a </span><span class="keyword">= array();<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">)); </span><span class="comment">//true<br><br></span><span class="default">$a</span><span class="keyword">[] =&amp; </span><span class="default">$a</span><span class="keyword">;<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])); </span><span class="comment">// true<br></span><span class="keyword">echo </span><span class="string">&quot;---\n&quot;</span><span class="keyword">;<br><br></span><span class="default">$b </span><span class="keyword">= array(array());<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)); </span><span class="comment">//true<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])); </span><span class="comment">//false<br></span><span class="keyword">echo </span><span class="string">&quot;---\n&quot;</span><span class="keyword">;<br><br></span><span class="default">$b </span><span class="keyword">= array();<br></span><span class="default">$b</span><span class="keyword">[] = </span><span class="default">$b</span><span class="keyword">;<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)); </span><span class="comment">//true<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])); </span><span class="comment">//false<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">is_ref</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$b</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])); </span><span class="comment">//true*<br></span><span class="keyword">echo </span><span class="string">&quot;---\n&quot;</span><span class="keyword">;<br><br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br><br></span><span class="default">?&gt;<br></span><br>* Please note the internal behaviour of PHP that seems to do the reference assignment BEFORE actually copying the variable!!! Thus you get an array containing a (different) recursive array for the last testcase, instead of an array containing an empty array as you could expect.<br><br>BenBE.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/language.references.spot.php)

**[To root](/)**