# Zip Functions




<div class="phpcode"><span class="html">
This is the function I use to unzip a file. <br>It includes the following options:<br>* Unzip in any directory you like<br>* Unzip in the directory of the zip file<br>* Unzip in a directory with the zipfile&apos;s name in the directory of the zip file. (i.e.: C:\test.zip will be unzipped in&#xA0; C:\test\)<br>* Overwrite existing files or not<br>* It creates non existing directories with the function Create_dirs($path)<br><br>You should use absolute paths with slashes (/) instead of backslashes (\).<br>I tested it with PHP 5.2.0 with php_zip.dll extension loaded<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Unzip the source_file in the destination dir<br> *<br> * @param&#xA0;&#xA0; string&#xA0; &#xA0; &#xA0; The path to the ZIP-file.<br> * @param&#xA0;&#xA0; string&#xA0; &#xA0; &#xA0; The path where the zipfile should be unpacked, if false the directory of the zip-file is used<br> * @param&#xA0;&#xA0; boolean&#xA0; &#xA0;&#xA0; Indicates if the files will be unpacked in a directory with the name of the zip-file (true) or not (false) (only if the destination directory is set to false!)<br> * @param&#xA0;&#xA0; boolean&#xA0; &#xA0;&#xA0; Overwrite existing files (true) or not (false)<br> *&#xA0; <br> * @return&#xA0; boolean&#xA0; &#xA0;&#xA0; Succesful or not<br> */<br></span><span class="keyword">function </span><span class="default">unzip</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">$dest_dir</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">, </span><span class="default">$create_zip_name_dir</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">, </span><span class="default">$overwrite</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) <br>{<br>&#xA0; if (</span><span class="default">$zip </span><span class="keyword">= </span><span class="default">zip_open</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">)) <br>&#xA0; {<br>&#xA0; &#xA0; if (</span><span class="default">$zip</span><span class="keyword">) <br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$splitter </span><span class="keyword">= (</span><span class="default">$create_zip_name_dir </span><span class="keyword">=== </span><span class="default">true</span><span class="keyword">) ? </span><span class="string">&quot;.&quot; </span><span class="keyword">: </span><span class="string">&quot;/&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; if (</span><span class="default">$dest_dir </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) </span><span class="default">$dest_dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$src_file</span><span class="keyword">, </span><span class="default">$splitter</span><span class="keyword">)).</span><span class="string">&quot;/&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; </span><span class="comment">// Create the directories to the destination dir if they don&apos;t already exist<br>&#xA0; &#xA0; &#xA0; </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$dest_dir</span><span class="keyword">);<br><br>&#xA0; &#xA0; &#xA0; </span><span class="comment">// For every file in the zip-packet<br>&#xA0; &#xA0; &#xA0; </span><span class="keyword">while (</span><span class="default">$zip_entry </span><span class="keyword">= </span><span class="default">zip_read</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">)) <br>&#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Now we&apos;re going to create the directories in the destination directories<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; // If the file is not in the root dir<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$pos_last_slash </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="string">&quot;/&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$pos_last_slash </span><span class="keyword">!== </span><span class="default">false</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Create the directory where the zip-entry should be saved (with a &quot;/&quot; at the end)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$dest_dir</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos_last_slash</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Open the entry<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">zip_entry_open</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">,</span><span class="default">$zip_entry</span><span class="keyword">,</span><span class="string">&quot;r&quot;</span><span class="keyword">)) <br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// The name of the file to save on the disk<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$file_name </span><span class="keyword">= </span><span class="default">$dest_dir</span><span class="keyword">.</span><span class="default">zip_entry_name</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Check if the files should be overwritten or not<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">$overwrite </span><span class="keyword">=== </span><span class="default">true </span><span class="keyword">|| </span><span class="default">$overwrite </span><span class="keyword">=== </span><span class="default">false </span><span class="keyword">&amp;&amp; !</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Get the content of the zip entry<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$fstream </span><span class="keyword">= </span><span class="default">zip_entry_read</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">, </span><span class="default">zip_entry_filesize</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">));<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">, </span><span class="default">$fstream </span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Set the rights<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$file_name</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="string">&quot;save: &quot;</span><span class="keyword">.</span><span class="default">$file_name</span><span class="keyword">.</span><span class="string">&quot;&lt;br /&gt;&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Close the entry<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">zip_entry_close</span><span class="keyword">(</span><span class="default">$zip_entry</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; }&#xA0; &#xA0; &#xA0;&#xA0; <br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; </span><span class="comment">// Close the zip-file<br>&#xA0; &#xA0; &#xA0; </span><span class="default">zip_close</span><span class="keyword">(</span><span class="default">$zip</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; } <br>&#xA0; else<br>&#xA0; {<br>&#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; }<br>&#xA0; <br>&#xA0; return </span><span class="default">true</span><span class="keyword">;<br>}<br><br></span><span class="comment">/**<br> * This function creates recursive directories if it doesn&apos;t already exist<br> *<br> * @param String&#xA0; The path that should be created<br> *&#xA0; <br> * @return&#xA0; void<br> */<br></span><span class="keyword">function </span><span class="default">create_dirs</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br>{<br>&#xA0; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">))<br>&#xA0; {<br>&#xA0; &#xA0; </span><span class="default">$directory_path </span><span class="keyword">= </span><span class="string">&quot;&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$directories </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&quot;/&quot;</span><span class="keyword">,</span><span class="default">$path</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$directories</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; foreach(</span><span class="default">$directories </span><span class="keyword">as </span><span class="default">$directory</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$directory_path </span><span class="keyword">.= </span><span class="default">$directory</span><span class="keyword">.</span><span class="string">&quot;/&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; if (!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chmod</span><span class="keyword">(</span><span class="default">$directory_path</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; }<br>}<br><br></span><span class="comment">// Extract C:/zipfiletest/zip-file.zip to C:/zipfiletest/zip-file/ and overwrites existing files<br></span><span class="default">unzip</span><span class="keyword">(</span><span class="string">&quot;C:/zipfiletest/zip-file.zip&quot;</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br></span><span class="comment">// Extract C:/zipfiletest/zip-file.zip to C:/another_map/zipfiletest/ and doesn&apos;t overwrite existing files. NOTE: It doesn&apos;t create a map with the zip-file-name!<br></span><span class="default">unzip</span><span class="keyword">(</span><span class="string">&quot;C:/zipfiletest/zip-file.zip&quot;</span><span class="keyword">, </span><span class="string">&quot;C:/another_map/zipfiletest/&quot;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/ref.zip.php)

**[⬆ to root](/)**