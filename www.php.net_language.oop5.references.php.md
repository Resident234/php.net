# Objects and references




<div class="phpcode"><span class="html">
Notes on reference:<br>A reference is not a pointer. However, an object handle IS a pointer. Example:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">Foo </span><span class="keyword">{<br>&#xA0; private static </span><span class="default">$used</span><span class="keyword">;<br>&#xA0; private </span><span class="default">$id</span><span class="keyword">;<br>&#xA0; public function </span><span class="default">__construct</span><span class="keyword">() {<br>&#xA0; &#xA0; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$used</span><span class="keyword">++;<br>&#xA0; }<br>&#xA0; public function </span><span class="default">__clone</span><span class="keyword">() {<br>&#xA0; &#xA0; </span><span class="default">$id </span><span class="keyword">= </span><span class="default">$used</span><span class="keyword">++;<br>&#xA0; }<br>}<br><br></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">; </span><span class="comment">// $a is a pointer pointing to Foo object 0<br></span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $b is a pointer pointing to Foo object 0, however, $b is a copy of $a<br></span><span class="default">$c </span><span class="keyword">= &amp;</span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $c and $a are now references of a pointer pointing to Foo object 0<br></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">; </span><span class="comment">// $a and $c are now references of a pointer pointing to Foo object 1, $b is still a pointer pointing to Foo object 0<br></span><span class="keyword">unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// A reference with reference count 1 is automatically converted back to a value. Now $c is a pointer to Foo object 1<br></span><span class="default">$a </span><span class="keyword">= &amp;</span><span class="default">$b</span><span class="keyword">; </span><span class="comment">// $a and $b are now references of a pointer pointing to Foo object 0<br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">; </span><span class="comment">// $a and $b now become a reference to NULL. Foo object 0 can be garbage collected now<br></span><span class="keyword">unset(</span><span class="default">$b</span><span class="keyword">); </span><span class="comment">// $b no longer exists and $a is now NULL<br></span><span class="default">$a </span><span class="keyword">= clone </span><span class="default">$c</span><span class="keyword">; </span><span class="comment">// $a is now a pointer to Foo object 2, $c remains a pointer to Foo object 1<br></span><span class="keyword">unset(</span><span class="default">$c</span><span class="keyword">); </span><span class="comment">// Foo object 1 can be garbage collected now.<br></span><span class="default">$c </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $c and $a are pointers pointing to Foo object 2<br></span><span class="keyword">unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Foo object 2 is still pointed by $c<br></span><span class="default">$a </span><span class="keyword">= &amp;</span><span class="default">$c</span><span class="keyword">; </span><span class="comment">// Foo object 2 has 1 pointers pointing to it only, that pointer has 2 references: $a and $c;<br></span><span class="keyword">const </span><span class="default">ABC </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br>if(</span><span class="default">ABC</span><span class="keyword">) {<br>&#xA0; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">; </span><span class="comment">// Foo object 2 can be garbage collected now because $a and $c are now a reference to the same NULL value<br></span><span class="keyword">} else {<br>&#xA0; unset(</span><span class="default">$a</span><span class="keyword">); </span><span class="comment">// Foo object 2 is still pointed to $c<br></span><span class="keyword">}</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
There seems to be some confusion here. The distinction between pointers and references is not particularly helpful.<br>The behavior in some of the &quot;comprehensive&quot; examples already posted can be explained in simpler unifying terms. Hayley&apos;s code, for example, is doing EXACTLY what you should expect it should. (Using &gt;= 5.3)<br><br>First principle:<br>A pointer stores a memory address to access an object. Any time an object is assigned, a pointer is generated. (I haven&apos;t delved TOO deeply into the Zend engine yet, but as far as I can see, this applies)<br><br>2nd principle, and source of the most confusion:<br>Passing a variable to a function is done by default as a value pass, ie, you are working with a copy. &quot;But objects are passed by reference!&quot; A common misconception both here and in the Java world. I never said a copy OF WHAT. The default passing is done by value. Always. WHAT is being copied and passed, however, is the pointer. When using the &quot;-&gt;&quot;, you will of course be accessing the same internals as the original variable in the caller function. Just using &quot;=&quot; will only play with copies.<br><br>3rd principle:<br>&quot;&amp;&quot; automatically and permanently sets another variable name/pointer to the same memory address as something else until you decouple them. It is correct to use the term &quot;alias&quot; here. Think of it as joining two pointers at the hip until forcibly separated with &quot;unset()&quot;. This functionality exists both in the same scope and when an argument is passed to a function. Often the passed argument is called a &quot;reference,&quot; due to certain distinctions between &quot;passing by value&quot; and &quot;passing by reference&quot; that were clearer in C and C++.<br><br>Just remember: pointers to objects, not objects themselves, are passed to functions. These pointers are COPIES of the original unless you use &quot;&amp;&quot; in your parameter list to actually pass the originals. Only when you dig into the internals of an object will the originals change.<br><br>Example:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">//The two are meant to be the same<br></span><span class="default">$a </span><span class="keyword">= </span><span class="string">&quot;Clark Kent&quot;</span><span class="keyword">; </span><span class="comment">//a==Clark Kent<br></span><span class="default">$b </span><span class="keyword">= &amp;</span><span class="default">$a</span><span class="keyword">; </span><span class="comment">//The two will now share the same fate.<br><br></span><span class="default">$b</span><span class="keyword">=</span><span class="string">&quot;Superman&quot;</span><span class="keyword">; </span><span class="comment">// $a==&quot;Superman&quot; too.<br></span><span class="keyword">echo </span><span class="default">$a</span><span class="keyword">; <br>echo </span><span class="default">$a</span><span class="keyword">=</span><span class="string">&quot;Clark Kent&quot;</span><span class="keyword">; </span><span class="comment">// $b==&quot;Clark Kent&quot; too.<br></span><span class="keyword">unset(</span><span class="default">$b</span><span class="keyword">); </span><span class="comment">// $b divorced from $a<br></span><span class="default">$b</span><span class="keyword">=</span><span class="string">&quot;Bizarro&quot;</span><span class="keyword">;<br>echo </span><span class="default">$a</span><span class="keyword">; </span><span class="comment">// $a==&quot;Clark Kent&quot; still, since $b is a free agent pointer now.<br><br>//The two are NOT meant to be the same.<br></span><span class="default">$c</span><span class="keyword">=</span><span class="string">&quot;King&quot;</span><span class="keyword">;<br></span><span class="default">$d</span><span class="keyword">=</span><span class="string">&quot;Pretender to the Throne&quot;</span><span class="keyword">;<br>echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $c==&quot;King&quot;<br></span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $d==&quot;Pretender to the Throne&quot;<br></span><span class="default">swapByValue</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">);<br>echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $c==&quot;King&quot;<br></span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $d==&quot;Pretender to the Throne&quot;<br></span><span class="default">swapByRef</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">);<br>echo </span><span class="default">$c</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $c==&quot;Pretender to the Throne&quot;<br></span><span class="keyword">echo </span><span class="default">$d</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// $d==&quot;King&quot;<br><br></span><span class="keyword">function </span><span class="default">swapByValue</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">){<br></span><span class="default">$temp</span><span class="keyword">=</span><span class="default">$x</span><span class="keyword">;<br></span><span class="default">$x</span><span class="keyword">=</span><span class="default">$y</span><span class="keyword">;<br></span><span class="default">$y</span><span class="keyword">=</span><span class="default">$temp</span><span class="keyword">;<br></span><span class="comment">//All this beautiful work will disappear<br>//because it was done on COPIES of pointers.<br>//The originals pointers still point as they did.<br></span><span class="keyword">}<br><br>function </span><span class="default">swapByRef</span><span class="keyword">(&amp;</span><span class="default">$x</span><span class="keyword">, &amp;</span><span class="default">$y</span><span class="keyword">){<br> </span><span class="default">$temp</span><span class="keyword">=</span><span class="default">$x</span><span class="keyword">;<br> </span><span class="default">$x</span><span class="keyword">=</span><span class="default">$y</span><span class="keyword">;<br> </span><span class="default">$y</span><span class="keyword">=</span><span class="default">$temp</span><span class="keyword">;<br> </span><span class="comment">//Note the parameter list: now we switched &apos;em REAL good.<br></span><span class="keyword">}<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
I&apos;ve bumped into a behavior that helped clarify the difference between objects and identifiers for me.<br><br>When we hand off an object variable, we get an identifier to that object&apos;s value.&#xA0; This means that if I were to mutate the object from a passed variable, ALL variables originating from that instance of the object will change.&#xA0; <br><br>HOWEVER, if I set that object variable to new instance, it replaces the identifier itself with a new identifier and leaves the old instance in tact.<br><br>Take the following example:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br>&#xA0; &#xA0; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>}&#xA0; <br><br>class </span><span class="default">B </span><span class="keyword">{<br>&#xA0; &#xA0; public function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">42</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; public function </span><span class="default">bar</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}<br><br></span><span class="default">$f </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br></span><span class="default">$g </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;<br>echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br><br></span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br>echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br><br></span><span class="default">$g</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">(</span><span class="default">$f</span><span class="keyword">);<br>echo </span><span class="default">$f</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">. </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br><br></span><span class="default">?&gt;<br></span><br>If object variables were always references, we&apos;d expect the following output:<br>1<br>42<br>1<br><br>However, we get:<br>1<br>42<br>42<br><br>The reason for this is simple.&#xA0; In the bar function of the B class, we replace the identifier you passed in, which identified the same instance of the A class as your $f variable, with a brand new A class identifier.&#xA0; Creating a new instance of A doesn&apos;t mutate $f because $f wasn&apos;t passed as a reference.<br><br>To get the reference behavior, one would have to enter the following for class B:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">B </span><span class="keyword">{<br>&#xA0; &#xA0; public function </span><span class="default">foo</span><span class="keyword">(</span><span class="default">A $bar</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bar</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">42</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; public function </span><span class="default">bar</span><span class="keyword">(</span><span class="default">A </span><span class="keyword">&amp;</span><span class="default">$bar</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bar </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}<br></span><span class="default">?&gt;<br></span><br>The foo function doesn&apos;t require a reference, because it is MUTATING an object instance that $bar identifies.&#xA0; But bar will be REPLACING the object instance.&#xA0; If only an identifier is passed, the variable identifier will be overwritten but the object instance will be left in place.</span>
</div>
  

#


<div class="phpcode"><span class="html">
I hope this clarifies references a bit more:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">A </span><span class="keyword">{<br>&#xA0; &#xA0; public </span><span class="default">$foo </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>}&#xA0; <br><br></span><span class="default">$a </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br></span><span class="default">$b </span><span class="keyword">= </span><span class="default">$a</span><span class="keyword">;<br></span><span class="default">$a</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br></span><span class="default">$a </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>echo </span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// 2<br><br></span><span class="default">$c </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;<br></span><span class="default">$d </span><span class="keyword">= &amp;</span><span class="default">$c</span><span class="keyword">;<br></span><span class="default">$c</span><span class="keyword">-&gt;</span><span class="default">foo </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">;<br></span><span class="default">$c </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br>echo </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">foo</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">; </span><span class="comment">// Notice:&#xA0; Trying to get property of non-object...<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Ultimate explanation to object references:<br>NOTE: wording &apos;points to&apos; could be easily replaced with &apos;refers &apos; and is used loosly.<br><span class="default">&lt;?php<br>$a1 </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);&#xA0; </span><span class="comment">// $a1 == handle1-1 to A(1)<br></span><span class="default">$a2 </span><span class="keyword">= </span><span class="default">$a1</span><span class="keyword">;&#xA0; &#xA0;&#xA0; </span><span class="comment">// $a2 == handle1-2 to A(1) - assigned by value (copy)<br></span><span class="default">$a3 </span><span class="keyword">= &amp;</span><span class="default">$a1</span><span class="keyword">;&#xA0; </span><span class="comment">// $a3 points to $a1 (handle1-1)<br></span><span class="default">$a3 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&#xA0; &#xA0; &#xA0; </span><span class="comment">// makes $a1==null, $a3 (still) points to $a1, $a2 == handle1-2 (same object instance A(1))<br></span><span class="default">$a2 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&#xA0; &#xA0; &#xA0; </span><span class="comment">// makes $a2 == null<br></span><span class="default">$a1 </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">); </span><span class="comment">//makes $a1 == handle2-1 to new object and $a3 (still) points to $a1 =&gt; handle2-1 (new object), so value of $a1 and $a3 is the new object and $a2 == null<br>//By reference:<br></span><span class="default">$a4 </span><span class="keyword">= &amp;new </span><span class="default">A</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);&#xA0; </span><span class="comment">//$a4 points to handle4-1 to A(4)<br></span><span class="default">$a5 </span><span class="keyword">= </span><span class="default">$a4</span><span class="keyword">;&#xA0;&#xA0; </span><span class="comment">// $a5 == handle4-2 to A(4) (copy)<br></span><span class="default">$a6 </span><span class="keyword">= &amp;</span><span class="default">$a4</span><span class="keyword">;&#xA0; </span><span class="comment">//$a6 points to (handle4-1), not to $a4 (reference to reference references the referenced object handle4-1 not the reference itself)<br><br></span><span class="default">$a4 </span><span class="keyword">= &amp;new </span><span class="default">A</span><span class="keyword">(</span><span class="default">40</span><span class="keyword">); </span><span class="comment">// $a4 points to handle40-1, $a5 == handle4-2 and $a6 still points to handle4-1 to A(4)<br></span><span class="default">$a6 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;&#xA0; </span><span class="comment">// sets handle4-1 to null; $a5 == handle4-2 = A(4); $a4 points to handle40-1; $a6 points to null<br></span><span class="default">$a6 </span><span class="keyword">=&amp;</span><span class="default">$a4</span><span class="keyword">; </span><span class="comment">// $a6 points to handle40-1<br></span><span class="default">$a7 </span><span class="keyword">= &amp;</span><span class="default">$a6</span><span class="keyword">; </span><span class="comment">//$a7 points to handle40-1<br></span><span class="default">$a8 </span><span class="keyword">= &amp;</span><span class="default">$a7</span><span class="keyword">; </span><span class="comment">//$a8 points to handle40-1<br></span><span class="default">$a5 </span><span class="keyword">= </span><span class="default">$a7</span><span class="keyword">;&#xA0; </span><span class="comment">//$a5 == handle40-2 (copy)<br></span><span class="default">$a6 </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">; </span><span class="comment">//makes handle40-1 null, all variables pointing to (hanlde40-1 ==null) are null, except ($a5 == handle40-2 = A(40))<br></span><span class="default">?&gt;<br></span>Hope this helps.</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/language.oop5.references.php)

**[To root](/)**