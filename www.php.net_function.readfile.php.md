# readfile




<div class="phpcode"><span class="html">
Just a note for those who face problems on names containing spaces (e.g. &quot;test test.pdf&quot;).<br><br>In the examples (99% of the time) you can find<br>header(&apos;Content-Disposition: attachment; filename=&apos;.basename($file));<br><br>but the correct way to set the filename is quoting it (double quote):<br>header(&apos;Content-Disposition: attachment; filename=&quot;&apos;.basename($file).&apos;&quot;&apos; );<br><br>Some browsers may work without quotation, but for sure not Firefox and as Mozilla explains, the quotation of the filename in the content-disposition is according to the RFC<br><a href="http://kb.mozillazine.org/Filenames_with_spaces_are_truncated_upon_download" rel="nofollow" target="_blank">http://kb.mozillazine.org/Filenames_with_spaces_are_truncated_upon_download</a></span>
</div>
  

#


<div class="phpcode"><span class="html">
if you need to limit download rate, use this code <br><br><span class="default">&lt;?php<br>$local_file </span><span class="keyword">= </span><span class="string">&apos;file.zip&apos;</span><span class="keyword">;<br></span><span class="default">$download_file </span><span class="keyword">= </span><span class="string">&apos;name.zip&apos;</span><span class="keyword">;<br><br></span><span class="comment">// set the download rate limit (=&gt; 20,5 kb/s)<br></span><span class="default">$download_rate </span><span class="keyword">= </span><span class="default">20.5</span><span class="keyword">;<br>if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">) &amp;&amp; </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">))<br>{<br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Cache-control: private&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-Type: application/octet-stream&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-Length: &apos;</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">));<br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-Disposition: filename=&apos;</span><span class="keyword">.</span><span class="default">$download_file</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="default">flush</span><span class="keyword">();<br>&#xA0; &#xA0; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">, </span><span class="string">&quot;r&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// send the current file part to the browser<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">print </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">round</span><span class="keyword">(</span><span class="default">$download_rate </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// flush the content to the browser<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">flush</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// sleep one second<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);}<br>else {<br>&#xA0; &#xA0; die(</span><span class="string">&apos;Error: The file &apos;</span><span class="keyword">.</span><span class="default">$local_file</span><span class="keyword">.</span><span class="string">&apos; does not exist!&apos;</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
regarding php5:<br>i found out that there is already a disscussion @php-dev&#xA0; about readfile() and fpassthru() where only exactly 2 MB will be delivered.<br><br>so you may use this on php5 to get lager files<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">readfile_chunked</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$retbytes</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="default">$chunksize </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">*(</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">); </span><span class="comment">// how many bytes per chunk<br>&#xA0; &#xA0; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$cnt </span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="comment">// $handle = fopen($filename, &apos;rb&apos;);<br>&#xA0; &#xA0; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">&apos;rb&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; if (</span><span class="default">$handle </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$chunksize</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="default">$buffer</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$retbytes</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$cnt </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$status </span><span class="keyword">= </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br>&#xA0; &#xA0; if (</span><span class="default">$retbytes </span><span class="keyword">&amp;&amp; </span><span class="default">$status</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$cnt</span><span class="keyword">; </span><span class="comment">// return num. bytes delivered like readfile() does.<br>&#xA0; &#xA0; </span><span class="keyword">} <br>&#xA0; &#xA0; return </span><span class="default">$status</span><span class="keyword">;<br><br>} <br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
My script working correctly on IE6 and Firefox 2 with any typ e of files (I hope :))<br><br>function DownloadFile($file) { // $file = include path <br>&#xA0; &#xA0; &#xA0; &#xA0; if(file_exists($file)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Content-Description: File Transfer&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Content-Type: application/octet-stream&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Content-Disposition: attachment; filename=&apos;.basename($file));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Content-Transfer-Encoding: binary&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Expires: 0&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Cache-Control: must-revalidate, post-check=0, pre-check=0&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Pragma: public&apos;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; header(&apos;Content-Length: &apos; . filesize($file));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ob_clean();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; flush();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; readfile($file);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; }<br><br>Run on Apache 2 (WIN32) PHP5</span>
</div>
  

#


<div class="phpcode"><span class="html">
To anyone that&apos;s had problems with Readfile() reading large files into memory the problem is not Readfile() itself, it&apos;s because you have output buffering on. Just turn off output buffering immediately before the call to Readfile(). Use something like ob_end_flush().</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.readfile.php)

**[⬆ to root](/)**