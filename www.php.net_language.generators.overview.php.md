# Generators overview




<div class="phpcode"><span class="html">
for the protection from the leaking of resources <br>see RFC <a href="https://wiki.php.net/rfc/generators#closing_a_generator" rel="nofollow" target="_blank">https://wiki.php.net/rfc/generators#closing_a_generator</a><br><br>and use finnaly<br><br>sample code<br><br>function getLines($file) {<br>&#xA0; &#xA0; $f = fopen($file, &apos;r&apos;);<br>&#xA0; &#xA0; try {<br>&#xA0; &#xA0; &#xA0; &#xA0; while ($line = fgets($f)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; yield $line;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; } finally {<br>&#xA0; &#xA0; &#xA0; &#xA0; fclose($f);<br>&#xA0; &#xA0; }<br>}<br><br>foreach (getLines(&quot;file.txt&quot;) as $n =&gt; $line) {<br>&#xA0; &#xA0; if ($n &gt; 5) break;<br>&#xA0; &#xA0; echo $line;<br>}</span>
</div>
  

#


<div class="phpcode"><span class="html">
Bear in mind that execution of a generator function is postponed until iteration over its result (the Generator object) begins. This might confuse one if the result of a generator is assigned to a variable instead of immediate iteration.<br><br><span class="default">&lt;?php<br><br>$some_state </span><span class="keyword">= </span><span class="string">&apos;initial&apos;</span><span class="keyword">;<br><br>function </span><span class="default">gen</span><span class="keyword">() {<br>&#xA0; &#xA0; global </span><span class="default">$some_state</span><span class="keyword">; <br><br>&#xA0; &#xA0; echo </span><span class="string">&quot;gen() execution start\n&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$some_state </span><span class="keyword">= </span><span class="string">&quot;changed&quot;</span><span class="keyword">;<br><br>&#xA0; &#xA0; yield </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; yield </span><span class="default">2</span><span class="keyword">;<br>}<br><br>function </span><span class="default">peek_state</span><span class="keyword">() {<br>&#xA0; &#xA0; global </span><span class="default">$some_state</span><span class="keyword">;<br>&#xA0; &#xA0; echo </span><span class="string">&quot;\$some_state = </span><span class="default">$some_state</span><span class="string">\n&quot;</span><span class="keyword">;<br>}<br><br>echo </span><span class="string">&quot;calling gen()...\n&quot;</span><span class="keyword">;<br></span><span class="default">$result </span><span class="keyword">= </span><span class="default">gen</span><span class="keyword">();<br>echo </span><span class="string">&quot;gen() was called\n&quot;</span><span class="keyword">;<br><br></span><span class="default">peek_state</span><span class="keyword">();<br><br>echo </span><span class="string">&quot;iterating...\n&quot;</span><span class="keyword">;<br>foreach (</span><span class="default">$result </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">) {<br>&#xA0; &#xA0; echo </span><span class="string">&quot;iteration: </span><span class="default">$val</span><span class="string">\n&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">peek_state</span><span class="keyword">();<br>}<br><br></span><span class="default">?&gt;<br></span><br>If you need to perform some action when the function is called and before the result is used, you&apos;ll have to wrap your generator in another function.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br>&#xA0; * @return Generator<br>&#xA0; */<br></span><span class="keyword">function </span><span class="default">some_generator</span><span class="keyword">() {<br>&#xA0; &#xA0; global </span><span class="default">$some_state</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="default">$some_state </span><span class="keyword">= </span><span class="string">&quot;changed&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; return </span><span class="default">gen</span><span class="keyword">();<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Here&apos;s how to detect loop breaks, and how to handle or cleanup after an interruption.<br><br><span class="default">&lt;?php<br>&#xA0; &#xA0; </span><span class="keyword">function </span><span class="default">generator</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$complete </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; try {<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; while ((</span><span class="default">$result </span><span class="keyword">= </span><span class="default">some_function</span><span class="keyword">())) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; yield </span><span class="default">$result</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$complete </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; } finally {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">$complete</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// cleanup when loop breaks <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">} else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// cleanup when loop completes<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">}<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Do something only after loop completes<br>&#xA0; &#xA0; </span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Same example, different results:<br><br>----------------------------------<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; |&#xA0; time&#xA0; | memory, mb |<br>----------------------------------<br>| not gen&#xA0; | 0.7589 | 146.75&#xA0; &#xA0;&#xA0; |<br>|---------------------------------<br>| with gen | 0.7469 | 8.75&#xA0; &#xA0; &#xA0;&#xA0; |<br>|---------------------------------<br><br>Time in results varying from 6.5 to 7.8 on both examples.<br>So no real drawbacks concerning processing speed.</span>
</div>
  

#


<div class="phpcode"><span class="html">
Abstract test.<br><span class="default">&lt;?php<br><br>$start_time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br></span><span class="default">$array </span><span class="keyword">= array();<br></span><span class="default">$result </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>for(</span><span class="default">$count</span><span class="keyword">=</span><span class="default">1000000</span><span class="keyword">; </span><span class="default">$count</span><span class="keyword">--;)<br>{<br>&#xA0; </span><span class="default">$array</span><span class="keyword">[]=</span><span class="default">$count</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;<br>}<br>foreach(</span><span class="default">$array </span><span class="keyword">as </span><span class="default">$val</span><span class="keyword">)<br>{<br>&#xA0; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">145.56</span><span class="keyword">;<br>&#xA0; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">$val</span><span class="keyword">;<br>}<br></span><span class="default">$end_time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br><br>echo </span><span class="string">&quot;time: &quot;</span><span class="keyword">, </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$end_time</span><span class="keyword">, </span><span class="default">$start_time</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">), </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br>echo </span><span class="string">&quot;memory (byte): &quot;</span><span class="keyword">, </span><span class="default">memory_get_peak_usage</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">), </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br><br></span><span class="default">?&gt;<br></span><br><span class="default">&lt;?php<br><br>$start_time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br></span><span class="default">$result </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>function </span><span class="default">it</span><span class="keyword">()<br>{<br>&#xA0; for(</span><span class="default">$count</span><span class="keyword">=</span><span class="default">1000000</span><span class="keyword">; </span><span class="default">$count</span><span class="keyword">--;)<br>&#xA0; {<br>&#xA0; &#xA0; yield </span><span class="default">$count</span><span class="keyword">/</span><span class="default">2</span><span class="keyword">;<br>&#xA0; }<br>}<br>foreach(</span><span class="default">it</span><span class="keyword">() as </span><span class="default">$val</span><span class="keyword">)<br>{<br>&#xA0; </span><span class="default">$val </span><span class="keyword">+= </span><span class="default">145.56</span><span class="keyword">;<br>&#xA0; </span><span class="default">$result </span><span class="keyword">.= </span><span class="default">$val</span><span class="keyword">;<br>}<br></span><span class="default">$end_time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br><br>echo </span><span class="string">&quot;time: &quot;</span><span class="keyword">, </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$end_time</span><span class="keyword">, </span><span class="default">$start_time</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">), </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br>echo </span><span class="string">&quot;memory (byte): &quot;</span><span class="keyword">, </span><span class="default">memory_get_peak_usage</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">), </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br><br></span><span class="default">?&gt;<br></span>Result:<br>----------------------------------<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; |&#xA0; time&#xA0; | memory, mb |<br>----------------------------------<br>| not gen&#xA0; | 2.1216 | 89.25&#xA0; &#xA0; &#xA0; |<br>|---------------------------------<br>| with gen | 6.1963 | 8.75&#xA0; &#xA0; &#xA0;&#xA0; |<br>|---------------------------------<br>| diff&#xA0; &#xA0;&#xA0; | &lt; 192% | &gt; 90%&#xA0; &#xA0; &#xA0; |<br>----------------------------------</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/language.generators.overview.php)

**[To root](/README.md)**