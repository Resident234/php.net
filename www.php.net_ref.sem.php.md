# Semaphore Functions




<div class="phpcode"><span class="html">
Samlpe code for using most of the functions here:<br><br>&#xA0; &#xA0; $MEMSIZE&#xA0; &#xA0; =&#xA0;&#xA0; 512;//&#xA0; size of shared memory to allocate<br>&#xA0; &#xA0; $SEMKEY&#xA0; &#xA0;&#xA0; =&#xA0;&#xA0; 1;&#xA0; //&#xA0; Semaphore key<br>&#xA0; &#xA0; $SHMKEY&#xA0; &#xA0;&#xA0; =&#xA0;&#xA0; 2;&#xA0; //&#xA0; Shared memory key<br><br>&#xA0; &#xA0; echo &quot;Start.\n&quot;;<br>&#xA0; &#xA0; // Get semaphore<br>&#xA0; &#xA0; $sem_id = sem_get($SEMKEY, 1);<br>&#xA0; &#xA0; if ($sem_id === false)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to get semaphore&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Got semaphore $sem_id.\n&quot;;<br><br>&#xA0; &#xA0; // Accuire semaphore<br>&#xA0; &#xA0; if (! sem_acquire($sem_id))<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to aquire semaphore $sem_id.\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; sem_remove($sem_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Success aquire semaphore $sem_id.\n&quot;;<br><br>&#xA0; &#xA0; $shm_id =&#xA0;&#xA0; shm_attach($SHMKEY, $MEMSIZE);<br>&#xA0; &#xA0; if ($shm_id === false)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to attach shared memory.\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; sem_remove($sem_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Success to attach shared memory : $shm_id.\n&quot;;<br><br>&#xA0; &#xA0; // Write variable 1<br>&#xA0; &#xA0; if (!shm_put_var($shm_id, 1, &quot;Variable 1&quot;))<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to put var 1 on shared memory $shm_id.\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; sem_remove($sem_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; shm_remove ($shm_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Write var1 to shared memory.\n&quot;;<br><br>&#xA0; &#xA0; // Write variable 2<br>&#xA0; &#xA0; if (!shm_put_var($shm_id, 2, &quot;Variable 2&quot;))<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to put var 2 on shared memory $shm_id.\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; sem_remove($sem_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; shm_remove ($shm_id);<br>&#xA0; &#xA0; &#xA0; &#xA0; exit;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Write var2 to shared memory.\n&quot;;<br><br>&#xA0; &#xA0; // Read variable 1<br>&#xA0; &#xA0; $var1&#xA0;&#xA0; =&#xA0;&#xA0; shm_get_var ($shm_id, 1);<br>&#xA0; &#xA0; if ($var1 === false)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to retrive Var 1 from Shared memory $shm_id, return value=$var1.\n&quot;;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Read var1=$var1.\n&quot;;<br><br>&#xA0; &#xA0; // Read variable 1<br>&#xA0; &#xA0; $var2&#xA0;&#xA0; =&#xA0;&#xA0; shm_get_var ($shm_id, 2);<br>&#xA0; &#xA0; if ($var1 === false)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to retrive Var 2 from Shared memory $shm_id, return value=$var2.\n&quot;;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Read var2=$var2.\n&quot;;<br><br>&#xA0; &#xA0; // Release semaphore<br>&#xA0; &#xA0; if (!sem_release($sem_id))<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to release $sem_id semaphore.\n&quot;;<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Semaphore $sem_id released.\n&quot;;<br><br>&#xA0; &#xA0; // remove shared memory segmant from SysV<br>&#xA0; &#xA0; if (shm_remove ($shm_id))<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Shared memory successfully removed from SysV.\n&quot;;<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to remove $shm_id shared memory from SysV.\n&quot;;<br><br>&#xA0; &#xA0; // Remove semaphore<br>&#xA0; &#xA0; if (sem_remove($sem_id))<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;semaphore removed successfully from SysV.\n&quot;;<br>&#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Fail to remove $sem_id semaphore from SysV.\n&quot;;<br>&#xA0; &#xA0; echo &quot;End.\n&quot;;</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/ref.sem.php)

**[â¬† to root](/)**