# array_walk_recursive




<div class="phpcode"><span class="html">
Since this is only mentioned in the footnote of the output of one of the examples, I feel it should be spelled out:<br><br>* THIS FUNCTION ONLY VISITS LEAF NODES *<br><br>That is to say that if you have a tree of arrays with subarrays of subarrays, only the plain values at the leaves of the tree will be visited by the callback function.&#xA0; The callback function isn&apos;t ever called for a nodes in the tree that subnodes (i.e., a subarray).&#xA0; This has the effect as to make this function unusable for most practical situations.</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you are wanting to change the values of an existing multi-dimensional array, as it says above in the note, you need to specify the first argument as a reference. All that means is, be sure to precede the $item variable with an ampersand (&amp;) as in the good_example below. <br><br>Unfortunately the PHP example given doesn&apos;t do this. It actually took me a while to figure out why my function wasn&apos;t changing the original array, even though I was passing by reference. <br><br>Here&apos;s the tip: Don&apos;t return any value from the function! Just change the value of $item that you passed in by reference. This is rather counter-intuitive since the vast majority of functions return a value.<br><br><span class="default">&lt;?php<br></span><span class="comment">// array_walk_recursive fails to change your array unless you pass by reference.<br>// Don&apos;t return values from your filter function, even though it&apos;s quite logical at a glance!<br></span><span class="keyword">function </span><span class="default">bad_example</span><span class="keyword">(</span><span class="default">$item</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){<br>&#xA0;&#xA0; if(</span><span class="default">$key</span><span class="keyword">==</span><span class="string">&apos;test&apos;</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0;&#xA0; return </span><span class="string">&apos;PHP Rocks&apos;</span><span class="keyword">;&#xA0; </span><span class="comment">// Don&apos;t do it<br>&#xA0;&#xA0; </span><span class="keyword">}else{<br>&#xA0; &#xA0; &#xA0; return </span><span class="default">$item</span><span class="keyword">;&#xA0; </span><span class="comment">// Don&apos;t do this either<br>&#xA0;&#xA0; </span><span class="keyword">}<br>}<br><br></span><span class="comment">// array_walk_recursive pass-by-reference example<br></span><span class="keyword">function </span><span class="default">good_example</span><span class="keyword">(&amp;</span><span class="default">$item</span><span class="keyword">,</span><span class="default">$key</span><span class="keyword">){<br>&#xA0;&#xA0; if(</span><span class="default">$key</span><span class="keyword">==</span><span class="string">&apos;test&apos;</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$item</span><span class="keyword">=</span><span class="string">&apos;PHP Rocks&apos;</span><span class="keyword">; </span><span class="comment">// Do This!<br>&#xA0;&#xA0; </span><span class="keyword">}<br>}<br><br></span><span class="default">$arr </span><span class="keyword">= array(</span><span class="string">&apos;a&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;1&apos;</span><span class="keyword">,</span><span class="string">&apos;b&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;2&apos;</span><span class="keyword">,</span><span class="string">&apos;test&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;Replace This&apos;</span><span class="keyword">);<br><br></span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">,</span><span class="string">&apos;bad_example&apos;</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br></span><span class="comment">/**<br> * no errors, but prints...<br> * array(&apos;a&apos;=&gt;&apos;1&apos;,&apos;b&apos;=&gt;&apos;2&apos;,&apos;test&apos;=&gt;&apos;Replace This&apos;);<br> */<br><br></span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">,</span><span class="string">&apos;good_example&apos;</span><span class="keyword">);<br></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$arr</span><span class="keyword">);<br></span><span class="comment">/**<br> * prints...<br> * array(&apos;a&apos;=&gt;&apos;1&apos;,&apos;b&apos;=&gt;&apos;2&apos;,&apos;test&apos;=&gt;&apos;PHP Rocks&apos;);<br> */<br><br></span><span class="default">?&gt;<br></span><br>Returning a value from your function does work if you pass by reference and modify $item before you return, but you will eat up memory very, very fast if you try it, even on an example as small as the one here.<br><br>One other silly thing you might try first is something like this:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Resist the urge to do this, it doesn&apos;t work.<br></span><span class="default">$filtered </span><span class="keyword">= </span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$unfiltered</span><span class="keyword">,</span><span class="string">&apos;filter_function&apos;</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Of course, $filtered is just TRUE afterwards, not the filtered results you were wanting. Oh, it ran your function recursively alright, but changed all the values in the local function scope only and returns a boolean as the documentation states.</span>
</div>
  

#


<div class="phpcode"><span class="html">
I use RecursiveIteratorIterator with parameter CATCH_GET_CHILD to iterate on leafs AND nodes instead of array_walk_recursive function :<br><br><span class="default">&lt;?php<br></span><span class="comment">// Iteration on leafs AND nodes<br></span><span class="keyword">foreach (new </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">(new </span><span class="default">RecursiveArrayIterator</span><span class="keyword">(</span><span class="default">$candidate</span><span class="keyword">), </span><span class="default">RecursiveIteratorIterator</span><span class="keyword">::</span><span class="default">CATCH_GET_CHILD</span><span class="keyword">) as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br>&#xA0; &#xA0; echo </span><span class="string">&apos;My node &apos; </span><span class="keyword">. </span><span class="default">$key </span><span class="keyword">. </span><span class="string">&apos; with value &apos; </span><span class="keyword">. </span><span class="default">$value </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.array-walk-recursive.php)

**[â¬† to root](/)**