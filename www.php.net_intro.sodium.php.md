# Introduction




<div class="phpcode"><span class="html">
<span class="default">&lt;?php <br></span><span class="comment">//Simple Usage<br><br>/**<br> * Encrypt a message<br> * <br> * @param string $message - message to encrypt<br> * @param string $key - encryption key<br> * @return string<br> */<br></span><span class="keyword">function </span><span class="default">safeEncrypt</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$nonce </span><span class="keyword">= </span><span class="default">random_bytes</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">SODIUM_CRYPTO_SECRETBOX_NONCEBYTES<br>&#xA0; &#xA0; </span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="default">$cipher </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$nonce</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">sodium_crypto_secretbox</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$message</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$nonce</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">)<br>&#xA0; &#xA0; );<br>&#xA0; &#xA0; </span><span class="default">sodium_memzero</span><span class="keyword">(</span><span class="default">$message</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">sodium_memzero</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&#xA0; &#xA0; return </span><span class="default">$cipher</span><span class="keyword">;<br>}<br><br></span><span class="comment">/**<br> * Decrypt a message<br> * <br> * @param string $encrypted - message encrypted with safeEncrypt()<br> * @param string $key - encryption key<br> * @return string<br> */<br></span><span class="keyword">function </span><span class="default">safeDecrypt</span><span class="keyword">(</span><span class="default">$encrypted</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">)<br>{&#xA0;&#xA0; <br>&#xA0; &#xA0; </span><span class="default">$decoded </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$encrypted</span><span class="keyword">);<br>&#xA0; &#xA0; if (</span><span class="default">$decoded </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&apos;Scream bloody murder, the encoding failed&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; if (</span><span class="default">mb_strlen</span><span class="keyword">(</span><span class="default">$decoded</span><span class="keyword">, </span><span class="string">&apos;8bit&apos;</span><span class="keyword">) &lt; (</span><span class="default">SODIUM_CRYPTO_SECRETBOX_NONCEBYTES </span><span class="keyword">+ </span><span class="default">SODIUM_CRYPTO_SECRETBOX_MACBYTES</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&apos;Scream bloody murder, the message was truncated&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">$nonce </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$decoded</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">SODIUM_CRYPTO_SECRETBOX_NONCEBYTES</span><span class="keyword">, </span><span class="string">&apos;8bit&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$ciphertext </span><span class="keyword">= </span><span class="default">mb_substr</span><span class="keyword">(</span><span class="default">$decoded</span><span class="keyword">, </span><span class="default">SODIUM_CRYPTO_SECRETBOX_NONCEBYTES</span><span class="keyword">, </span><span class="default">null</span><span class="keyword">, </span><span class="string">&apos;8bit&apos;</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="default">$plain </span><span class="keyword">= </span><span class="default">sodium_crypto_secretbox_open</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ciphertext</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$nonce</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$key<br>&#xA0; &#xA0; </span><span class="keyword">);<br>&#xA0; &#xA0; if (</span><span class="default">$plain </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&apos;the message was tampered with in transit&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">sodium_memzero</span><span class="keyword">(</span><span class="default">$ciphertext</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">sodium_memzero</span><span class="keyword">(</span><span class="default">$key</span><span class="keyword">);<br>&#xA0; &#xA0; return </span><span class="default">$plain</span><span class="keyword">;<br>}<br></span><span class="comment">//Encrypt &amp; Decrypt your message<br></span><span class="default">$key </span><span class="keyword">= </span><span class="default">sodium_crypto_secretbox_keygen</span><span class="keyword">();<br></span><span class="default">$enc </span><span class="keyword">= </span><span class="default">safeEncrypt</span><span class="keyword">(</span><span class="string">&apos;Abdul Rafay Hingoro&apos;</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">); </span><span class="comment">//generates random&#xA0; encrypted string (Base64 related)<br></span><span class="keyword">echo </span><span class="default">$enc</span><span class="keyword">;<br>echo </span><span class="string">&apos;&lt;br&gt;&apos;</span><span class="keyword">;<br></span><span class="default">$dec </span><span class="keyword">= </span><span class="default">safeDecrypt</span><span class="keyword">(</span><span class="default">$enc</span><span class="keyword">, </span><span class="default">$key</span><span class="keyword">); </span><span class="comment">//decrypts encoded string generated via safeEncrypt function <br></span><span class="keyword">echo </span><span class="default">$dec</span><span class="keyword">;<br></span><span class="default">?&gt;<br></span><br>//Output<br>DEx9ATXEg/eRq8GWD3NT5BatB3m31WEDEYLK2V4L0Am5GZGoa2rvYWUpoUeCrm7W/pdgLJrNoE6AA8U=<br>Abdul Rafay Hingoro</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/intro.sodium.php)

**[To root](/README.md)**