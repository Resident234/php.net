# mysqli_stmt::get_resultmysqli_stmt_get_result




<div class="phpcode"><span class="html">
I went through a lot of trouble on a server where mysqlnd wasn&apos;t available, and had a lot of headaches.<br><br>If you don&apos;t have mysqlnd installed/loaded whatever, you will get an undefined reference when trying to call &quot;mysqli_stmt_get_result()&quot;.<br><br>I wrote my own mysqli_stmt_get_result() and a mysqli_result_fetch_array() to go with it.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">iimysqli_result<br></span><span class="keyword">{<br>&#xA0; &#xA0; public </span><span class="default">$stmt</span><span class="keyword">, </span><span class="default">$nCols</span><span class="keyword">;<br>}&#xA0; &#xA0; <br><br>function </span><span class="default">iimysqli_stmt_get_result</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="comment">/**&#xA0; &#xA0; EXPLANATION:<br>&#xA0; &#xA0;&#xA0; * We are creating a fake &quot;result&quot; structure to enable us to have<br>&#xA0; &#xA0;&#xA0; * source-level equivalent syntax to a query executed via<br>&#xA0; &#xA0;&#xA0; * mysqli_query().<br>&#xA0; &#xA0;&#xA0; *<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; $stmt = mysqli_prepare($conn, &quot;&quot;);<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; mysqli_bind_param($stmt, &quot;types&quot;, ...);<br>&#xA0; &#xA0;&#xA0; *<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; $param1 = 0;<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; $param2 = &apos;foo&apos;;<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; $param3 = &apos;bar&apos;;<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; mysqli_execute($stmt);<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; $result _mysqli_stmt_get_result($stmt);<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; &#xA0; &#xA0; [ $arr = _mysqli_result_fetch_array($result);<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; || $assoc = _mysqli_result_fetch_assoc($result); ]<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; mysqli_stmt_close($stmt);<br>&#xA0; &#xA0;&#xA0; *&#xA0; &#xA0; mysqli_close($conn);<br>&#xA0; &#xA0;&#xA0; *<br>&#xA0; &#xA0;&#xA0; * At the source level, there is no difference between this and mysqlnd.<br>&#xA0; &#xA0;&#xA0; **/<br>&#xA0; &#xA0; </span><span class="default">$metadata </span><span class="keyword">= </span><span class="default">mysqli_stmt_result_metadata</span><span class="keyword">(</span><span class="default">$stmt</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$ret </span><span class="keyword">= new </span><span class="default">iimysqli_result</span><span class="keyword">;<br>&#xA0; &#xA0; if (!</span><span class="default">$ret</span><span class="keyword">) return </span><span class="default">NULL</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">-&gt;</span><span class="default">nCols </span><span class="keyword">= </span><span class="default">mysqli_num_fields</span><span class="keyword">(</span><span class="default">$metadata</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">-&gt;</span><span class="default">stmt </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">;<br><br>&#xA0; &#xA0; </span><span class="default">mysqli_free_result</span><span class="keyword">(</span><span class="default">$metadata</span><span class="keyword">);<br>&#xA0; &#xA0; return </span><span class="default">$ret</span><span class="keyword">;<br>}<br><br>function </span><span class="default">iimysqli_result_fetch_array</span><span class="keyword">(&amp;</span><span class="default">$result</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$ret </span><span class="keyword">= array();<br>&#xA0; &#xA0; </span><span class="default">$code </span><span class="keyword">= </span><span class="string">&quot;return mysqli_stmt_bind_result(\$result-&gt;stmt &quot;</span><span class="keyword">;<br><br>&#xA0; &#xA0; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">nCols</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ret</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">NULL</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$code </span><span class="keyword">.= </span><span class="string">&quot;, \$ret[&apos;&quot; </span><span class="keyword">.</span><span class="default">$i </span><span class="keyword">.</span><span class="string">&quot;&apos;]&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; };<br><br>&#xA0; &#xA0; </span><span class="default">$code </span><span class="keyword">.= </span><span class="string">&quot;);&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; if (!eval(</span><span class="default">$code</span><span class="keyword">)) { return </span><span class="default">NULL</span><span class="keyword">; };<br><br>&#xA0; &#xA0; </span><span class="comment">// This should advance the &quot;$stmt&quot; cursor.<br>&#xA0; &#xA0; </span><span class="keyword">if (!</span><span class="default">mysqli_stmt_fetch</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">stmt</span><span class="keyword">)) { return </span><span class="default">NULL</span><span class="keyword">; };<br><br>&#xA0; &#xA0; </span><span class="comment">// Return the array we built.<br>&#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">$ret</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;<br></span><br>Hope this helps someone.</span>
</div>
  

#


<div class="phpcode"><span class="html">
Please OH PLEASE.<br>I have been trying to get a result set from this function, and I had 0 luck completely, for nearly 3 hours!<br><br>If you ARE using mysqli_stmt_get_results() to get a result set, in conjuction with mysqli_stmt_store_results in order to retrieve the number of rows returned, you are going to have some major trouble!<br><br>PHP Documentation states that to retrieve the number of rows returned by a prepared select sql statement, one should call the following statements respectively:<br><br>mysqli_stmt_execute($stmt);<br>mysqli_stmt_store_result($stmt);<br>$num_rows = mysqli_stmt_num_rows($stmt);<br><br>THIS IS A MAJOR DEATH TRAP, IF YOU ARE USING mysqli_stmt_get_result() in conjunction!!!! Results of doing so vary depending which statements you call first, but in the end, you will NOT get the desired result.<br><br>In conclusion, please, PLEASE, NEVER use mysqli_stmt_store_result(), then mysqli_ AND mysqli_stmt_get_result() at the the same time. This is a MAJOR death trap.<br><br>SOLUTION:<br>If you are trying to get a result set, and you need the number of rows returned at the same time, use the following statements respectively instead:<br><br>$result_set = mysqli_stmt_get_results($stmt);<br>$num_rows = mysqli_num_rows($result_set);<br><br>Reflecting on my actions, this solution may seem fairly obvious. However, to someone new using PHP (like me) or someone who is not fully comfortable with prepared statements, it&apos;s very easy to get lost by using Google and learn on your own.<br><br>Summary:<br>NEVER use mysqli_stmt_store_result($stmt) &amp; mysqli_stmt_num_rows($stmt) in conjunction with mysqli_stmt_get_result($stmt). You will regret it!! I have been stuck on this for hours, and Google offered me no answer!</span>
</div>
  

#


<div class="phpcode"><span class="html">
Please note that this method requires the mysqlnd driver. Othervise you will get this error: Call to undefined method mysqli_stmt::get_result()</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/mysqli-stmt.get-result.php)

**[To root](/README.md)**