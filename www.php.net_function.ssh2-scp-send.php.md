# ssh2_scp_send




<div class="phpcode"><span class="html">
In addition to my previous post, I figured out that sftp-&gt;fopen-&gt;file_get_contents-&gt;fwrite has much better performance than ssh2_scp_send.<br><br>I&apos;ve used the following code to test:<br><br><span class="default">&lt;?php<br>$srcFile </span><span class="keyword">= </span><span class="string">&apos;/var/tmp/dir1/file_to_send.txt&apos;</span><span class="keyword">;<br></span><span class="default">$dstFile </span><span class="keyword">= </span><span class="string">&apos;/var/tmp/dir2/file_received.txt&apos;</span><span class="keyword">;<br><br></span><span class="comment">// Create connection the the remote host<br></span><span class="default">$conn </span><span class="keyword">= </span><span class="default">ssh2_connect</span><span class="keyword">(</span><span class="string">&apos;my.server.com&apos;</span><span class="keyword">, </span><span class="default">22</span><span class="keyword">);<br><br></span><span class="comment">// Create SFTP session<br></span><span class="default">$sftp </span><span class="keyword">= </span><span class="default">ssh2_sftp</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br><br></span><span class="default">$sftpStream </span><span class="keyword">= @</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">&apos;ssh2.s<a href="ftp://" rel="nofollow" target="_blank">ftp://</a>&apos;</span><span class="keyword">.</span><span class="default">$sftp</span><span class="keyword">.</span><span class="default">$dstFile</span><span class="keyword">, </span><span class="string">&apos;w&apos;</span><span class="keyword">);<br><br>try {<br><br>&#xA0; &#xA0; if (!</span><span class="default">$sftpStream</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&quot;Could not open remote file: </span><span class="default">$dstFile</span><span class="string">&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">$data_to_send </span><span class="keyword">= @</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$srcFile</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; if (</span><span class="default">$data_to_send </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&quot;Could not open local file: </span><span class="default">$srcFile</span><span class="string">.&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; if (@</span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$sftpStream</span><span class="keyword">, </span><span class="default">$data_to_send</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; throw new </span><span class="default">Exception</span><span class="keyword">(</span><span class="string">&quot;Could not send data from file: </span><span class="default">$srcFile</span><span class="string">.&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sftpStream</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>} catch (</span><span class="default">Exception $e</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="default">error_log</span><span class="keyword">(</span><span class="string">&apos;Exception: &apos; </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">());<br>&#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$sftpStream</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;<br></span><br>For the test I&apos;ve sent three files with total size of 6kB, and the times to send including connect to the server were:<br><br>SFTP -&gt; 15 sec.<br>ssh2_scp_send -&gt; 22 sec.<br><br>Cheers,<br><br>Pimmy</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.ssh2-scp-send.php)

**[â¬† to root](/)**