# session_start




<div class="phpcode"><span class="html">
If you want to handle sessions with a class, I wrote this little class:<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/*<br>&#xA0; &#xA0; Use the static method getInstance to get the object.<br>*/<br><br></span><span class="keyword">class </span><span class="default">Session<br></span><span class="keyword">{<br>&#xA0; &#xA0; const </span><span class="default">SESSION_STARTED </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br>&#xA0; &#xA0; const </span><span class="default">SESSION_NOT_STARTED </span><span class="keyword">= </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">// The state of the session<br>&#xA0; &#xA0; </span><span class="keyword">private </span><span class="default">$sessionState </span><span class="keyword">= </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_NOT_STARTED</span><span class="keyword">;<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">// THE only instance of the class<br>&#xA0; &#xA0; </span><span class="keyword">private static </span><span class="default">$instance</span><span class="keyword">;<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; private function </span><span class="default">__construct</span><span class="keyword">() {}<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *&#xA0; &#xA0; Returns THE instance of &apos;Session&apos;.<br>&#xA0; &#xA0; *&#xA0; &#xA0; The session is automatically initialized if it wasn&apos;t.<br>&#xA0; &#xA0; *&#xA0; &#xA0; <br>&#xA0; &#xA0; *&#xA0; &#xA0; @return&#xA0; &#xA0; object<br>&#xA0; &#xA0; **/<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="keyword">public static function </span><span class="default">getInstance</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( !isset(</span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance </span><span class="keyword">= new </span><span class="default">self</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">-&gt;</span><span class="default">startSession</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">self</span><span class="keyword">::</span><span class="default">$instance</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *&#xA0; &#xA0; (Re)starts the session.<br>&#xA0; &#xA0; *&#xA0; &#xA0; <br>&#xA0; &#xA0; *&#xA0; &#xA0; @return&#xA0; &#xA0; bool&#xA0; &#xA0; TRUE if the session has been initialized, else FALSE.<br>&#xA0; &#xA0; **/<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="keyword">public function </span><span class="default">startSession</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">== </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_NOT_STARTED </span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">= </span><span class="default">session_start</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *&#xA0; &#xA0; Stores datas in the session.<br>&#xA0; &#xA0; *&#xA0; &#xA0; Example: $instance-&gt;foo = &apos;bar&apos;;<br>&#xA0; &#xA0; *&#xA0; &#xA0; <br>&#xA0; &#xA0; *&#xA0; &#xA0; @param&#xA0; &#xA0; name&#xA0; &#xA0; Name of the datas.<br>&#xA0; &#xA0; *&#xA0; &#xA0; @param&#xA0; &#xA0; value&#xA0; &#xA0; Your datas.<br>&#xA0; &#xA0; *&#xA0; &#xA0; @return&#xA0; &#xA0; void<br>&#xA0; &#xA0; **/<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="keyword">public function </span><span class="default">__set</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">, </span><span class="default">$value </span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$value</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *&#xA0; &#xA0; Gets datas from the session.<br>&#xA0; &#xA0; *&#xA0; &#xA0; Example: echo $instance-&gt;foo;<br>&#xA0; &#xA0; *&#xA0; &#xA0; <br>&#xA0; &#xA0; *&#xA0; &#xA0; @param&#xA0; &#xA0; name&#xA0; &#xA0; Name of the datas to get.<br>&#xA0; &#xA0; *&#xA0; &#xA0; @return&#xA0; &#xA0; mixed&#xA0; &#xA0; Datas stored in session.<br>&#xA0; &#xA0; **/<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="keyword">public function </span><span class="default">__get</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]))<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; public function </span><span class="default">__isset</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; return isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; public function </span><span class="default">__unset</span><span class="keyword">( </span><span class="default">$name </span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; unset( </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] );<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="comment">/**<br>&#xA0; &#xA0; *&#xA0; &#xA0; Destroys the current session.<br>&#xA0; &#xA0; *&#xA0; &#xA0; <br>&#xA0; &#xA0; *&#xA0; &#xA0; @return&#xA0; &#xA0; bool&#xA0; &#xA0; TRUE is session has been deleted, else FALSE.<br>&#xA0; &#xA0; **/<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="keyword">public function </span><span class="default">destroy</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if ( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">== </span><span class="default">self</span><span class="keyword">::</span><span class="default">SESSION_STARTED </span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState </span><span class="keyword">= !</span><span class="default">session_destroy</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; unset( </span><span class="default">$_SESSION </span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">sessionState</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>}<br><br></span><span class="comment">/*<br>&#xA0; &#xA0; Examples:<br>*/<br><br>// We get the instance<br></span><span class="default">$data </span><span class="keyword">= </span><span class="default">Session</span><span class="keyword">::</span><span class="default">getInstance</span><span class="keyword">();<br><br></span><span class="comment">// Let&apos;s store datas in the session<br></span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">= </span><span class="string">&apos;Someone&apos;</span><span class="keyword">;<br></span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">= </span><span class="default">18</span><span class="keyword">;<br><br></span><span class="comment">// Let&apos;s display datas<br></span><span class="default">printf</span><span class="keyword">( </span><span class="string">&apos;&lt;p&gt;My name is %s and I\&apos;m %d years old.&lt;/p&gt;&apos; </span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">age </span><span class="keyword">);<br><br></span><span class="comment">/*<br>&#xA0; &#xA0; It will display:<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; Array<br>&#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; [nickname] =&gt; Someone<br>&#xA0; &#xA0; &#xA0; &#xA0; [age] =&gt; 18<br>&#xA0; &#xA0; )<br>*/<br><br></span><span class="default">printf</span><span class="keyword">( </span><span class="string">&apos;&lt;pre&gt;%s&lt;/pre&gt;&apos; </span><span class="keyword">, </span><span class="default">print_r</span><span class="keyword">( </span><span class="default">$_SESSION </span><span class="keyword">, </span><span class="default">TRUE </span><span class="keyword">));<br><br></span><span class="comment">// TRUE<br></span><span class="default">var_dump</span><span class="keyword">( isset( </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">));<br><br></span><span class="comment">// We destroy the session<br></span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">destroy</span><span class="keyword">();<br><br></span><span class="comment">// FALSE<br></span><span class="default">var_dump</span><span class="keyword">( isset( </span><span class="default">$data</span><span class="keyword">-&gt;</span><span class="default">nickname </span><span class="keyword">));<br><br></span><span class="default">?&gt;<br></span><br>I prefer using this class instead of using directly the array $_SESSION.</span>
</div>
  

#


<div class="phpcode"><span class="html">
As others have noted, PHP&apos;s session handler is blocking. When one of your scripts calls session_start(), any other script that also calls session_start() with the same session ID will sleep until the first script closes the session.<br><br>A common workaround to this is call session_start() and session_write_close() each time you want to update the session.<br><br>The problem with this, is that each time you call session_start(), PHP prints a duplicate copy of the session cookie to the HTTP response header. Do this enough times (as you might do in a long-running script), and the response header can get so large that it causes web servers &amp; browsers to crash or reject your response as malformed.<br><br>This error has been reported to PHP HQ, but they&apos;ve marked it &quot;Won&apos;t fix&quot; because they say you&apos;re not supposed to open and close the session during a single script like this. <a href="https://bugs.php.net/bug.php?id=31455" rel="nofollow" target="_blank">https://bugs.php.net/bug.php?id=31455</a><br><br>As a workaround, I&apos;ve written a function that uses headers_list() and header_remove() to clear out the duplicate cookies. It&apos;s interesting to note that even on requests when PHP sends duplicate session cookies, headers_list() still only lists one copy of the session cookie. Nonetheless, calling header_remove() removes all the duplicate copies.<br><br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Every time you call session_start(), PHP adds another<br> * identical session cookie to the response header. Do this<br> * enough times, and your response header becomes big enough<br> * to choke the web server.<br> *<br> * This method clears out the duplicate session cookies. You can<br> * call it after each time you&apos;ve called session_start(), or call it<br> * just before you send your headers.<br> */<br></span><span class="keyword">function </span><span class="default">clear_duplicate_cookies</span><span class="keyword">() {<br>&#xA0; &#xA0; </span><span class="comment">// If headers have already been sent, there&apos;s nothing we can do<br>&#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">headers_sent</span><span class="keyword">()) {<br>&#xA0; &#xA0; &#xA0; &#xA0; return;<br>&#xA0; &#xA0; }<br><br>&#xA0; &#xA0; </span><span class="default">$cookies </span><span class="keyword">= array();<br>&#xA0; &#xA0; foreach (</span><span class="default">headers_list</span><span class="keyword">() as </span><span class="default">$header</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Identify cookie headers<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">, </span><span class="string">&apos;Set-Cookie:&apos;</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$cookies</span><span class="keyword">[] = </span><span class="default">$header</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="comment">// Removes all cookie headers, including duplicates<br>&#xA0; &#xA0; </span><span class="default">header_remove</span><span class="keyword">(</span><span class="string">&apos;Set-Cookie&apos;</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="comment">// Restore one copy of each cookie<br>&#xA0; &#xA0; </span><span class="keyword">foreach(</span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$cookies</span><span class="keyword">) as </span><span class="default">$cookie</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="default">$cookie</span><span class="keyword">, </span><span class="default">false</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
The constant SID would always be &apos;&apos; (an empty string) if directive session.use_trans_sid in php ini file is set to 0. <br><br>So remember to set session.use_trans_sid to 1 and restart your server before you use SID in your php script.</span>
</div>
  

#


<div class="phpcode"><span class="html">
PHP locks the session file until it is closed. If you have 2 scripts using the same session (i.e. from the same user) then the 2nd script will not finish its call to session_start() until the first script finishes execution.<br><br>If you have scripts that run for more than a second and users may be making more than 1 request at a time then it is worth calling session_write_close() as soon as you&apos;ve finished writing session data.<br><br><span class="default">&lt;?php<br></span><span class="comment">// a lock is places on the session, so other scripts will have to wait<br></span><span class="default">session_start</span><span class="keyword">();<br><br></span><span class="comment">// do all your writing to $_SESSION<br></span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">&apos;a&apos;</span><span class="keyword">] = </span><span class="default">1</span><span class="keyword">;<br><br></span><span class="comment">// $_SESSION can still be read, but writing will not update the session.<br>// the lock is removed and other scripts can now read the session<br></span><span class="default">session_write_close</span><span class="keyword">();<br><br></span><span class="default">do_something_slow</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>Found this out from <a href="http://konrness.com/php5/how-to-prevent-blocking-php-requests/" rel="nofollow" target="_blank">http://konrness.com/php5/how-to-prevent-blocking-php-requests/</a></span>
</div>
  

#


<div class="phpcode"><span class="html">
If you are using a custom session handler via session_set_save_handler() then calling session_start() in PHP 7.1 you might see an error like this:<br>session_start(): Failed to read session data: user (path: /var/lib/php/session) in ...<br><br>As of this writing, it seems to be happening in PHP 7.1, and things look OK in PHP7.0. <br><br>It is also hard to track down because if a session already exists for this id (maybe created by an earlier version of PHP), it will not trigger this issue because the $session_data will not be null.<br><br>The fix is simple... you just need to check for &apos;null&apos; during your read function:<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">)<br>{<br>&#xA0; </span><span class="comment">//... pull the data out of the DB, off the disk, memcache, etc<br>&#xA0; </span><span class="default">$session_data </span><span class="keyword">= </span><span class="default">getSessionDataFromSomewhere</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">);<br>&#xA0; <br>&#xA0; </span><span class="comment">//check to see if $session_data is null before returning (CRITICAL)<br>&#xA0; </span><span class="keyword">if(</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$session_data</span><span class="keyword">))<br>&#xA0; {<br>&#xA0; &#xA0; </span><span class="default">$session_data </span><span class="keyword">= </span><span class="string">&apos;&apos;</span><span class="keyword">;&#xA0; </span><span class="comment">//use empty string instead of null!<br>&#xA0; </span><span class="keyword">}<br><br>&#xA0; return </span><span class="default">$session_data</span><span class="keyword">;<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
When you have an import script that takes long to execute, the browser seem to lock up and you cannot access the website anymore. this is because a request is reading and locking the session file to prevent corruption.
<br>
<br>you can either 
<br>- use a different session handler with session_set_save_handler()
<br>- use session_write_close() in the import script as soon you don&apos;t need session anymore (best moment is just before the long during part takes place), you can session_start when ever you want and as many times you like if your import script requires session variables changed. 
<br>
<br>example
<br><span class="default">&lt;?php
<br>session_start</span><span class="keyword">(); </span><span class="comment">//initiate / open session
<br></span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">&apos;count&apos;</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">; </span><span class="comment">// store something in the session
<br></span><span class="default">session_write_close</span><span class="keyword">(); </span><span class="comment">//now close it, 
<br># from here every other script can be run (and makes it seem like multitasking)
<br></span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">100</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++){ </span><span class="comment">//do 100 cycles
<br>&#xA0; &#xA0; </span><span class="default">session_start</span><span class="keyword">(); </span><span class="comment">//open the session again for editing a variable
<br>&#xA0; &#xA0; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">&apos;count&apos;</span><span class="keyword">] += </span><span class="default">1</span><span class="keyword">; </span><span class="comment">//change variable
<br>&#xA0; &#xA0; </span><span class="default">session_write_close</span><span class="keyword">(); </span><span class="comment">//now close the session again!
<br>&#xA0; &#xA0; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">); </span><span class="comment">//every cycle sleep two seconds, or do a heavy task
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.session-start.php)

**[⬆ to root](/)**