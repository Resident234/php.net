# mb_detect_encoding




<div class="phpcode"><span class="html">
If you try to use mb_detect_encoding to detect whether a string is valid UTF-8, use the strict mode, it is pretty worthless otherwise.<br><br><span class="default">&lt;?php<br>&#xA0; &#xA0; $str </span><span class="keyword">= </span><span class="string">&apos;&#xE1;&#xE9;&#xF3;&#xFA;&apos;</span><span class="keyword">; </span><span class="comment">// ISO-8859-1<br>&#xA0; &#xA0; </span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">&apos;UTF-8&apos;</span><span class="keyword">); </span><span class="comment">// &apos;UTF-8&apos;<br>&#xA0; &#xA0; </span><span class="default">mb_detect_encoding</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">, </span><span class="string">&apos;UTF-8&apos;</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">); </span><span class="comment">// false<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you need to distinguish between UTF-8 and ISO-8859-1 encoding, list UTF-8 first in your encoding_list:<br>mb_detect_encoding($string, &apos;UTF-8, ISO-8859-1&apos;);<br><br>if you list ISO-8859-1 first, mb_detect_encoding() will always return ISO-8859-1.</span>
</div>
  

#


<div class="phpcode"><span class="html">
Based upon that snippet below using preg_match() I needed something faster and less specific.&#xA0; That function works and is brilliant but it scans the entire strings and checks that it conforms to UTF-8.&#xA0; I wanted something purely to check if a string contains UTF-8 characters so that I could switch character encoding from iso-8859-1 to utf-8.<br><br>I modified the pattern to only look for non-ascii multibyte sequences in the UTF-8 range and also to stop once it finds at least one multibytes string.&#xA0; This is quite a lot faster.<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">function </span><span class="default">detectUTF8</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;%(?:<br>&#xA0; &#xA0; &#xA0; &#xA0; [\xC2-\xDF][\x80-\xBF]&#xA0; &#xA0; &#xA0; &#xA0; # non-overlong 2-byte<br>&#xA0; &#xA0; &#xA0; &#xA0; |\xE0[\xA0-\xBF][\x80-\xBF]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; # excluding overlongs<br>&#xA0; &#xA0; &#xA0; &#xA0; |[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}&#xA0; &#xA0; &#xA0; # straight 3-byte<br>&#xA0; &#xA0; &#xA0; &#xA0; |\xED[\x80-\x9F][\x80-\xBF]&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; # excluding surrogates<br>&#xA0; &#xA0; &#xA0; &#xA0; |\xF0[\x90-\xBF][\x80-\xBF]{2}&#xA0; &#xA0; # planes 1-3<br>&#xA0; &#xA0; &#xA0; &#xA0; |[\xF1-\xF3][\x80-\xBF]{3}&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; # planes 4-15<br>&#xA0; &#xA0; &#xA0; &#xA0; |\xF4[\x80-\x8F][\x80-\xBF]{2}&#xA0; &#xA0; # plane 16<br>&#xA0; &#xA0; &#xA0; &#xA0; )+%xs&apos;</span><span class="keyword">, </span><span class="default">$string</span><span class="keyword">);<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
A simple way to detect UTF-8/16/32 of file by its BOM (not work with string or file without BOM)<br><br><span class="default">&lt;?php<br></span><span class="comment">// Unicode BOM is U+FEFF, but after encoded, it will look like this.<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&apos;UTF32_BIG_ENDIAN_BOM&apos;&#xA0;&#xA0; </span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0x00</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0x00</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFE</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFF</span><span class="keyword">));<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&apos;UTF32_LITTLE_ENDIAN_BOM&apos;</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFF</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFE</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0x00</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0x00</span><span class="keyword">));<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&apos;UTF16_BIG_ENDIAN_BOM&apos;&#xA0;&#xA0; </span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFE</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFF</span><span class="keyword">));<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&apos;UTF16_LITTLE_ENDIAN_BOM&apos;</span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFF</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xFE</span><span class="keyword">));<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&apos;UTF8_BOM&apos;&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">, </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xEF</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xBB</span><span class="keyword">) . </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0xBF</span><span class="keyword">));<br><br>function </span><span class="default">detect_utf_encoding</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) {<br><br>&#xA0; &#xA0; </span><span class="default">$text </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$first2 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$first3 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$first4 </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; if (</span><span class="default">$first3 </span><span class="keyword">== </span><span class="default">UTF8_BOM</span><span class="keyword">) return </span><span class="string">&apos;UTF-8&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; elseif (</span><span class="default">$first4 </span><span class="keyword">== </span><span class="default">UTF32_BIG_ENDIAN_BOM</span><span class="keyword">) return </span><span class="string">&apos;UTF-32BE&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; elseif (</span><span class="default">$first4 </span><span class="keyword">== </span><span class="default">UTF32_LITTLE_ENDIAN_BOM</span><span class="keyword">) return </span><span class="string">&apos;UTF-32LE&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; elseif (</span><span class="default">$first2 </span><span class="keyword">== </span><span class="default">UTF16_BIG_ENDIAN_BOM</span><span class="keyword">) return </span><span class="string">&apos;UTF-16BE&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; elseif (</span><span class="default">$first2 </span><span class="keyword">== </span><span class="default">UTF16_LITTLE_ENDIAN_BOM</span><span class="keyword">) return </span><span class="string">&apos;UTF-16LE&apos;</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.mb-detect-encoding.php)

**[To root](/README.md)**