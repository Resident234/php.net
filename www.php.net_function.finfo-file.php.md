# finfo_file




<div class="phpcode"><span class="html">
The way HOWTO get MIME-type of remote file.<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">MimeStreamWrapper<br></span><span class="keyword">{<br>&#xA0; &#xA0; const </span><span class="default">WRAPPER_NAME </span><span class="keyword">= </span><span class="string">&apos;mime&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; public </span><span class="default">$context</span><span class="keyword">;<br>&#xA0; &#xA0; private static </span><span class="default">$isRegistered </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; private </span><span class="default">$callBackFunction</span><span class="keyword">;<br>&#xA0; &#xA0; private </span><span class="default">$eof </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; private </span><span class="default">$fp</span><span class="keyword">;<br>&#xA0; &#xA0; private </span><span class="default">$path</span><span class="keyword">;<br>&#xA0; &#xA0; private </span><span class="default">$fileStat</span><span class="keyword">;<br>&#xA0; &#xA0; private function </span><span class="default">getStat</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$fStat </span><span class="keyword">= </span><span class="default">fstat</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fp</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$fStat</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">100</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$headers </span><span class="keyword">= </span><span class="default">get_headers</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$head </span><span class="keyword">= </span><span class="default">array_change_key_case</span><span class="keyword">(</span><span class="default">$headers</span><span class="keyword">, </span><span class="default">CASE_LOWER</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$size </span><span class="keyword">= (int)</span><span class="default">$head</span><span class="keyword">[</span><span class="string">&apos;content-length&apos;</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$blocks </span><span class="keyword">= </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$size </span><span class="keyword">/ </span><span class="default">512</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; return array(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;dev&apos; </span><span class="keyword">=&gt; </span><span class="default">16777220</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;ino&apos; </span><span class="keyword">=&gt; </span><span class="default">15764</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;mode&apos; </span><span class="keyword">=&gt; </span><span class="default">33188</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;nlink&apos; </span><span class="keyword">=&gt; </span><span class="default">1</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;uid&apos; </span><span class="keyword">=&gt; </span><span class="default">10000</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;gid&apos; </span><span class="keyword">=&gt; </span><span class="default">80</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;rdev&apos; </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;size&apos; </span><span class="keyword">=&gt; </span><span class="default">$size</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;atime&apos; </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;mtime&apos; </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;ctime&apos; </span><span class="keyword">=&gt; </span><span class="default">0</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;blksize&apos; </span><span class="keyword">=&gt; </span><span class="default">4096</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;blocks&apos; </span><span class="keyword">=&gt; </span><span class="default">$blocks</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; );<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">setPath</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">, </span><span class="string">&apos;rb&apos;</span><span class="keyword">) or die(</span><span class="string">&apos;Cannot open file:&#xA0; &apos; </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fileStat </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">getStat</span><span class="keyword">();<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">read</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fp</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">getStreamPath</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">&apos;<a href="ftp://" rel="nofollow" target="_blank">ftp://</a>&apos;</span><span class="keyword">, </span><span class="string">&apos;<a href="http://" rel="nofollow" target="_blank">http://</a>&apos;</span><span class="keyword">, </span><span class="string">&apos;<a href="https://" rel="nofollow" target="_blank">https://</a>&apos;</span><span class="keyword">), </span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME </span><span class="keyword">. </span><span class="string">&apos;://&apos;</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">path</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">getContext</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$isRegistered</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">stream_wrapper_register</span><span class="keyword">(</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">, </span><span class="default">get_class</span><span class="keyword">());<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$isRegistered </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">stream_context_create</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; array(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME </span><span class="keyword">=&gt; array(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;cb&apos; </span><span class="keyword">=&gt; array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">&apos;read&apos;</span><span class="keyword">),<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&apos;fileStat&apos; </span><span class="keyword">=&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fileStat</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; )<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; )<br>&#xA0; &#xA0; &#xA0; &#xA0; );<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">stream_open</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">, &amp;</span><span class="default">$opened_path</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">&apos;/^r[bt]?$/&apos;</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">) || !</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">context</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$opt </span><span class="keyword">= </span><span class="default">stream_context_get_options</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">context</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$opt</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">]) ||<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; !isset(</span><span class="default">$opt</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">][</span><span class="string">&apos;cb&apos;</span><span class="keyword">]) ||<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; !</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$opt</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">][</span><span class="string">&apos;cb&apos;</span><span class="keyword">])<br>&#xA0; &#xA0; &#xA0; &#xA0; ) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callBackFunction </span><span class="keyword">= </span><span class="default">$opt</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">][</span><span class="string">&apos;cb&apos;</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fileStat </span><span class="keyword">= </span><span class="default">$opt</span><span class="keyword">[</span><span class="default">self</span><span class="keyword">::</span><span class="default">WRAPPER_NAME</span><span class="keyword">][</span><span class="string">&apos;fileStat&apos;</span><span class="keyword">];<br><br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">stream_read</span><span class="keyword">(</span><span class="default">$count</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">eof </span><span class="keyword">|| !</span><span class="default">$count</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; if ((</span><span class="default">$s </span><span class="keyword">= </span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callBackFunction</span><span class="keyword">, </span><span class="default">$count</span><span class="keyword">)) == </span><span class="string">&apos;&apos;</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">eof </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$s</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">stream_eof</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">eof</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">stream_stat</span><span class="keyword">()<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">fileStat</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; public function </span><span class="default">stream_cast</span><span class="keyword">(</span><span class="default">$castAs</span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$read </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$write&#xA0; </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$except </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; return @</span><span class="default">stream_select</span><span class="keyword">(</span><span class="default">$read</span><span class="keyword">, </span><span class="default">$write</span><span class="keyword">, </span><span class="default">$except</span><span class="keyword">, </span><span class="default">$castAs</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>}<br></span><span class="default">$path </span><span class="keyword">= </span><span class="string">&apos;<a href="http://fc04.deviantart.net/fs71/f/2010/227/4/6/PNG_Test_by_Destron23.png" rel="nofollow" target="_blank">http://fc04.deviantart.net/fs71/f/2010/227/4/6/PNG_Test_by_Destron23.png</a>&apos;</span><span class="keyword">;<br>echo </span><span class="string">&quot;File: &quot;</span><span class="keyword">, </span><span class="default">$path</span><span class="keyword">, </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br></span><span class="default">$wrapper </span><span class="keyword">= new </span><span class="default">MimeStreamWrapper</span><span class="keyword">();<br></span><span class="default">$wrapper</span><span class="keyword">-&gt;</span><span class="default">setPath</span><span class="keyword">(</span><span class="default">$path</span><span class="keyword">);<br><br></span><span class="default">$fInfo </span><span class="keyword">= new </span><span class="default">finfo</span><span class="keyword">(</span><span class="default">FILEINFO_MIME</span><span class="keyword">);<br>echo </span><span class="string">&quot;MIME-type: &quot;</span><span class="keyword">, </span><span class="default">$fInfo</span><span class="keyword">-&gt;</span><span class="default">file</span><span class="keyword">(</span><span class="default">$wrapper</span><span class="keyword">-&gt;</span><span class="default">getStreamPath</span><span class="keyword">(), </span><span class="default">FILEINFO_MIME_TYPE</span><span class="keyword">, </span><span class="default">$wrapper</span><span class="keyword">-&gt;</span><span class="default">getContext</span><span class="keyword">()), </span><span class="string">&quot;\n&quot;</span><span class="keyword">;<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Tempting as it may seem to use finfo_file() to validate uploaded image files (Check whether a supposed imagefile really contains an image), the results cannot be trusted. It&apos;s not that hard to wrap harmful executable code in a file identified as a GIF for instance.<br><br>A better &amp; safer option is to check the result of:<br><br>if (!$img = @imagecreatefromgif($uploadedfilename)) {<br>&#xA0; trigger_error(&apos;Not a GIF image!&apos;,E_USER_WARNING);<br>&#xA0; // do necessary stuff<br>}</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.finfo-file.php)

**[To root](/README.md)**