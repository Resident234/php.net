# imagecreate




<div class="phpcode"><span class="html">
to create an image from a BMP file, I made this function, that return a resource like the others ImageCreateFrom function:<br><br><span class="default">&lt;?php<br></span><span class="comment">/*********************************************/<br>/* Fonction: ImageCreateFromBMP&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; */<br>/* Author:&#xA0;&#xA0; DHKold&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; */<br>/* Contact:&#xA0; admin@dhkold.com&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; */<br>/* Date:&#xA0; &#xA0;&#xA0; The 15th of June 2005&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; */<br>/* Version:&#xA0; 2.0B&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; */<br>/*********************************************/<br><br></span><span class="keyword">function </span><span class="default">ImageCreateFromBMP</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)<br>{<br> </span><span class="comment">//Ouverture du fichier en mode binaire<br>&#xA0;&#xA0; </span><span class="keyword">if (! </span><span class="default">$f1 </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="string">&quot;rb&quot;</span><span class="keyword">)) return </span><span class="default">FALSE</span><span class="keyword">;<br><br> </span><span class="comment">//1 : Chargement des ent&#xFFFD;tes FICHIER<br>&#xA0;&#xA0; </span><span class="default">$FILE </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;vfile_type/Vfile_size/Vreserved/Vbitmap_offset&quot;</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f1</span><span class="keyword">,</span><span class="default">14</span><span class="keyword">));<br>&#xA0;&#xA0; if (</span><span class="default">$FILE</span><span class="keyword">[</span><span class="string">&apos;file_type&apos;</span><span class="keyword">] != </span><span class="default">19778</span><span class="keyword">) return </span><span class="default">FALSE</span><span class="keyword">;<br><br> </span><span class="comment">//2 : Chargement des ent&#xFFFD;tes BMP<br>&#xA0;&#xA0; </span><span class="default">$BMP </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&apos;Vheader_size/Vwidth/Vheight/vplanes/vbits_per_pixel&apos;</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="string">&apos;/Vcompression/Vsize_bitmap/Vhoriz_resolution&apos;</span><span class="keyword">.<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="string">&apos;/Vvert_resolution/Vcolors_used/Vcolors_important&apos;</span><span class="keyword">, </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f1</span><span class="keyword">,</span><span class="default">40</span><span class="keyword">));<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;colors&apos;</span><span class="keyword">] = </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">,</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">]);<br>&#xA0;&#xA0; if (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;size_bitmap&apos;</span><span class="keyword">] == </span><span class="default">0</span><span class="keyword">) </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;size_bitmap&apos;</span><span class="keyword">] = </span><span class="default">$FILE</span><span class="keyword">[</span><span class="string">&apos;file_size&apos;</span><span class="keyword">] - </span><span class="default">$FILE</span><span class="keyword">[</span><span class="string">&apos;bitmap_offset&apos;</span><span class="keyword">];<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel&apos;</span><span class="keyword">] = </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">]/</span><span class="default">8</span><span class="keyword">;<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel2&apos;</span><span class="keyword">] = </span><span class="default">ceil</span><span class="keyword">(</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel&apos;</span><span class="keyword">]);<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">] = (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;width&apos;</span><span class="keyword">]*</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel&apos;</span><span class="keyword">]/</span><span class="default">4</span><span class="keyword">);<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">] -= </span><span class="default">floor</span><span class="keyword">(</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;width&apos;</span><span class="keyword">]*</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel&apos;</span><span class="keyword">]/</span><span class="default">4</span><span class="keyword">);<br>&#xA0;&#xA0; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">] = </span><span class="default">4</span><span class="keyword">-(</span><span class="default">4</span><span class="keyword">*</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">]);<br>&#xA0;&#xA0; if (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">] == </span><span class="default">4</span><span class="keyword">) </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">] = </span><span class="default">0</span><span class="keyword">;<br><br> </span><span class="comment">//3 : Chargement des couleurs de la palette<br>&#xA0;&#xA0; </span><span class="default">$PALETTE </span><span class="keyword">= array();<br>&#xA0;&#xA0; if (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;colors&apos;</span><span class="keyword">] &lt; </span><span class="default">16777216</span><span class="keyword">)<br>&#xA0;&#xA0; {<br>&#xA0; &#xA0; </span><span class="default">$PALETTE </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&apos;V&apos;</span><span class="keyword">.</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;colors&apos;</span><span class="keyword">], </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f1</span><span class="keyword">,</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;colors&apos;</span><span class="keyword">]*</span><span class="default">4</span><span class="keyword">));<br>&#xA0;&#xA0; }<br><br> </span><span class="comment">//4 : Cr&#xFFFD;ation de l&apos;image<br>&#xA0;&#xA0; </span><span class="default">$IMG </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$f1</span><span class="keyword">,</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;size_bitmap&apos;</span><span class="keyword">]);<br>&#xA0;&#xA0; </span><span class="default">$VIDE </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br><br>&#xA0;&#xA0; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;width&apos;</span><span class="keyword">],</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;height&apos;</span><span class="keyword">]);<br>&#xA0;&#xA0; </span><span class="default">$P </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&#xA0;&#xA0; </span><span class="default">$Y </span><span class="keyword">= </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;height&apos;</span><span class="keyword">]-</span><span class="default">1</span><span class="keyword">;<br>&#xA0;&#xA0; while (</span><span class="default">$Y </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">)<br>&#xA0;&#xA0; {<br>&#xA0; &#xA0; </span><span class="default">$X</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br>&#xA0; &#xA0; while (</span><span class="default">$X </span><span class="keyword">&lt; </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;width&apos;</span><span class="keyword">])<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0;&#xA0; if (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">] == </span><span class="default">24</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;V&quot;</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$IMG</span><span class="keyword">,</span><span class="default">$P</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">).</span><span class="default">$VIDE</span><span class="keyword">);<br>&#xA0; &#xA0;&#xA0; elseif (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">] == </span><span class="default">16</span><span class="keyword">)<br>&#xA0; &#xA0;&#xA0; {&#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;n&quot;</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$IMG</span><span class="keyword">,</span><span class="default">$P</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$PALETTE</span><span class="keyword">[</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0;&#xA0; elseif (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">] == </span><span class="default">8</span><span class="keyword">)<br>&#xA0; &#xA0;&#xA0; {&#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;n&quot;</span><span class="keyword">,</span><span class="default">$VIDE</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$IMG</span><span class="keyword">,</span><span class="default">$P</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$PALETTE</span><span class="keyword">[</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0;&#xA0; elseif (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">] == </span><span class="default">4</span><span class="keyword">)<br>&#xA0; &#xA0;&#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;n&quot;</span><span class="keyword">,</span><span class="default">$VIDE</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$IMG</span><span class="keyword">,</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$P</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; if ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">2</span><span class="keyword">)%</span><span class="default">2 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &gt;&gt; </span><span class="default">4</span><span class="keyword">) ; else </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x0F</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$PALETTE</span><span class="keyword">[</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0;&#xA0; elseif (</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bits_per_pixel&apos;</span><span class="keyword">] == </span><span class="default">1</span><span class="keyword">)<br>&#xA0; &#xA0;&#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR </span><span class="keyword">= </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">&quot;n&quot;</span><span class="keyword">,</span><span class="default">$VIDE</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$IMG</span><span class="keyword">,</span><span class="default">floor</span><span class="keyword">(</span><span class="default">$P</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; if&#xA0; &#xA0;&#xA0; ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] =&#xA0; </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]&#xA0; &#xA0; &#xA0; &#xA0; &gt;&gt;</span><span class="default">7</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x40</span><span class="keyword">)&gt;&gt;</span><span class="default">6</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x20</span><span class="keyword">)&gt;&gt;</span><span class="default">5</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">3</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x10</span><span class="keyword">)&gt;&gt;</span><span class="default">4</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">4</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x8</span><span class="keyword">)&gt;&gt;</span><span class="default">3</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">5</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x4</span><span class="keyword">)&gt;&gt;</span><span class="default">2</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">6</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x2</span><span class="keyword">)&gt;&gt;</span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif ((</span><span class="default">$P</span><span class="keyword">*</span><span class="default">8</span><span class="keyword">)%</span><span class="default">8 </span><span class="keyword">== </span><span class="default">7</span><span class="keyword">) </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = (</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &amp; </span><span class="default">0x1</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">$PALETTE</span><span class="keyword">[</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">];<br>&#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0;&#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">FALSE</span><span class="keyword">;<br>&#xA0; &#xA0;&#xA0; </span><span class="default">imagesetpixel</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">,</span><span class="default">$X</span><span class="keyword">,</span><span class="default">$Y</span><span class="keyword">,</span><span class="default">$COLOR</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$X</span><span class="keyword">++;<br>&#xA0; &#xA0;&#xA0; </span><span class="default">$P </span><span class="keyword">+= </span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;bytes_per_pixel&apos;</span><span class="keyword">];<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">$Y</span><span class="keyword">--;<br>&#xA0; &#xA0; </span><span class="default">$P</span><span class="keyword">+=</span><span class="default">$BMP</span><span class="keyword">[</span><span class="string">&apos;decal&apos;</span><span class="keyword">];<br>&#xA0;&#xA0; }<br><br> </span><span class="comment">//Fermeture du fichier<br>&#xA0;&#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$f1</span><span class="keyword">);<br><br> return </span><span class="default">$res</span><span class="keyword">;<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.imagecreate.php)

**[⬆ to root](/)**