# set_time_limit




<div class="phpcode"><span class="html">
while setting the set_time_limit(), the duration of sleep() will be ignored in the execution time. The following illustrates:<br><br><span class="default">&lt;?php<br><br>set_time_limit</span><span class="keyword">(</span><span class="default">20</span><span class="keyword">);<br><br>while (</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">10</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="string">&quot;i=</span><span class="default">$i</span><span class="string"> &quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i</span><span class="keyword">++;<br>}<br><br></span><span class="default">?&gt;<br></span><br>Output:<br>i=0 i=1 i=2 i=3 i=4 i=5 i=6 i=7 i=8 i=9 i=10</span>
</div>
  

#


<div class="phpcode"><span class="html">
Both set_time_limit(...) and&#xA0; ini_set(&apos;max_execution_time&apos;,...); won&apos;t count the time cost of sleep,file_get_contents,shell_exec,mysql_query etc, so i build this function my_background_exec(), to run static method/function in background/detached process and time is out kill it:<br><br>my_exec.php:<br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="default">$function_name</span><span class="keyword">, </span><span class="default">$params</span><span class="keyword">, </span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">=</span><span class="default">600</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; {</span><span class="default">$map</span><span class="keyword">=array(</span><span class="string">&apos;&quot;&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;\&quot;&apos;</span><span class="keyword">, </span><span class="string">&apos;$&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;\$&apos;</span><span class="keyword">, </span><span class="string">&apos;`&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;\`&apos;</span><span class="keyword">, </span><span class="string">&apos;\\&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;\\\\&apos;</span><span class="keyword">, </span><span class="string">&apos;!&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;\!&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$str_requires</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$str_requires</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$path_run</span><span class="keyword">=</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">&apos;SCRIPT_FILENAME&apos;</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="string">&quot;/usr/bin/php -r \&quot;chdir(&apos;</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">&apos;);</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> \\\$params=json_decode(file_get_contents(&apos;php://stdin&apos;),true);call_user_func_array(&apos;</span><span class="keyword">{</span><span class="default">$function_name</span><span class="keyword">}</span><span class="string">&apos;, \\\$params);\&quot;&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$my_target_exec</span><span class="keyword">=</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">strtr</span><span class="keyword">(</span><span class="default">$my_target_exec</span><span class="keyword">, </span><span class="default">$map</span><span class="keyword">), </span><span class="default">$map</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$my_background_exec</span><span class="keyword">=</span><span class="string">&quot;(/usr/bin/php -r \&quot;chdir(&apos;</span><span class="keyword">{</span><span class="default">$path_run</span><span class="keyword">}</span><span class="string">&apos;);</span><span class="keyword">{</span><span class="default">$str_requires</span><span class="keyword">}</span><span class="string"> my_timeout_exec(\\\&quot;</span><span class="keyword">{</span><span class="default">$my_target_exec</span><span class="keyword">}</span><span class="string">\\\&quot;, file_get_contents(&apos;php://stdin&apos;), </span><span class="keyword">{</span><span class="default">$timeout</span><span class="keyword">}</span><span class="string">);\&quot; &lt;&amp;3 &amp;) 3&lt;&amp;0&quot;</span><span class="keyword">;</span><span class="comment">//php by default use &quot;sh&quot;, and &quot;sh&quot; don&apos;t support &quot;&lt;&amp;0&quot;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$my_background_exec</span><span class="keyword">, </span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">$params</span><span class="keyword">), </span><span class="default">2</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br><br>function </span><span class="default">my_timeout_exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, </span><span class="default">$stdin</span><span class="keyword">=</span><span class="string">&apos;&apos;</span><span class="keyword">, </span><span class="default">$timeout</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; {</span><span class="default">$start</span><span class="keyword">=</span><span class="default">time</span><span class="keyword">();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$stdout</span><span class="keyword">=</span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$stderr</span><span class="keyword">=</span><span class="string">&apos;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">//file_put_contents(&apos;debug.txt&apos;, time().&apos;:cmd:&apos;.$cmd.&quot;\n&quot;, FILE_APPEND);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; //file_put_contents(&apos;debug.txt&apos;, time().&apos;:stdin:&apos;.$stdin.&quot;\n&quot;, FILE_APPEND);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$process</span><span class="keyword">=</span><span class="default">proc_open</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">, [[</span><span class="string">&apos;pipe&apos;</span><span class="keyword">, </span><span class="string">&apos;r&apos;</span><span class="keyword">], [</span><span class="string">&apos;pipe&apos;</span><span class="keyword">, </span><span class="string">&apos;w&apos;</span><span class="keyword">], [</span><span class="string">&apos;pipe&apos;</span><span class="keyword">, </span><span class="string">&apos;w&apos;</span><span class="keyword">]], </span><span class="default">$pipes</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">is_resource</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; {return array(</span><span class="string">&apos;return&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;1&apos;</span><span class="keyword">, </span><span class="string">&apos;stdout&apos;</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">&apos;stderr&apos;</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">posix_setpgid</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">[</span><span class="string">&apos;pid&apos;</span><span class="keyword">], </span><span class="default">$status</span><span class="keyword">[</span><span class="string">&apos;pid&apos;</span><span class="keyword">]);&#xA0; &#xA0; </span><span class="comment">//seperate pgid(process group id) from parent&apos;s pgid<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">stream_set_blocking</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">0</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$stdin</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; while (</span><span class="default">1</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {</span><span class="default">$stdout</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$stderr</span><span class="keyword">.=</span><span class="default">stream_get_contents</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; if (</span><span class="default">time</span><span class="keyword">()-</span><span class="default">$start</span><span class="keyword">&gt;</span><span class="default">$timeout</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {</span><span class="comment">//proc_terminate($process, 9);&#xA0; &#xA0; //only terminate subprocess, won&apos;t terminate sub-subprocess<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">posix_kill</span><span class="keyword">(-</span><span class="default">$status</span><span class="keyword">[</span><span class="string">&apos;pid&apos;</span><span class="keyword">], </span><span class="default">9</span><span class="keyword">);&#xA0; &#xA0; </span><span class="comment">//sends SIGKILL to all processes inside group(negative means GPID, all subprocesses share the top process group, except nested my_timeout_exec)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; //file_put_contents(&apos;debug.txt&apos;, time().&quot;:kill group {$status[&apos;pid&apos;]}\n&quot;, FILE_APPEND);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">return array(</span><span class="string">&apos;return&apos;</span><span class="keyword">=&gt;</span><span class="string">&apos;1&apos;</span><span class="keyword">, </span><span class="string">&apos;stdout&apos;</span><span class="keyword">=&gt;</span><span class="default">$stdout</span><span class="keyword">, </span><span class="string">&apos;stderr&apos;</span><span class="keyword">=&gt;</span><span class="default">$stderr</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">$status</span><span class="keyword">=</span><span class="default">proc_get_status</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="comment">//file_put_contents(&apos;debug.txt&apos;, time().&apos;:status:&apos;.var_export($status, true).&quot;\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">if (!</span><span class="default">$status</span><span class="keyword">[</span><span class="string">&apos;running&apos;</span><span class="keyword">])<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$pipes</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">proc_close</span><span class="keyword">(</span><span class="default">$process</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; return </span><span class="default">$status</span><span class="keyword">[</span><span class="string">&apos;exitcode&apos;</span><span class="keyword">];<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100000</span><span class="keyword">); <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br></span><span class="default">?&gt;<br></span><br>a_class.php:<br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">A<br></span><span class="keyword">{<br>&#xA0; &#xA0; static function </span><span class="default">jack</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; {</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">4</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">&apos;debug.txt&apos;</span><span class="keyword">, </span><span class="default">time</span><span class="keyword">().</span><span class="string">&quot;:A::jack:&quot;</span><span class="keyword">.</span><span class="default">$a</span><span class="keyword">.</span><span class="string">&apos; &apos;</span><span class="keyword">.</span><span class="default">$b</span><span class="keyword">.</span><span class="string">&quot;\n&quot;</span><span class="keyword">, </span><span class="default">FILE_APPEND</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">15</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; }<br>}<br></span><span class="default">?&gt;<br></span><br>test.php:<br><span class="default">&lt;?php<br></span><span class="keyword">require </span><span class="string">&apos;my_exec.php&apos;</span><span class="keyword">;<br><br></span><span class="default">my_background_exec</span><span class="keyword">(</span><span class="string">&apos;A::jack&apos;</span><span class="keyword">, array(</span><span class="string">&apos;hello&apos;</span><span class="keyword">, </span><span class="string">&apos;jack&apos;</span><span class="keyword">), </span><span class="string">&apos;require &quot;my_exec.php&quot;;require &quot;a_class.php&quot;;&apos;</span><span class="keyword">, </span><span class="default">8</span><span class="keyword">);<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
To get the currently used time, use getrusage()</span>
</div>
  

#


<div class="phpcode"><span class="html">
In IIS, there is another global timeout setting which will override any PHP settings.&#xA0; You can alter this timeout by following the following instructions:<br><br><a href="http://www.iisadmin.co.uk/?p=7" rel="nofollow" target="_blank">http://www.iisadmin.co.uk/?p=7</a></span>
</div>
  

#


<div class="phpcode"><span class="html">
I was having trouble with script timeouts in applications where the user prompted long running background actions. I wrote this cURL/CLI background script that solved the problem when making requests from HTTP.<br><br><span class="default">&lt;?php<br><br></span><span class="comment">/* BACKGROUND CLI 1.0<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; eric pecoraro _at_ shepard dot com - 2005-06-02<br>&#xA0;&#xA0; Use at your own risk. No warranties expressed or implied.<br><br>&#xA0;&#xA0; Include this file at the top of any script to run it in the background<br>&#xA0;&#xA0; with no time limitations ... e.g., include(&apos;background_cli.php&apos;);<br>&#xA0;&#xA0; <br>&#xA0;&#xA0; The script that calls this file should not return output to the browser. <br>*/<br>#&#xA0; REQUIREMENTS - cURL and CLI<br>&#xA0;&#xA0; </span><span class="keyword">if ( !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;curl_setopt&apos;</span><span class="keyword">) OR !</span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">&apos;curl_setopt&apos;</span><span class="keyword">)&#xA0; ) {<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;Requires cURL and CLI installations.&apos; </span><span class="keyword">; exit ; <br>&#xA0;&#xA0; }<br>&#xA0;&#xA0; <br></span><span class="comment">#&#xA0; BUILD PATHS<br>&#xA0;&#xA0; </span><span class="default">$script </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">explode</span><span class="keyword">(</span><span class="string">&apos;/&apos;</span><span class="keyword">,</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)) ; <br>&#xA0;&#xA0; </span><span class="default">$script_dir </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$SCRIPT_NAME</span><span class="keyword">)-</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$script</span><span class="keyword">)) ;<br>&#xA0;&#xA0; </span><span class="default">$scriptURL </span><span class="keyword">= </span><span class="string">&apos;<a href="http://" rel="nofollow" target="_blank">http://</a>&apos;</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">&quot;</span><span class="default">$script</span><span class="string">&quot; </span><span class="keyword">;<br>&#xA0;&#xA0; </span><span class="default">$curlURL </span><span class="keyword">= </span><span class="string">&apos;<a href="http://" rel="nofollow" target="_blank">http://</a>&apos;</span><span class="keyword">. </span><span class="default">$HTTP_HOST </span><span class="keyword">. </span><span class="default">$script_dir </span><span class="keyword">. </span><span class="string">&quot;</span><span class="default">$script</span><span class="string">?runscript=curl&quot; </span><span class="keyword">;<br><br></span><span class="comment">#&#xA0; Indicate that script is being called by CLI <br>&#xA0;&#xA0; </span><span class="keyword">if ( </span><span class="default">php_sapi_name</span><span class="keyword">() == </span><span class="string">&apos;cli&apos; </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$CLI </span><span class="keyword">= </span><span class="default">true </span><span class="keyword">;<br>&#xA0;&#xA0; }<br><br></span><span class="comment">#&#xA0; Action if script is being called by cURL_prompt()<br>&#xA0;&#xA0; </span><span class="keyword">if ( </span><span class="default">$runscript </span><span class="keyword">== </span><span class="string">&apos;curl&apos; </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$cmd </span><span class="keyword">= </span><span class="string">&quot;/usr/local/bin/php &quot;</span><span class="keyword">.</span><span class="default">$PATH_TRANSLATED </span><span class="keyword">; </span><span class="comment">// server location of script to run<br>&#xA0; &#xA0; &#xA0; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$cmd</span><span class="keyword">) ;<br>&#xA0; &#xA0; &#xA0; exit;<br>&#xA0;&#xA0; }<br><br></span><span class="comment">#&#xA0; USER INTERFACE<br>&#xA0;&#xA0; // User answer after submission.<br>&#xA0;&#xA0; </span><span class="keyword">if ( </span><span class="default">$post </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$curlURL</span><span class="keyword">) ;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;div style=&quot;margin:25px;&quot;&gt;&lt;title&gt;Background CLI&lt;/title&gt;&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;O.K. If all goes well, &lt;b&gt;&apos;</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">&apos;&lt;/b&gt; is working hard in the background with no &apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;timeout limitations. &lt;br&gt;&lt;br&gt;&lt;form action=&apos;</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">&apos; method=GET&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;input type=submit value=&quot; RESET BACKGROUND CLI &quot;&gt;&lt;/form&gt;&lt;/div&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; exit ;<br>&#xA0;&#xA0; }<br>&#xA0;&#xA0; </span><span class="comment">// Start screen.<br>&#xA0;&#xA0; </span><span class="keyword">if ( !</span><span class="default">$CLI </span><span class="keyword">AND !</span><span class="default">$runscript </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;title&gt;Background CLI&lt;/title&gt;&lt;div style=&quot;margin:25px;&quot;&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;form action=&apos;</span><span class="keyword">.</span><span class="default">$scriptURL</span><span class="keyword">.</span><span class="string">&apos; method=POST&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;Click to run &lt;b&gt;&apos;</span><span class="keyword">.</span><span class="default">$script</span><span class="keyword">.</span><span class="string">&apos;&lt;/b&gt; from the PHP CLI command line, in the background.&lt;br&gt;&lt;br&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;input type=hidden value=1 name=post&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; echo </span><span class="string">&apos;&lt;input type=submit value=&quot; RUN IN BACKGROUND &quot;&gt;&lt;/form&gt;&lt;/div&gt;&apos; </span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; exit ;<br>&#xA0;&#xA0; }<br><br></span><span class="comment">#&#xA0; cURL URL PROMPT FUNCTION<br>&#xA0;&#xA0; </span><span class="keyword">function </span><span class="default">cURL_prompt</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">ob_start</span><span class="keyword">(); </span><span class="comment">// start output buffer<br>&#xA0; &#xA0; &#xA0; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">curl_init</span><span class="keyword">(</span><span class="default">$url_path</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; </span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">CURLOPT_TIMEOUT</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">); </span><span class="comment">// drop connection after 2 seconds<br>&#xA0; &#xA0; &#xA0; </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; </span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; </span><span class="default">ob_end_clean</span><span class="keyword">(); </span><span class="comment">// discard output buffer<br>&#xA0;&#xA0; </span><span class="keyword">}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.set-time-limit.php)

**[To root](/)**