# The 




<div class="phpcode"><span class="html">
Zip a folder (include itself).
<br>Usage:
<br>&#xA0; HZip::zipDir(&apos;/path/to/sourceDir&apos;, &apos;/path/to/out.zip&apos;);
<br>
<br><span class="default">&lt;?php
<br></span><span class="keyword">class </span><span class="default">HZip
<br></span><span class="keyword">{
<br>&#xA0; </span><span class="comment">/**
<br>&#xA0;&#xA0; * Add files and sub-directories in a folder to zip file.
<br>&#xA0;&#xA0; * @param string $folder
<br>&#xA0;&#xA0; * @param ZipArchive $zipFile
<br>&#xA0;&#xA0; * @param int $exclusiveLength Number of text to be exclusived from the file path.
<br>&#xA0;&#xA0; */
<br>&#xA0; </span><span class="keyword">private static function </span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">, &amp;</span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">) {
<br>&#xA0; &#xA0; </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">opendir</span><span class="keyword">(</span><span class="default">$folder</span><span class="keyword">);
<br>&#xA0; &#xA0; while (</span><span class="default">false </span><span class="keyword">!== </span><span class="default">$f </span><span class="keyword">= </span><span class="default">readdir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {
<br>&#xA0; &#xA0; &#xA0; if (</span><span class="default">$f </span><span class="keyword">!= </span><span class="string">&apos;.&apos; </span><span class="keyword">&amp;&amp; </span><span class="default">$f </span><span class="keyword">!= </span><span class="string">&apos;..&apos;</span><span class="keyword">) {
<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$filePath </span><span class="keyword">= </span><span class="string">&quot;</span><span class="default">$folder</span><span class="string">/</span><span class="default">$f</span><span class="string">&quot;</span><span class="keyword">;
<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Remove prefix from file path before add to zip.
<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$localPath </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$localPath</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; } elseif (</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">)) {
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Add sub-directory.
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$zipFile</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$localPath</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$filePath</span><span class="keyword">, </span><span class="default">$zipFile</span><span class="keyword">, </span><span class="default">$exclusiveLength</span><span class="keyword">);
<br>&#xA0; &#xA0; &#xA0; &#xA0; }
<br>&#xA0; &#xA0; &#xA0; }
<br>&#xA0; &#xA0; }
<br>&#xA0; &#xA0; </span><span class="default">closedir</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);
<br>&#xA0; }
<br>
<br>&#xA0; </span><span class="comment">/**
<br>&#xA0;&#xA0; * Zip a folder (include itself).
<br>&#xA0;&#xA0; * Usage:
<br>&#xA0;&#xA0; *&#xA0;&#xA0; HZip::zipDir(&apos;/path/to/sourceDir&apos;, &apos;/path/to/out.zip&apos;);
<br>&#xA0;&#xA0; *
<br>&#xA0;&#xA0; * @param string $sourcePath Path of directory to be zip.
<br>&#xA0;&#xA0; * @param string $outZipPath Path of output zip file.
<br>&#xA0;&#xA0; */
<br>&#xA0; </span><span class="keyword">public static function </span><span class="default">zipDir</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$outZipPath</span><span class="keyword">)
<br>&#xA0; {
<br>&#xA0; &#xA0; </span><span class="default">$pathInfo </span><span class="keyword">= </span><span class="default">pathInfo</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">);
<br>&#xA0; &#xA0; </span><span class="default">$parentPath </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">&apos;dirname&apos;</span><span class="keyword">];
<br>&#xA0; &#xA0; </span><span class="default">$dirName </span><span class="keyword">= </span><span class="default">$pathInfo</span><span class="keyword">[</span><span class="string">&apos;basename&apos;</span><span class="keyword">];
<br>
<br>&#xA0; &#xA0; </span><span class="default">$z </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">();
<br>&#xA0; &#xA0; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$outZipPath</span><span class="keyword">, </span><span class="default">ZIPARCHIVE</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);
<br>&#xA0; &#xA0; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">addEmptyDir</span><span class="keyword">(</span><span class="default">$dirName</span><span class="keyword">);
<br>&#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">folderToZip</span><span class="keyword">(</span><span class="default">$sourcePath</span><span class="keyword">, </span><span class="default">$z</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="string">&quot;</span><span class="default">$parentPath</span><span class="string">/&quot;</span><span class="keyword">));
<br>&#xA0; &#xA0; </span><span class="default">$z</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br>&#xA0; }
<br>}
<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
With PHP 5.6+, you may come up with theses errors.<br><br>Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br><br>Warning: ZipArchive::close(): Can&apos;t remove file: No such file or directory in xxxx.php on line xx<br><br>Examples<br><br>Warning: Unknown: Cannot destroy the zip context in Unknown on line 0<br><br><span class="default">&lt;?php&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; <br>&#xA0; &#xA0; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">&apos;51-n.com.zip&apos;</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Warning: ZipArchive::close(): Can&apos;t remove file: No such file or directory in xxxx.php on line xx<br><br><span class="default">&lt;?php&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; <br>&#xA0; &#xA0; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">&apos;51-n.com.zip&apos;</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>It happens when the zip archive is empty.<br>Your zip archive will not be saved on disk unless it has at least one file. What&apos;s more, when ZipArchive::OVERWRITE is applied, if there exists a file with the same name, it will be removed after ZipArchive::open() is called.<br><br>So, don&apos;t forget to put at least one file to your zip archive.<br><br><span class="default">&lt;?php&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; <br>&#xA0; &#xA0; $za </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="string">&apos;51-n.com.zip&apos;</span><span class="keyword">,</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">|</span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">OVERWRITE</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">addFromString</span><span class="keyword">(</span><span class="string">&apos;wuxiancheng.cn.txt&apos;</span><span class="keyword">,</span><span class="string">&apos;yes&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$za</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
There is a usefull function to get the ZipArchive status as a human readable string :<br><br><span class="default">&lt;?php<br></span><span class="keyword">function </span><span class="default">ZipStatusString</span><span class="keyword">( </span><span class="default">$status </span><span class="keyword">)<br>{<br>&#xA0; &#xA0; switch( (int) </span><span class="default">$status </span><span class="keyword">)<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OK&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N No error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MULTIDISK&#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Multi-disk zip archives not supported&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_RENAME&#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Renaming temporary file failed&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CLOSE&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Closing zip archive failed&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_SEEK&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Seek error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_READ&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Read error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_WRITE&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Write error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CRC&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N CRC error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZIPCLOSED&#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Containing zip archive was closed&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOENT&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N No such file&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EXISTS&#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N File already exists&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_OPEN&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Can\&apos;t open file&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_TMPOPEN&#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Failure to create temporary file&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_ZLIB&#xA0; &#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;Z Zlib error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_MEMORY&#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Malloc failure&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_CHANGED&#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Entry has been changed&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_COMPNOTSUPP&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Compression method not supported&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_EOF&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Premature EOF&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INVAL&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Invalid argument&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_NOZIP&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Not a zip archive&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INTERNAL&#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Internal error&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_INCONS&#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Zip archive inconsistent&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_REMOVE&#xA0; &#xA0; &#xA0;&#xA0; </span><span class="keyword">: return </span><span class="string">&apos;S Can\&apos;t remove file&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; case </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">ER_DELETED&#xA0; &#xA0; &#xA0; </span><span class="keyword">: return </span><span class="string">&apos;N Entry has been deleted&apos;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; default: return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">&apos;Unknown status %s&apos;</span><span class="keyword">, </span><span class="default">$status </span><span class="keyword">);<br>&#xA0; &#xA0; }<br>}<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
A way of zipping files and downloading them thereafter:<br><span class="default">&lt;?php<br><br> $files </span><span class="keyword">= array(</span><span class="string">&apos;image.jpeg&apos;</span><span class="keyword">,</span><span class="string">&apos;text.txt&apos;</span><span class="keyword">,</span><span class="string">&apos;music.wav&apos;</span><span class="keyword">);<br></span><span class="default">$zipname </span><span class="keyword">= </span><span class="string">&apos;enter_any_name_for_the_zipped_file.zip&apos;</span><span class="keyword">;<br></span><span class="default">$zip </span><span class="keyword">= new </span><span class="default">ZipArchive</span><span class="keyword">;<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">open</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">, </span><span class="default">ZipArchive</span><span class="keyword">::</span><span class="default">CREATE</span><span class="keyword">);<br>foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$file</span><span class="keyword">) {<br>&#xA0; </span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">addFile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>}<br></span><span class="default">$zip</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();<br><br></span><span class="comment">///Then download the zipped file.<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-Type: application/zip&apos;</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-disposition: attachment; filename=&apos;</span><span class="keyword">.</span><span class="default">$zipname</span><span class="keyword">);<br></span><span class="default">header</span><span class="keyword">(</span><span class="string">&apos;Content-Length: &apos; </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">));<br></span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$zipname</span><span class="keyword">);<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/class.ziparchive.php)

**[To root](/README.md)**