# imagecreatetruecolor




<div class="phpcode"><span class="html">
HOW THE CHECK THE MEMORY BEFORE CREATING AN IMAGE?<br><br>I worked on a script where I delt with large images. Very often the error &quot;out of memory&quot; occured. So I had to figure out, how to check the memory BEFORE creating an image. I didn&apos;t find a solution on the web, so I ran my own test script. It built lots of images to compute the needed memory. I found out, that the formula mem = x * y * channel was not enough. There was an additional multiplier that varied. As a result 1.7 worked best. So the formula is: mem = x * y * channel * 1.7.<br><br>I post this script here hoping it is useful to someone who will run into the same problems.<br><br><span class="default">&lt;?php<br></span><span class="comment">//-------------------------------------------------- DEFINE MAXMEM<br></span><span class="default">define </span><span class="keyword">(</span><span class="string">&quot;MAXMEM&quot;</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">);&#xA0; </span><span class="comment">//--- memory limit (32M) ---<br><br>//-------------------------------------------------- ENOUGH MEMORY ?<br></span><span class="keyword">function </span><span class="default">enoughmem </span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">=</span><span class="default">3</span><span class="keyword">) {<br>&#xA0; &#xA0; return ( </span><span class="default">$x </span><span class="keyword">* </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$rgb </span><span class="keyword">* </span><span class="default">1.7 </span><span class="keyword">&lt; </span><span class="default">MAXMEM </span><span class="keyword">- </span><span class="default">memory_get_usage</span><span class="keyword">() );<br>}<br><br></span><span class="comment">//-------------------------------------------------- SIMPLE EXAMPLE<br></span><span class="keyword">list (</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">) = @</span><span class="default">getimagesize </span><span class="keyword">(</span><span class="string">&apos;your_img.jpg&apos;</span><span class="keyword">);&#xA0; </span><span class="comment">//--- get size of img ---<br></span><span class="keyword">if (</span><span class="default">enoughmem</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">)) {<br>&#xA0; &#xA0; </span><span class="default">$img </span><span class="keyword">= @</span><span class="default">imagecreatefromjpeg </span><span class="keyword">(</span><span class="string">&apos;your_img.jpg&apos;</span><span class="keyword">);&#xA0; </span><span class="comment">//--- open img file ---<br>&#xA0; &#xA0; </span><span class="default">$thumb </span><span class="keyword">= </span><span class="default">200</span><span class="keyword">;&#xA0; </span><span class="comment">//--- max. size of thumb ---<br>&#xA0; &#xA0; </span><span class="keyword">if (</span><span class="default">$x </span><span class="keyword">&gt; </span><span class="default">$y</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tx </span><span class="keyword">= </span><span class="default">$thumb</span><span class="keyword">;&#xA0; </span><span class="comment">//--- landscape ---<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ty </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$thumb </span><span class="keyword">/ </span><span class="default">$x </span><span class="keyword">* </span><span class="default">$y</span><span class="keyword">);<br>&#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$tx </span><span class="keyword">= </span><span class="default">round</span><span class="keyword">(</span><span class="default">$thumb </span><span class="keyword">/ </span><span class="default">$y </span><span class="keyword">* </span><span class="default">$x</span><span class="keyword">);&#xA0; </span><span class="comment">//--- portrait ---<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$ty </span><span class="keyword">= </span><span class="default">$thumb</span><span class="keyword">;<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; if (</span><span class="default">enoughmem</span><span class="keyword">(</span><span class="default">$tx</span><span class="keyword">,</span><span class="default">$ty</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$thb </span><span class="keyword">= </span><span class="default">imagecreatetruecolor </span><span class="keyword">(</span><span class="default">$tx</span><span class="keyword">, </span><span class="default">$ty</span><span class="keyword">);&#xA0; </span><span class="comment">//--- create thumbnail ---<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">imagecopyresampled </span><span class="keyword">(</span><span class="default">$thb</span><span class="keyword">,</span><span class="default">$img</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">, </span><span class="default">$tx</span><span class="keyword">,</span><span class="default">$ty</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">,</span><span class="default">$y</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">imagejpeg </span><span class="keyword">(</span><span class="default">$thb</span><span class="keyword">, </span><span class="string">&apos;your_thumbnail.jpg&apos;</span><span class="keyword">, </span><span class="default">80</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">imagedestroy </span><span class="keyword">(</span><span class="default">$thb</span><span class="keyword">);<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">imagedestroy </span><span class="keyword">(</span><span class="default">$img</span><span class="keyword">);<br>}<br><br></span><span class="comment">//--------------------------------------------------<br>//--- to check the memory working with&#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; ---<br>//--- b/w-image or gif use:&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; ---<br>//--------------------------------------------------<br></span><span class="default">$check </span><span class="keyword">= </span><span class="default">enoughmem </span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Taking the opportunity, I thank everyone here at php.net for the great manual and the useful user scripts.</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you want to create a *transparent* PNG image, where the background is fully transparent, and all draw operations happen on-top of this, then do the following:<br><br><span class="default">&lt;?php<br>&#xA0; &#xA0; $png </span><span class="keyword">= </span><span class="default">imagecreatetruecolor</span><span class="keyword">(</span><span class="default">800</span><span class="keyword">, </span><span class="default">600</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagesavealpha</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br><br>&#xA0; &#xA0; </span><span class="default">$trans_colour </span><span class="keyword">= </span><span class="default">imagecolorallocatealpha</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">127</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagefill</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$trans_colour</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">$red </span><span class="keyword">= </span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">, </span><span class="default">255</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagefilledellipse</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">400</span><span class="keyword">, </span><span class="default">300</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&quot;Content-type: image/png&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">imagepng</span><span class="keyword">(</span><span class="default">$png</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>What you do is create a true colour image, make sure that the alpha save-state is on, then fill the image with a colour that has had its alpha level set to fully transparent (127).<br><br>The resulting PNG from the code above will have a red circle on a fully transparent background (drag the image into Photoshop to see for yourself)</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.imagecreatetruecolor.php)

**[⬆ to root](/)**