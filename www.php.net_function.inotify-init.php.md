# inotify_init




<div class="phpcode"><span class="html">
Example for tailing a file (like tail -f) using inotify.<br><span class="default">&lt;?php<br></span><span class="comment">/**<br> * Tail a file (UNIX only!)<br> * Watch a file for changes using inotify and return the changed data<br> *<br> * @param string $file - filename of the file to be watched<br> * @param integer $pos - actual position in the file<br> * @return string<br> */<br></span><span class="keyword">function </span><span class="default">tail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,&amp;</span><span class="default">$pos</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="comment">// get the size of the file<br>&#xA0; &#xA0; </span><span class="keyword">if(!</span><span class="default">$pos</span><span class="keyword">) </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="comment">// Open an inotify instance<br>&#xA0; &#xA0; </span><span class="default">$fd </span><span class="keyword">= </span><span class="default">inotify_init</span><span class="keyword">();<br>&#xA0; &#xA0; </span><span class="comment">// Watch $file for changes.<br>&#xA0; &#xA0; </span><span class="default">$watch_descriptor </span><span class="keyword">= </span><span class="default">inotify_add_watch</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">$file</span><span class="keyword">, </span><span class="default">IN_ALL_EVENTS</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="comment">// Loop forever (breaks are below)<br>&#xA0; &#xA0; </span><span class="keyword">while (</span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Read events (inotify_read is blocking!)<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$events </span><span class="keyword">= </span><span class="default">inotify_read</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Loop though the events which occured<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">foreach (</span><span class="default">$events </span><span class="keyword">as </span><span class="default">$event</span><span class="keyword">=&gt;</span><span class="default">$evdetails</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// React on the event type<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">switch (</span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// File was modified<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">case (</span><span class="default">$evdetails</span><span class="keyword">[</span><span class="string">&apos;mask&apos;</span><span class="keyword">] &amp; </span><span class="default">IN_MODIFY</span><span class="keyword">):<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Stop watching $file for changes<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">inotify_rm_watch</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">$watch_descriptor</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Close the inotify instance<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// open the file<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">&apos;r&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!</span><span class="default">$fp</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// seek to the last EOF position<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">$pos</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// read until EOF<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$buf </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// save the new EOF to $pos<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$pos </span><span class="keyword">= </span><span class="default">ftell</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">); </span><span class="comment">// (remember: $pos is called by reference)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // close the file pointer<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// return the new data and leave the function<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">$buf</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// be a nice guy and program good code ;-)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">break;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// File was moved or deleted<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">case (</span><span class="default">$evdetails</span><span class="keyword">[</span><span class="string">&apos;mask&apos;</span><span class="keyword">] &amp; </span><span class="default">IN_MOVE</span><span class="keyword">):<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; case (</span><span class="default">$evdetails</span><span class="keyword">[</span><span class="string">&apos;mask&apos;</span><span class="keyword">] &amp; </span><span class="default">IN_MOVE_SELF</span><span class="keyword">):<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; case (</span><span class="default">$evdetails</span><span class="keyword">[</span><span class="string">&apos;mask&apos;</span><span class="keyword">] &amp; </span><span class="default">IN_DELETE</span><span class="keyword">):<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; case (</span><span class="default">$evdetails</span><span class="keyword">[</span><span class="string">&apos;mask&apos;</span><span class="keyword">] &amp; </span><span class="default">IN_DELETE_SELF</span><span class="keyword">):<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Stop watching $file for changes<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">inotify_rm_watch</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">, </span><span class="default">$watch_descriptor</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Close the inotify instance<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$fd</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// Return a failure<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">false</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; break;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>}<br><br></span><span class="comment">// Use it like that:<br></span><span class="default">$lastpos </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>while (</span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; echo </span><span class="default">tail</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="default">$lastpos</span><span class="keyword">);<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.inotify-init.php)

**[To root](/README.md)**