# PCNTL FunctionsSee Also




<div class="phpcode"><span class="html">
If you want to create a daemon in PHP, consider using System_Daemon <a href="http://pear.php.net/package/System_Daemon" rel="nofollow" target="_blank">http://pear.php.net/package/System_Daemon</a><br><br>Install it like this:<br>pear install -f system_daemon<br><br>Then use it like this:<br><span class="default">&lt;?php<br></span><span class="comment">// Include PEAR&apos;s Daemon Class<br></span><span class="keyword">require_once </span><span class="string">&quot;System/Daemon.php&quot;</span><span class="keyword">;<br><br></span><span class="comment">// Bare minimum setup<br></span><span class="default">System_Daemon</span><span class="keyword">::</span><span class="default">setOption</span><span class="keyword">(</span><span class="string">&quot;appName&quot;</span><span class="keyword">, </span><span class="string">&quot;mydaemonname&quot;</span><span class="keyword">);<br><br></span><span class="comment">// Spawn Deamon!<br></span><span class="default">System_Daemon</span><span class="keyword">::</span><span class="default">start</span><span class="keyword">();<br><br></span><span class="comment">// Your PHP Here!<br></span><span class="keyword">while (</span><span class="default">true</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="default">doTask</span><span class="keyword">();<br>}<br><br></span><span class="comment">// Stop daemon!<br></span><span class="default">System_Daemon</span><span class="keyword">::</span><span class="default">stop</span><span class="keyword">();<br></span><span class="default">?&gt;<br></span><br>More examples can be found inside the PEAR package.</span>
</div>
  

#


<div class="phpcode"><span class="html">
(PHP 5.2.4) <br><br>This is an example of multithreading keeping different connections to a mysql database: when children exit they close the connection and others can&apos;t use it any more generating problems. In this example I used variable variables to make a different connection per each child. <br><br>This scripts loops forever with one mother detached from the terminal and five children &apos;named&apos; from 1 to 5. When one children sees it&apos;s name in the database (one table &apos;test.tb&apos; with only one field &apos;test&apos;) he lets himself die. To kill children insert their value in the db. The mother suicides only when all children are dead.<br><br>What a sad but interesting story...<br><br>&#xA0; &#xA0; $npid = pcntl_fork(); // DETACH FROM TERMINAL AND BE REAPED BY INIT<br><br>&#xA0; &#xA0; if ($npid==-1) die(&quot;Error: impossible to pcntl_fork()\n&quot;);<br>&#xA0; &#xA0; else if ($npid) exit(0); // THE GRANPA DIES<br>&#xA0; &#xA0; else // MOTHER GOES ON TO MAKE CHILDREN<br>&#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; $children = 5;<br>&#xA0; &#xA0; &#xA0; &#xA0; for ($i=1; $i&lt;=$children; $i++)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $pid = pcntl_fork();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ($pid==-1) die(&quot;Error: impossible to pcntl_fork()\n&quot;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; else if ($pid)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;&#xA0; $pid_arr[$i] = $pid;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!$pid) // CHILDREN<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; global $vconn;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $vconn = &quot;vconn$i&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; global $$vconn;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $$vconn = @mysql_connect(&quot;mydbhost&quot;,&quot;mydbuser&quot;,&quot;mydbpwd&quot;);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!($$vconn)) echo mysql_error();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (!($$vconn)) exit;<br><br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; while (1)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $query = &quot;SELECT test FROM test.tb&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $rs = mysql_query($query,$$vconn);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; $rw = mysql_fetch_row($rs);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if ($rw[0]==$i) exit;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; else<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; echo &quot;Database is $rw[0] and I am $i, it&apos;s not my time, I will wait....\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; sleep(1);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br><br>&#xA0; &#xA0; &#xA0; &#xA0; foreach ($pid_arr as $pid)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; // we are the parent and we wait for all children to die<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; pcntl_waitpid($pid, $status);<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; echo &quot;All my children died, I will suicide...\n&quot;;<br>&#xA0; &#xA0; &#xA0; &#xA0; exit();<br>&#xA0; &#xA0; }</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/ref.pcntl.php)

**[To root](/README.md)**