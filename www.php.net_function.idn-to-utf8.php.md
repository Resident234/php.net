# idn_to_utf8




<div class="phpcode"><span class="html">
<span class="default">&lt;?php<br></span><span class="comment">// for those who has PHP older than version 5.3<br></span><span class="keyword">class </span><span class="default">IDN </span><span class="keyword">{<br>&#xA0; &#xA0; </span><span class="comment">// adapt bias for punycode algorithm<br>&#xA0; &#xA0; </span><span class="keyword">private static function </span><span class="default">punyAdapt</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$numpoints</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$firsttime<br>&#xA0; &#xA0; </span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta </span><span class="keyword">= </span><span class="default">$firsttime </span><span class="keyword">? </span><span class="default">$delta </span><span class="keyword">/ </span><span class="default">700 </span><span class="keyword">: </span><span class="default">$delta </span><span class="keyword">/ </span><span class="default">2</span><span class="keyword">; <br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta </span><span class="keyword">+= </span><span class="default">$delta </span><span class="keyword">/ </span><span class="default">$numpoints</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; for (</span><span class="default">$k </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$delta </span><span class="keyword">&gt; </span><span class="default">455</span><span class="keyword">; </span><span class="default">$k </span><span class="keyword">+= </span><span class="default">36</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$delta </span><span class="keyword">= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$delta </span><span class="keyword">/ </span><span class="default">35</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">$k </span><span class="keyword">+ (</span><span class="default">36 </span><span class="keyword">* </span><span class="default">$delta</span><span class="keyword">) / (</span><span class="default">$delta </span><span class="keyword">+ </span><span class="default">38</span><span class="keyword">);<br>&#xA0; &#xA0; }<br> <br>&#xA0; &#xA0; </span><span class="comment">// translate character to punycode number<br>&#xA0; &#xA0; </span><span class="keyword">private static function </span><span class="default">decodeDigit</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$cp </span><span class="keyword">= </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$cp </span><span class="keyword">&gt;= </span><span class="string">&apos;a&apos; </span><span class="keyword">&amp;&amp; </span><span class="default">$cp </span><span class="keyword">&lt;= </span><span class="string">&apos;z&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">) - </span><span class="default">ord</span><span class="keyword">(</span><span class="string">&apos;a&apos;</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; elseif (</span><span class="default">$cp </span><span class="keyword">&gt;= </span><span class="string">&apos;0&apos; </span><span class="keyword">&amp;&amp; </span><span class="default">$cp </span><span class="keyword">&lt;= </span><span class="string">&apos;9&apos;</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">ord</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">) - </span><span class="default">ord</span><span class="keyword">(</span><span class="string">&apos;0&apos;</span><span class="keyword">)+</span><span class="default">26</span><span class="keyword">;<br>&#xA0; &#xA0; }<br> <br>&#xA0; &#xA0; </span><span class="comment">// make utf8 string from unicode codepoint number<br>&#xA0; &#xA0; </span><span class="keyword">private static function </span><span class="default">utf8</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$cp </span><span class="keyword">&lt; </span><span class="default">128</span><span class="keyword">) return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$cp</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$cp </span><span class="keyword">&lt; </span><span class="default">2048</span><span class="keyword">) <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">chr</span><span class="keyword">(</span><span class="default">192</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">)).</span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$cp </span><span class="keyword">&lt; </span><span class="default">65536</span><span class="keyword">) return <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">224</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">)).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+((</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$cp </span><span class="keyword">&lt; </span><span class="default">2097152</span><span class="keyword">) return <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">240</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">18</span><span class="keyword">)).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+((</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">12</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+((</span><span class="default">$cp </span><span class="keyword">&gt;&gt; </span><span class="default">6</span><span class="keyword">) &amp; </span><span class="default">63</span><span class="keyword">)).<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">chr</span><span class="keyword">(</span><span class="default">128</span><span class="keyword">+(</span><span class="default">$cp </span><span class="keyword">&amp; </span><span class="default">63</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// it should never get here <br>&#xA0; &#xA0; </span><span class="keyword">}<br> <br>&#xA0; &#xA0; </span><span class="comment">// main decoding function<br>&#xA0; &#xA0; </span><span class="keyword">private static function </span><span class="default">decodePart</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">) != </span><span class="string">&quot;xn--&quot;</span><span class="keyword">) </span><span class="comment">// prefix check...<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">$input</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">); </span><span class="comment">// discard prefix<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">&quot;-&quot;</span><span class="keyword">,</span><span class="default">$input</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">) &gt; </span><span class="default">1</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$output </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">implode</span><span class="keyword">(</span><span class="string">&quot;-&quot;</span><span class="keyword">,</span><span class="default">$a</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; } else {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$output </span><span class="keyword">= array();<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$input </span><span class="keyword">= </span><span class="default">str_split</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">128</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$bias </span><span class="keyword">= </span><span class="default">72</span><span class="keyword">; </span><span class="comment">// init punycode vars<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">while (!empty(</span><span class="default">$input</span><span class="keyword">)) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$oldi </span><span class="keyword">= </span><span class="default">$i</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$w </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; for (</span><span class="default">$k </span><span class="keyword">= </span><span class="default">36</span><span class="keyword">;;</span><span class="default">$k </span><span class="keyword">+= </span><span class="default">36</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$digit </span><span class="keyword">= </span><span class="default">IDN</span><span class="keyword">::</span><span class="default">decodeDigit</span><span class="keyword">(</span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$input</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">+= </span><span class="default">$digit </span><span class="keyword">* </span><span class="default">$w</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$k </span><span class="keyword">&lt;= </span><span class="default">$bias</span><span class="keyword">) </span><span class="default">$t </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; elseif (</span><span class="default">$k </span><span class="keyword">&gt;= </span><span class="default">$bias </span><span class="keyword">+ </span><span class="default">26</span><span class="keyword">) </span><span class="default">$t </span><span class="keyword">= </span><span class="default">26</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; else </span><span class="default">$t </span><span class="keyword">= </span><span class="default">$k </span><span class="keyword">- </span><span class="default">$bias</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; if (</span><span class="default">$digit </span><span class="keyword">&lt; </span><span class="default">$t</span><span class="keyword">) break;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$w </span><span class="keyword">*= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">36 </span><span class="keyword">- </span><span class="default">$t</span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$bias </span><span class="keyword">= </span><span class="default">IDN</span><span class="keyword">::</span><span class="default">punyAdapt</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i</span><span class="keyword">-</span><span class="default">$oldi</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$oldi </span><span class="keyword">== </span><span class="default">0<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">);<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$n </span><span class="keyword">+= </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$i </span><span class="keyword">/ (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i </span><span class="keyword">%= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">) + </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$output</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,array(</span><span class="default">IDN</span><span class="keyword">::</span><span class="default">utf8</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">)));<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$i</span><span class="keyword">++;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="default">implode</span><span class="keyword">(</span><span class="string">&quot;&quot;</span><span class="keyword">,</span><span class="default">$output</span><span class="keyword">);<br>&#xA0; &#xA0; }<br> <br>&#xA0; &#xA0; public static function </span><span class="default">decodeIDN</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// split it, parse it and put it back together<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="keyword">return <br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">implode</span><span class="keyword">(<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="string">&quot;.&quot;</span><span class="keyword">,<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">&quot;IDN::decodePart&quot;</span><span class="keyword">,</span><span class="default">explode</span><span class="keyword">(</span><span class="string">&quot;.&quot;</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">))<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; );<br>&#xA0; &#xA0; }<br> <br>}<br>echo </span><span class="default">IDN</span><span class="keyword">::</span><span class="default">decodeIDN</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">&apos;HTTP_HOST&apos;</span><span class="keyword">]);<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/function.idn-to-utf8.php)

**[To root](/README.md)**