# Anonymous functions




<div class="phpcode"><span class="html">
Watch out when &apos;importing&apos; variables to a closure&apos;s scope&#xA0; -- it&apos;s easy to miss / forget that they are actually being *copied* into the closure&apos;s scope, rather than just being made available.<br><br>So you will need to explicitly pass them in by reference if your closure cares about their contents over time:<br><br><span class="default">&lt;?php<br>$result </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br><br></span><span class="default">$one </span><span class="keyword">= function()<br>{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br><br></span><span class="default">$two </span><span class="keyword">= function() use (</span><span class="default">$result</span><span class="keyword">)<br>{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br><br></span><span class="default">$three </span><span class="keyword">= function() use (&amp;</span><span class="default">$result</span><span class="keyword">)<br>{ </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$result</span><span class="keyword">); };<br><br></span><span class="default">$result</span><span class="keyword">++;<br><br></span><span class="default">$one</span><span class="keyword">();&#xA0; &#xA0; </span><span class="comment">// outputs NULL: $result is not in scope<br></span><span class="default">$two</span><span class="keyword">();&#xA0; &#xA0; </span><span class="comment">// outputs int(0): $result was copied<br></span><span class="default">$three</span><span class="keyword">();&#xA0; &#xA0; </span><span class="comment">// outputs int(1)<br></span><span class="default">?&gt;<br></span><br>Another less trivial example with objects (what I actually tripped up on):<br><br><span class="default">&lt;?php<br></span><span class="comment">//set up variable in advance<br></span><span class="default">$myInstance </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br><br></span><span class="default">$broken </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(</span><span class="default">$myInstance</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br>};<br><br></span><span class="default">$working </span><span class="keyword">= function() </span><span class="default">uses </span><span class="keyword">(&amp;</span><span class="default">$myInstance</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; if(!empty(</span><span class="default">$myInstance</span><span class="keyword">)) </span><span class="default">$myInstance</span><span class="keyword">-&gt;</span><span class="default">doSomething</span><span class="keyword">();<br>}<br><br></span><span class="comment">//$myInstance might be instantiated, might not be<br></span><span class="keyword">if(</span><span class="default">SomeBusinessLogic</span><span class="keyword">::</span><span class="default">worked</span><span class="keyword">() == </span><span class="default">true</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$myInstance </span><span class="keyword">= new </span><span class="default">myClass</span><span class="keyword">();<br>}<br><br></span><span class="default">$broken</span><span class="keyword">();&#xA0; &#xA0; </span><span class="comment">// will never do anything: $myInstance will ALWAYS be null inside this closure.<br></span><span class="default">$working</span><span class="keyword">();&#xA0; &#xA0; </span><span class="comment">// will call doSomething if $myInstance is instantiated<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
To recursively call a closure, use this code.
<br>
<br><span class="default">&lt;?php
<br>$recursive </span><span class="keyword">= function () use (&amp;</span><span class="default">$recursive</span><span class="keyword">){
<br>&#xA0; &#xA0; </span><span class="comment">// The function is now available as $recursive
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;
<br></span>
<br>This DOES NOT WORK
<br>
<br><span class="default">&lt;?php
<br>$recursive </span><span class="keyword">= function () use (</span><span class="default">$recursive</span><span class="keyword">){
<br>&#xA0; &#xA0; </span><span class="comment">// The function is now available as $recursive
<br></span><span class="keyword">}
<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
You may have been disapointed if you tried to call a closure stored in an instance variable as you would regularly do with methods:<br><br><span class="default">&lt;?php<br><br>$obj </span><span class="keyword">= new </span><span class="default">StdClass</span><span class="keyword">();<br><br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func </span><span class="keyword">= function(){<br> echo </span><span class="string">&quot;hello&quot;</span><span class="keyword">;<br>};<br><br></span><span class="comment">//$obj-&gt;func(); // doesn&apos;t work! php tries to match an instance method called &quot;func&quot; that is not defined in the original class&apos; signature<br><br>// you have to do this instead:<br></span><span class="default">$func </span><span class="keyword">= </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func</span><span class="keyword">;<br></span><span class="default">$func</span><span class="keyword">();<br><br></span><span class="comment">// or:<br></span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">func</span><span class="keyword">);<br><br></span><span class="comment">// however, you might wanna check this out:<br></span><span class="default">$array</span><span class="keyword">[</span><span class="string">&apos;func&apos;</span><span class="keyword">] = function(){<br> echo </span><span class="string">&quot;hello&quot;</span><span class="keyword">;<br>};<br><br></span><span class="default">$array</span><span class="keyword">[</span><span class="string">&apos;func&apos;</span><span class="keyword">](); </span><span class="comment">// it works! i discovered that just recently ;)<br></span><span class="default">?&gt;<br></span><br>Now, coming back to the problem of assigning functions/methods &quot;on the fly&quot; to an object and being able to call them as if they were regular methods, you could trick php with this lawbreaker-code:<br><br><span class="default">&lt;?php<br></span><span class="keyword">class </span><span class="default">test</span><span class="keyword">{<br> private </span><span class="default">$functions </span><span class="keyword">= array();<br> private </span><span class="default">$vars </span><span class="keyword">= array();<br> <br> function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$data</span><span class="keyword">)<br> {<br>&#xA0; if(</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br>&#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br>&#xA0; else<br>&#xA0;&#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br> }<br> <br> function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$name</span><span class="keyword">)<br> {<br>&#xA0; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">]))<br>&#xA0;&#xA0; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">vars</span><span class="keyword">[</span><span class="default">$name</span><span class="keyword">];<br> }<br> <br> function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$method</span><span class="keyword">,</span><span class="default">$args</span><span class="keyword">)<br> {<br>&#xA0; if(isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$method</span><span class="keyword">]))<br>&#xA0; {<br>&#xA0;&#xA0; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">functions</span><span class="keyword">[</span><span class="default">$method</span><span class="keyword">],</span><span class="default">$args</span><span class="keyword">);<br>&#xA0; } else {<br>&#xA0;&#xA0; </span><span class="comment">// error out<br>&#xA0; </span><span class="keyword">}<br> }<br>}<br><br></span><span class="comment">// LET&apos;S BREAK SOME LAW NOW!<br></span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">test</span><span class="keyword">;<br><br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">sayHelloWithMyName </span><span class="keyword">= function(</span><span class="default">$name</span><span class="keyword">){<br> echo </span><span class="string">&quot;Hello </span><span class="default">$name</span><span class="string">!&quot;</span><span class="keyword">;<br>};<br><br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">sayHelloWithMyName</span><span class="keyword">(</span><span class="string">&apos;Fabio&apos;</span><span class="keyword">); </span><span class="comment">// Hello Fabio!<br><br>// THE OLD WAY (NON-CLOSURE) ALSO WORKS:<br><br></span><span class="keyword">function </span><span class="default">sayHello</span><span class="keyword">()<br>{<br> echo </span><span class="string">&quot;Hello!&quot;</span><span class="keyword">;<br>}<br><br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">justSayHello </span><span class="keyword">= </span><span class="string">&apos;sayHello&apos;</span><span class="keyword">;<br></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">justSayHello</span><span class="keyword">(); </span><span class="comment">// Hello!<br></span><span class="default">?&gt;<br></span><br>NOTICE: of course this is very bad practice since you cannot refere to protected or private fields/methods inside these pseudo &quot;methods&quot; as they are not instance methods at all but rather ordinary functions/closures assigned to the object&apos;s instance variables &quot;on the fly&quot;. But I hope you&apos;ve enjoyed the jurney ;)</span>
</div>
  

#


<div class="phpcode"><span class="html">
In case you were wondering (cause i was), anonymous functions can return references just like named functions can.&#xA0; Simply use the &amp; the same way you would for a named function...right after the `function` keyword (and right before the nonexistent name).<br><br><span class="default">&lt;?php<br>&#xA0; &#xA0; $value </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">$fn </span><span class="keyword">= function &amp;() use (&amp;</span><span class="default">$value</span><span class="keyword">) { return </span><span class="default">$value</span><span class="keyword">; };<br><br>&#xA0; &#xA0; </span><span class="default">$x </span><span class="keyword">=&amp; </span><span class="default">$fn</span><span class="keyword">();<br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// &apos;int(0)&apos;, &apos;int(0)&apos;<br>&#xA0; &#xA0; </span><span class="keyword">++</span><span class="default">$x</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">);&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="comment">// &apos;int(1)&apos;, &apos;int(1)&apos;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
<span class="default">&lt;?php<br>&#xA0; &#xA0; </span><span class="comment">/*<br>&#xA0; &#xA0; (string) $name Name of the function that you will add to class.<br>&#xA0; &#xA0; Usage : $Foo-&gt;add(function(){},$name);<br>&#xA0; &#xA0; This will add a public function in Foo Class.<br>&#xA0; &#xA0; */<br>&#xA0; &#xA0; </span><span class="keyword">class </span><span class="default">Foo<br>&#xA0; &#xA0; </span><span class="keyword">{<br>&#xA0; &#xA0; &#xA0; &#xA0; public function </span><span class="default">add</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">)<br>&#xA0; &#xA0; &#xA0; &#xA0; {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$name</span><span class="keyword">} = </span><span class="default">$func</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; public function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$func</span><span class="keyword">,</span><span class="default">$arguments</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;{</span><span class="default">$func</span><span class="keyword">}, </span><span class="default">$arguments</span><span class="keyword">); <br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; </span><span class="default">$Foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br>&#xA0; &#xA0; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(function(){<br>&#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="string">&quot;Hello World&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; },</span><span class="string">&quot;helloWorldFunction&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">add</span><span class="keyword">(function(</span><span class="default">$parameterone</span><span class="keyword">){<br>&#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="default">$parameterone</span><span class="keyword">;<br>&#xA0; &#xA0; },</span><span class="string">&quot;exampleFunction&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">helloWorldFunction</span><span class="keyword">(); </span><span class="comment">/*Output : Hello World*/<br>&#xA0; &#xA0; </span><span class="default">$Foo</span><span class="keyword">-&gt;</span><span class="default">exampleFunction</span><span class="keyword">(</span><span class="string">&quot;Hello PHP&quot;</span><span class="keyword">); </span><span class="comment">/*Output : Hello PHP*/<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you want to create and then immediately call a closure directly, in-line, and immediately get its return value (instead of the closure reference itself), then the proper syntax is as follows:<br><br><span class="default">&lt;?php<br><br>$a </span><span class="keyword">= </span><span class="string">&apos;foo&apos;</span><span class="keyword">; </span><span class="default">$b </span><span class="keyword">= </span><span class="string">&apos;bar&apos;</span><span class="keyword">;<br></span><span class="default">$test </span><span class="keyword">= (function() use(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">) { return </span><span class="default">$a </span><span class="keyword">. </span><span class="default">$b</span><span class="keyword">; })();<br>echo </span><span class="default">$test</span><span class="keyword">;<br><br></span><span class="default">?&gt;<br></span><br>As for why you would want to do that? Well, that&apos;s up to you. I&apos;m sure there are some legitimate reasons. It&apos;s a pretty common pattern in some other famous scripting languages. But if you&apos;re doing this in PHP, you should think carefully and ask yourself if you really have a good reason for it, or if you should just go and re-structure your code instead. ;-)</span>
</div>
  

#


<div class="phpcode"><span class="html">
If you want to make sure that one of the parameters of your function is a Closure, you can use Type Hinting.<br>see: <a href="http://php.net/manual/en/language.oop5.typehinting.php" rel="nofollow" target="_blank">http://php.net/manual/en/language.oop5.typehinting.php</a><br><br>Example:<br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">TheRoot<br></span><span class="keyword">{<br>&#xA0; &#xA0; public function </span><span class="default">poidh</span><span class="keyword">(</span><span class="default">$param</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; echo </span><span class="string">&quot;TheRoot </span><span class="default">$param</span><span class="string">!&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; }&#xA0;&#xA0; <br><br>}<br><br>class </span><span class="default">Internet<br></span><span class="keyword">{<br>&#xA0; &#xA0; </span><span class="comment"># here, $my_closure must be of type object Closure<br>&#xA0; &#xA0; </span><span class="keyword">public function </span><span class="default">run_my_closure</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">, </span><span class="default">Closure $my_closure</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$my_closure</span><span class="keyword">(</span><span class="default">$bar</span><span class="keyword">);<br>&#xA0; &#xA0; }&#xA0;&#xA0; <br>}<br><br></span><span class="default">$Internet </span><span class="keyword">= new </span><span class="default">Internet</span><span class="keyword">();<br></span><span class="default">$Root </span><span class="keyword">= new </span><span class="default">TheRoot</span><span class="keyword">();<br><br></span><span class="default">$Internet</span><span class="keyword">-&gt;</span><span class="default">run_my_closure</span><span class="keyword">(</span><span class="default">$Root</span><span class="keyword">, function(</span><span class="default">$Object</span><span class="keyword">) {<br>&#xA0; &#xA0; </span><span class="default">$Object</span><span class="keyword">-&gt;</span><span class="default">poidh</span><span class="keyword">(</span><span class="default">42</span><span class="keyword">);<br>});<br><br></span><span class="default">?&gt;<br></span>The above code simply yields:<br>&quot;TheRoot 42!&quot;<br><br>NOTE: If you are using namespaces, make sure you give a fully qualified namespace.<br><br>print_r() of Internet::run_my_closure&apos;s $my_closure<br><span class="default">&lt;?php<br>Closure Object<br></span><span class="keyword">(<br>&#xA0; &#xA0; [</span><span class="default">parameter</span><span class="keyword">] =&gt; Array<br>&#xA0; &#xA0; &#xA0; &#xA0; (<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; [</span><span class="default">$Object</span><span class="keyword">] =&gt; <br>&#xA0; &#xA0; &#xA0; &#xA0; )<br><br>)<br></span><span class="default">?&gt;<br></span><br>var_dump() of Internet::run_my_closure&apos;s $my_closure<br><span class="default">&lt;?php<br>object</span><span class="keyword">(</span><span class="default">Closure</span><span class="keyword">)</span><span class="comment">#3 (1) {<br>&#xA0; </span><span class="keyword">[</span><span class="string">&quot;parameter&quot;</span><span class="keyword">]=&gt;<br>&#xA0; array(</span><span class="default">1</span><span class="keyword">) {<br>&#xA0; &#xA0; [</span><span class="string">&quot;</span><span class="default">$Object</span><span class="string">&quot;</span><span class="keyword">]=&gt;<br>&#xA0; &#xA0; </span><span class="default">string</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">) </span><span class="string">&quot;&quot;<br>&#xA0; </span><span class="keyword">}<br>}<br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
When using anonymous functions as properties in Classes, note that there are three name scopes: one for constants, one for properties and one for methods. That means, you can use the same name for a constant, for a property and for a method at a time.<br><br>Since a property can be also an anonymous function as of PHP 5.3.0, an oddity arises when they share the same name, not meaning that there would be any conflict.<br><br>Consider the following example:<br><br><span class="default">&lt;?php<br>&#xA0; &#xA0; </span><span class="keyword">class </span><span class="default">MyClass </span><span class="keyword">{<br>&#xA0; &#xA0; &#xA0; &#xA0; const </span><span class="default">member </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; public </span><span class="default">$member</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; public function </span><span class="default">member </span><span class="keyword">() {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="string">&quot;method &apos;member&apos;&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; &#xA0; &#xA0; <br>&#xA0; &#xA0; &#xA0; &#xA0; public function </span><span class="default">__construct </span><span class="keyword">() {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">member </span><span class="keyword">= function () {<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; return </span><span class="string">&quot;anonymous function &apos;member&apos;&quot;</span><span class="keyword">;<br>&#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; };<br>&#xA0; &#xA0; &#xA0; &#xA0; }<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">header</span><span class="keyword">(</span><span class="string">&quot;Content-Type: text/plain&quot;</span><span class="keyword">);<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">$myObj </span><span class="keyword">= new </span><span class="default">MyClass</span><span class="keyword">();<br><br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">MyClass</span><span class="keyword">::</span><span class="default">member</span><span class="keyword">);&#xA0; </span><span class="comment">// int(1)<br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">);&#xA0;&#xA0; </span><span class="comment">// object(Closure)#2 (0) {}<br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">()); </span><span class="comment">// string(15) &quot;method &apos;member&apos;&quot;<br>&#xA0; &#xA0; </span><span class="default">$myMember </span><span class="keyword">= </span><span class="default">$myObj</span><span class="keyword">-&gt;</span><span class="default">member</span><span class="keyword">;<br>&#xA0; &#xA0; </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$myMember</span><span class="keyword">());&#xA0; &#xA0; &#xA0; </span><span class="comment">// string(27) &quot;anonymous function &apos;member&apos;&quot;<br></span><span class="default">?&gt;<br></span><br>That means, regular method invocations work like expected and like before. The anonymous function instead, must be retrieved into a variable first (just like a property) and can only then be invoked.<br><br>Best regards,</span>
</div>
  

#


<div class="phpcode"><span class="html">
PERFORMANCE BENCHMARK 2017!<br><br>I decided to compare a single, saved closure against constantly creating the same anonymous closure on every loop iteration. And I tried 10 million loop iterations, in PHP 7.0.14 from Dec 2016. Result:<br><br>a single saved closure kept in a variable and re-used (10000000 iterations): 1.3874590396881 seconds<br><br>new anonymous closure created each time (10000000 iterations): 2.8460240364075 seconds<br><br>In other words, over the course of 10 million iterations, creating the closure again during every iteration only added a total of &quot;1.459 seconds&quot; to the runtime. So that means that every creation of a new anonymous closure takes about 146 nanoseconds on my 7 years old dual-core laptop. I guess PHP keeps a cached &quot;template&quot; for the anonymous function and therefore doesn&apos;t need much time to create a new instance of the closure!<br><br>So you do NOT have to worry about constantly re-creating your anonymous closures over and over again in tight loops! At least not as of PHP 7! There is absolutely NO need to save an instance in a variable and re-use it. And not being restricted by that is a great thing, because it means you can feel free to use anonymous functions exactly where they matter, as opposed to defining them somewhere else in the code. :-)</span>
</div>
  

#


<div class="phpcode"><span class="html">
As an alternative to gabriel&apos;s recursive construction, you may instead assign the recursive function to a variable, and use it by reference, thus:<br><br><span class="default">&lt;?php<br>$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br>};<br><br>echo </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span>Hardly a sensible implementation of the Fibonacci sequence, but that&apos;s not the point! The point is that the variable needs to be used by reference, not value.<br><br>Without the &apos;&amp;&apos;, the anonymous function gets the value of $fib at the time the function is being created. But until the function has been created, $fib can&apos;t have it as a value! It&apos;s not until AFTER the function has been assigned to $fib that $fib can be used to call the function - but by then it&apos;s too late to pass its value to the function being created!<br><br>Using a reference resolves the dilemma: when called, the anonymous function will use $fib&apos;s current value, which will be the anonymous function itself.<br><br>At least, it will be if you don&apos;t reassign $fib to anything else between creating the function and calling it:<br><br><span class="default">&lt;?php<br>$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br>};<br><br></span><span class="default">$lie </span><span class="keyword">= </span><span class="default">$fib</span><span class="keyword">;<br><br></span><span class="default">$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; return </span><span class="default">100</span><span class="keyword">;<br>};<br><br>echo </span><span class="default">$lie</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">); </span><span class="comment">// 200, because $fib(10 - 1) and $fib(10 - 2) both return 100.<br></span><span class="default">?&gt;<br></span><br>Of course, that&apos;s true of any variable: if you don&apos;t want its value to change, don&apos;t change its value.<br><br>All the usual scoping rules for variables still apply: a local variable in a function is a different variable from another one with the same name in another function:<br><br><span class="default">&lt;?php<br>$fib </span><span class="keyword">= function(</span><span class="default">$n</span><span class="keyword">)use(&amp;</span><span class="default">$fib</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; if(</span><span class="default">$n </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$n </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) return </span><span class="default">1</span><span class="keyword">;<br>&#xA0; &#xA0; return </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) + </span><span class="default">$fib</span><span class="keyword">(</span><span class="default">$n </span><span class="keyword">- </span><span class="default">2</span><span class="keyword">);<br>};<br><br></span><span class="default">$bark </span><span class="keyword">= function(</span><span class="default">$f</span><span class="keyword">)<br>{<br>&#xA0; &#xA0; </span><span class="default">$fib </span><span class="keyword">= </span><span class="string">&apos;cake&apos;</span><span class="keyword">;&#xA0; &#xA0; </span><span class="comment">// A totally different variable from the $fib above.<br>&#xA0; &#xA0; </span><span class="keyword">return </span><span class="default">2 </span><span class="keyword">* </span><span class="default">$f</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br>};<br><br>echo </span><span class="default">$bark</span><span class="keyword">(</span><span class="default">$fib</span><span class="keyword">); </span><span class="comment">// 16, twice the fifth Fibonacci number<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#


<div class="phpcode"><span class="html">
Anonymous functions are great for events!<br><br><span class="default">&lt;?php<br><br></span><span class="keyword">class </span><span class="default">Event </span><span class="keyword">{<br><br>&#xA0; public static </span><span class="default">$events </span><span class="keyword">= array();<br>&#xA0; <br>&#xA0; public static function </span><span class="default">bind</span><span class="keyword">(</span><span class="default">$event</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$obj </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br>&#xA0; &#xA0; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">]) {<br>&#xA0; &#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">] = array();<br>&#xA0; &#xA0; }<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; </span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">][] = (</span><span class="default">$obj </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)&#xA0; ? </span><span class="default">$callback </span><span class="keyword">: array(</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">$callback</span><span class="keyword">);<br>&#xA0; }<br>&#xA0; <br>&#xA0; public static function </span><span class="default">run</span><span class="keyword">(</span><span class="default">$event</span><span class="keyword">) {<br>&#xA0; &#xA0; if (!</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">]) return;<br>&#xA0; &#xA0; <br>&#xA0; &#xA0; foreach (</span><span class="default">self</span><span class="keyword">::</span><span class="default">$events</span><span class="keyword">[</span><span class="default">$event</span><span class="keyword">] as </span><span class="default">$callback</span><span class="keyword">) {<br>&#xA0; &#xA0; &#xA0; if (</span><span class="default">call_user_func</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) break;<br>&#xA0; &#xA0; }<br>&#xA0; }<br><br>}<br><br>function </span><span class="default">hello</span><span class="keyword">() {<br>&#xA0; echo </span><span class="string">&quot;Hello from function hello()\n&quot;</span><span class="keyword">;<br>}<br><br>class </span><span class="default">Foo </span><span class="keyword">{<br>&#xA0; function </span><span class="default">hello</span><span class="keyword">() {<br>&#xA0; &#xA0; echo </span><span class="string">&quot;Hello from foo-&gt;hello()\n&quot;</span><span class="keyword">;<br>&#xA0; }<br>}<br><br>class </span><span class="default">Bar </span><span class="keyword">{<br>&#xA0; function </span><span class="default">hello</span><span class="keyword">() {<br>&#xA0; &#xA0; echo </span><span class="string">&quot;Hello from Bar::hello()\n&quot;</span><span class="keyword">;<br>&#xA0; }<br>}<br><br></span><span class="default">$foo </span><span class="keyword">= new </span><span class="default">Foo</span><span class="keyword">();<br><br></span><span class="comment">// bind a global function to the &apos;test&apos; event<br></span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">&quot;test&quot;</span><span class="keyword">, </span><span class="string">&quot;hello&quot;</span><span class="keyword">);<br><br></span><span class="comment">// bind an anonymous function<br></span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">&quot;test&quot;</span><span class="keyword">, function() { echo </span><span class="string">&quot;Hello from anonymous function\n&quot;</span><span class="keyword">; });<br><br></span><span class="comment">// bind an class function on an instance<br></span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">&quot;test&quot;</span><span class="keyword">, </span><span class="string">&quot;hello&quot;</span><span class="keyword">, </span><span class="default">$foo</span><span class="keyword">);<br><br></span><span class="comment">// bind a static class function<br></span><span class="default">Event</span><span class="keyword">::</span><span class="default">bind</span><span class="keyword">(</span><span class="string">&quot;test&quot;</span><span class="keyword">, </span><span class="string">&quot;Bar::hello&quot;</span><span class="keyword">);<br><br></span><span class="default">Event</span><span class="keyword">::</span><span class="default">run</span><span class="keyword">(</span><span class="string">&quot;test&quot;</span><span class="keyword">);<br><br></span><span class="comment">/* Output<br>Hello from function hello()<br>Hello from anonymous function<br>Hello from foo-&gt;hello()<br>Hello from Bar::hello()<br>*/<br><br></span><span class="default">?&gt;</span>
</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/functions.anonymous.php)

**[To root](/)**