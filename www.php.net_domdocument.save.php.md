# DOMDocument::save




<div class="phpcode"><span class="html">
The XML parser converts the text of an XML document into UTF-8, even if you have set the character encoding of the XML, for example as a second parameter of the DOMDocument constructor. After parsing the XML with the load() command all its texts have been converted to UTF-8.<br><br>In case you append text nodes with special characters (e. g. Umlaut) to your XML document you should therefore use utf8_encode() with your text to convert it into UTF-8 before you append the text to the document. Otherwise you will get an error message like &quot;output conversion failed due to conv error&quot; at the save() command. See example below:<br><br><span class="default">&lt;?php<br></span><span class="comment">// Text to insert into XML below<br></span><span class="default">$txt </span><span class="keyword">= </span><span class="string">&quot;a text with special characters like &apos;&#xE4;&apos;, &apos;&#xDF;&apos;, &apos;&#xDC;&apos; etc.&quot;</span><span class="keyword">;<br><br></span><span class="comment">// Create Instance of DOMDocument<br></span><span class="default">$dom </span><span class="keyword">=&#xA0; new </span><span class="default">DOMDocument</span><span class="keyword">;<br></span><span class="comment">// Load XML file<br>// Was created before with DOMDocument(&apos;1.0&apos;, &apos;iso-8859-1&apos;)<br></span><span class="default">$dom </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">&quot;file.xml&quot;</span><span class="keyword">);<br></span><span class="comment">// Find the parent node<br></span><span class="default">$parent </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">;<br></span><span class="comment">// Create Instance of DomXPath<br></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DomXPath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br></span><span class="comment">// new node will be inserted before this node<br></span><span class="default">$next </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">&quot;//parentnode/childnode&quot;</span><span class="keyword">);<br></span><span class="comment">// Create the new element<br></span><span class="default">$new_elem </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">&apos;new_elem&apos;</span><span class="keyword">);<br></span><span class="comment">// Insert the new element<br></span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">insertBefore</span><span class="keyword">(</span><span class="default">$new_elem</span><span class="keyword">, </span><span class="default">$next</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">));<br></span><span class="comment">// DOMXML = utf-8! (will be converted to iso-8859-1 only at &apos;save()&apos;)<br>// prevents error message &quot;output conversion failed due to conv error&quot; at &apos;save()&apos;<br></span><span class="default">$txt </span><span class="keyword">= </span><span class="default">utf8_encode</span><span class="keyword">(</span><span class="default">$txt</span><span class="keyword">);<br></span><span class="comment">// Create new text node with utf-8 encoded string<br></span><span class="default">$nodetext </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">createTextNode</span><span class="keyword">(</span><span class="string">&quot;</span><span class="default">$txt</span><span class="string">&quot;</span><span class="keyword">);<br></span><span class="comment">// Append text node to new element<br></span><span class="default">$nodetext </span><span class="keyword">= </span><span class="default">$new_elem</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$nodetext</span><span class="keyword">);<br></span><span class="comment">// save <br></span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="string">&quot;file.xml&quot;</span><span class="keyword">);<br></span><span class="default">?&gt;<br></span><br>Hope this helps someone.<br><br>siegparr</span>
</div>
  

#

[Official documentation page](https://www.php.net/manual/en/domdocument.save.php)

**[To root](/README.md)**